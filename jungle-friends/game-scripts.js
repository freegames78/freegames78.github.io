var Movement=pc.createScript("movement");Movement.attributes.add("speed",{type:"number",default:.1}),Movement.attributes.add("startAngle",{type:"number",default:0}),Movement.attributes.add("turnSpeed",{type:"number",default:.05}),Movement.attributes.add("isometric",{type:"number",default:0}),Movement.attributes.add("characterEntity",{type:"entity"}),Movement.attributes.add("originEntity",{type:"entity"}),Movement.attributes.add("touchEntity",{type:"entity"}),Movement.attributes.add("touchStartEntity",{type:"entity"}),Movement.attributes.add("touchMoveEntity",{type:"entity"}),Movement.attributes.add("touchDirectionEntity",{type:"entity"}),Movement.attributes.add("unicycleEntity",{type:"entity"}),Movement.attributes.add("runningParticles",{type:"entity"}),Movement.prototype.initialize=function(){this.isRunning=!1,this.direction=this.startAngle*pc.math.DEG_TO_RAD,this.nextDirection=this.startAngle*pc.math.DEG_TO_RAD,this.stopThreshold=0,this.pointClickPosition=!1,this.footstepType="Grass",this.stepIndex=1,this.entity.on("Kick",this.onKick,this),this.entity.on("Chop",this.onChop,this),this.entity.on("Collision",this.onCollision,this),this.characterEntity.anim.on("Sound",this.playSound,this),this.app.on("PointClick:Position",this.onPointerPosition,this),this.app.on("Player:SecureSpawn",this.onSecureSpawn,this),this.app.on("Player:Unicycle",this.setUnicycleState,this),Utils.isMobile()&&this.initializeTouch(),this.isLocked=!1},Movement.prototype.setUnicycleState=function(){this.unicycleEntity.enabled=!this.unicycleEntity.enabled},Movement.prototype.onSecureSpawn=function(t){if(t){var i=t.getPosition().clone().sub(this.entity.getPosition()).length(),e=t.findByName("SecurePoint");e&&i<1.5&&this.entity.setPosition(e.getPosition().clone())}},Movement.prototype.playSound=function(t){if("Run"==t.string){var i="Footstep-"+this.footstepType+"-"+this.stepIndex,e=.9;this.isCarrying&&(e=.8),this.entity.sound.slots[i].pitch=e+.3*Math.random(),this.entity.sound.play(i),this.stepIndex++,this.stepIndex>4&&(this.stepIndex=1)}},Movement.prototype.initializeTouch=function(){this.isTouching=!1,this.touchEntity.enabled=!1,this.app.touch&&(this.app.touch.on("touchstart",this.onTouchStart,this),this.app.touch.on("touchmove",this.onTouchMove,this),this.app.touch.on("touchend",this.onTouchEnd,this)),this.touchStart=new pc.Vec2(0,0),this.currentTouch=new pc.Vec2(0,0)},Movement.prototype.onTouchStart=function(t){if(this.isLocked)return!1;var i=t.touches;i||(i=[t]),i.length>0&&(this.touchStart.x=i[0].x,this.touchStart.y=i[0].y,this.isTouchMoved=!1,this.setTouchEntityPosition(),this.totalMouseDistance=0,this.touchEntity.enabled=!0,this.touchDirectionEntity.enabled=!1,this.touchMoveEntity.setLocalPosition(0,0,0),this.isTouching=!0)},Movement.prototype.onTouchEnd=function(){this.isTouching=!1,this.touchEntity.enabled=!1},Movement.prototype.onTouchMove=function(t){if(this.isLocked)return!1;var i=t.touches;if(i||(i=[t]),i.length>0){this.currentTouch.x=i[0].x,this.currentTouch.y=i[0].y,this.isTouchMoved=!0;var e=this.currentTouch.x-this.touchStart.x,s=this.currentTouch.y-this.touchStart.y,n=75;if(e>n?e=n:e<-75&&(e=-75),s>n?s=n:s<-75&&(s=-75),this.touchMoveEntity.setLocalPosition(2*e,2*-s,0),this.totalMouseDistance=Utils.distance(this.touchStart.x,this.touchStart.y,this.currentTouch.x,this.currentTouch.y),this.touchMoveEntity.enabled=!0,this.totalMouseDistance>=n){var o=this.currentTouch.x-this.touchStart.x,h=this.currentTouch.y-this.touchStart.y,c=this.normalize(o,h),r=Math.min(Math.max(this.totalMouseDistance,0),n);this.touchStart.x=this.currentTouch.x-c.x*r,this.touchStart.y=this.currentTouch.y-c.y*r,this.setTouchEntityPosition()}}},Movement.prototype.setTouch=function(){if(this.isLocked)return!1;if(this.isTouching&&this.isTouchMoved){var t=Utils.lookAt(this.touchStart.x,this.touchStart.y,this.currentTouch.x,this.currentTouch.y);this.nextDirection=(-t+Math.PI/2+this.isometric*pc.math.DEG_TO_RAD)*pc.math.RAD_TO_DEG,this.isRunning=!0;var i=(-t+Math.PI/2)*pc.math.RAD_TO_DEG;this.touchDirectionEntity.setLocalEulerAngles(0,0,-i),this.touchDirectionEntity.enabled=this.totalMouseDistance>50}},Movement.prototype.normalize=function(t,i){var e=Math.sqrt(t*t+i*i);return 0===e?{x:0,y:0}:{x:t/e,y:i/e}},Movement.prototype.setTouchEntityPosition=function(){var t=this.app.graphicsDevice.canvas,i=this.touchStart.x/t.clientWidth*2-1,e=1-this.touchStart.y/t.clientHeight*2;this.touchEntity.setPosition(i,e,0)},Movement.prototype.onCollision=function(t){this.stopThreshold+=.05},Movement.prototype.onPointerPosition=function(t){this.pointClickPosition=t,this.stopThreshold=0},Movement.prototype.onKick=function(){this.characterEntity.anim.setTrigger("Kick")},Movement.prototype.onChop=function(){this.characterEntity.anim.setTrigger("Chop")},Movement.prototype.setKeyboard=function(){(this.app.keyboard.isPressed(pc.KEY_W)||this.app.keyboard.isPressed(pc.KEY_UP))&&(this.nextDirection=-90+this.isometric,this.isRunning=!0),(this.app.keyboard.isPressed(pc.KEY_A)||this.app.keyboard.isPressed(pc.KEY_LEFT))&&(this.nextDirection=-180+this.isometric,this.isRunning=!0),(this.app.keyboard.isPressed(pc.KEY_D)||this.app.keyboard.isPressed(pc.KEY_RIGHT))&&(this.nextDirection=0+this.isometric,this.isRunning=!0),(this.app.keyboard.isPressed(pc.KEY_S)||this.app.keyboard.isPressed(pc.KEY_DOWN))&&(this.nextDirection=90+this.isometric,this.isRunning=!0),(this.app.keyboard.isPressed(pc.KEY_W)||this.app.keyboard.isPressed(pc.KEY_UP))&&(this.app.keyboard.isPressed(pc.KEY_A)||this.app.keyboard.isPressed(pc.KEY_LEFT))&&(this.nextDirection=-135+this.isometric,this.isRunning=!0),(this.app.keyboard.isPressed(pc.KEY_W)||this.app.keyboard.isPressed(pc.KEY_UP))&&(this.app.keyboard.isPressed(pc.KEY_D)||this.app.keyboard.isPressed(pc.KEY_RIGHT))&&(this.nextDirection=-45+this.isometric,this.isRunning=!0),(this.app.keyboard.isPressed(pc.KEY_S)||this.app.keyboard.isPressed(pc.KEY_DOWN))&&(this.app.keyboard.isPressed(pc.KEY_A)||this.app.keyboard.isPressed(pc.KEY_LEFT))&&(this.nextDirection=135+this.isometric,this.isRunning=!0),(this.app.keyboard.isPressed(pc.KEY_S)||this.app.keyboard.isPressed(pc.KEY_DOWN))&&(this.app.keyboard.isPressed(pc.KEY_D)||this.app.keyboard.isPressed(pc.KEY_RIGHT))&&(this.nextDirection=45+this.isometric,this.isRunning=!0),this.isRunning&&this.app.fire("PointClick:Reach")},Movement.prototype.setMovement=function(t){if(this.isLocked)return this.characterEntity.anim.setBoolean("Running",!1),!1;if(this.isRunning=!1,this.setKeyboard(t),this.setTouch(),this.movePointClick(t),this.isRunning){var i=this.turnSpeed,e=this.nextDirection*pc.math.DEG_TO_RAD;this.direction=Utils.rotate(this.direction,e,i);var s=this.speed;this.unicycleEntity.enabled&&(s*=1.15);var n=Math.cos(e)*s*t,o=Math.sin(e)*s*t;this.entity.translate(n,0,o)}this.originEntity.setLocalEulerAngles(0,90-this.direction*pc.math.RAD_TO_DEG,0),this.characterEntity.anim.setBoolean("Running",this.isRunning),this.characterEntity.anim.setBoolean("Cycling",this.unicycleEntity.enabled),this.unicycleEntity.anim.setBoolean("Running",this.isRunning),this.runningParticles.enabled=this.isRunning},Movement.prototype.movePointClick=function(t){if(!this.pointClickPosition)return!1;var i=this.entity.getPosition();if(Utils.distance(i.x,i.z,this.pointClickPosition.x,this.pointClickPosition.z)<.1||this.stopThreshold>1.5)return this.app.fire("PointClick:Reach"),this.pointClickPosition=!1,this.stopThreshold=0,!1;var e=Utils.lookAt(i.x,i.z,this.pointClickPosition.x,this.pointClickPosition.z);this.nextDirection=(-e+Math.PI/2)*pc.math.RAD_TO_DEG,this.isRunning=!0},Movement.prototype.update=function(t){if(pc.hasActiveInterface)return!1;this.setMovement(t)};var Physics=pc.createScript("physics");Physics.attributes.add("threshold",{type:"number",default:1.1}),Physics.prototype.initialize=function(){this.kinematicCollisions=[]},Physics.prototype.updateKinematic=function(){if(Date.now()-this.lastKinematicUpdate<1e3)return!1;this.kinematicCollisions=[];for(var t=this,i=Object.values(pc.app.systems.collision.store),e=i.length;e--;){var s=i[e];s.entity&&s.entity.tags.list().indexOf("Dynamic")>-1&&(s.entity._translate||(s.entity.revertTranslate=function(i){var e=this.getPosition();if(!e)return!1;var s=i.getPosition(),n=t.lookAt(s.x,s.z,e.x,e.z),o=e.clone().sub(this.previousPosition).length()*t.threshold,a=n-Math.PI,l=Math.cos(a)*o,r=Math.sin(a)*o;this._translate(-r,0,-l)},s.entity._translate=s.entity.translate,s.entity.previousPosition=s.entity.getPosition().clone(),s.entity.translate=function(t,i,e){this.previousPosition=this.getPosition().clone(),this._translate(t,i,e)}.bind(s.entity)),this.kinematicCollisions.push(s.entity))}this.lastKinematicUpdate=Date.now()},Physics.prototype.checkCollisions=function(t){for(var i=this.kinematicCollisions.length;i--;){var e=this.kinematicCollisions[i],s=Object.values(pc.app.systems.collision.store),n=s.length;for(this.triggerPool=[];n--;){var o=s[n];o&&o.entity.parent&&o.entity.enabled&&o.entity.collision.enabled&&-1===o.entity.tags.list().indexOf("Dynamic")&&("sphere"==o.data.type?this.calculateSphereCollision(e,o):"box"==o.data.type&&this.calculateBoxCollision(e,o))}if(this.triggerPool.sort((function(t,i){return t.distance-i.distance})),this.triggerPool.length>0)for(var a=0;a<this.triggerPool.length;a++)this.triggerPool[a].object.entity.fire("Trigger",e,t)}},Physics.prototype.calculateSphereCollision=function(t,i){var e=t.getPosition().sub(i.entity.getPosition()).length(),s=i.data.radius,n=i.entity.tags.list().indexOf("Ghost")>-1;e<t.collision.radius+s&&(this.triggerPool.push({distance:e,object:i}),t.fire("Collision",i.entity),n||t.revertTranslate(i.entity))},Physics.prototype.calculateBoxCollision=function(t,i){var e=t.getPosition().sub(i.entity.getPosition()).length(),s=t.getPosition(),n=t.collision.radius,o=i.entity.getPosition(),a=i.data.halfExtents,l=i.entity.tags.list().indexOf("Ghost")>-1;s.x>o.x-a.x-n&&s.x<o.x+a.x+n&&s.z>o.z-a.z-n&&s.z<o.z+a.z+n&&(this.triggerPool.push({distance:e,object:i}),t.fire("Collision",i.entity),l||t.revertTranslate(i.entity))},Physics.prototype.update=function(t){this.updateKinematic(),this.checkCollisions(t)},Physics.prototype.lookAt=function(t,i,e,s){return Math.atan2(e-t,s-i)};var CameraFollow=pc.createScript("cameraFollow");CameraFollow.attributes.add("cameraEntity",{type:"entity"}),CameraFollow.attributes.add("followEntity",{type:"entity"}),CameraFollow.attributes.add("playerEntity",{type:"entity"}),CameraFollow.attributes.add("speed",{type:"number",default:.1}),CameraFollow.prototype.initialize=function(){this.offset=new pc.Vec3(0,0,0),this.nextOffset=new pc.Vec3(0,0,0),this.cameraOffset=new pc.Vec3(0,0,0),this.isFocusing=!1,this.lastFollowedEntity=!1,this.lastFocusing=!1,this.alreadyFocused=[];var t=Utils.getItem("AlreadyFocused");t&&(this.alreadyFocused=JSON.parse(t)),this.defaultVector=new pc.Vec3(0,0,0),this.app.on("Camera:Focus",this.setCameraFocus,this),this.app.on("Camera:FocusByName",this.setCameraFocusByName,this),this.app.on("Camera:Clear",this.clearCameraFocus,this),this.app.on("Camera:Offset",this.setCameraOffset,this),this.app.keyboard.on("keydown",this.onKeyDown,this)},CameraFollow.prototype.setCameraFocusByName=function(t){this.clearCameraFocus();var e=this.app.root.findByName(t);e&&this.setCameraFocus(e)},CameraFollow.prototype.onKeyDown=function(){this.focusBack()},CameraFollow.prototype.setCameraOffset=function(t){this.nextOffset=t},CameraFollow.prototype.clearCameraFocus=function(){this.lastFollowedEntity=!1,this.followEntity=this.playerEntity,this.alreadyFocused=[]},CameraFollow.prototype.setCameraFocus=function(t,e){return!!t&&(t!=this.followEntity&&(t!=this.lastFollowedEntity&&(!(Date.now()-this.lastFocusing<500)&&(!(this.alreadyFocused.indexOf(t.name)>-1)&&(!(t.getPosition().clone().sub(this.playerEntity).length()<1)&&(this.followEntity=t,this.speed=.05,this.isFocusing=!0,this.entity.sound.play("Spinning"),Timer.clearTimeout(this.cameraTimer),this.lastFollowedEntity=t,this.alreadyFocused.push(t.name),Utils.setItem("AlreadyFocused",JSON.stringify(this.alreadyFocused)),this.lastFollowedEntityTimer=Timer.setTimeout((function(t){t.lastFollowedEntity=!1}),3e3,this),this.cameraTimer=Timer.setTimeout((function(t){t.focusBack()}),e||3e3,this),void(this.lastFocusing=Date.now())))))))},CameraFollow.prototype.focusBack=function(){return this.followEntity!=this.playerEntity&&(!(Date.now()-this.lastFocusing<700)&&(Timer.clearTimeout(this.cameraTimer),this.entity.sound.play("Spinning"),this.followEntity=this.playerEntity,this.speed=.1,void(this.isFocusing=!1)))},CameraFollow.prototype.update=function(t){if(!this.followEntity)return!1;var e=this.entity.getPosition().lerp(this.entity.getPosition(),this.followEntity.getPosition(),this.speed);this.offset=this.offset.lerp(this.offset,this.nextOffset,.05),this.nextOffset=this.nextOffset.lerp(this.nextOffset,this.defaultVector,.01),this.isFocusing?this.entity.setPosition(e):this.entity.setPosition(e.add(this.nextOffset))};var Timer={nextTimerId:0,timers:[],init:function(){pc.app.on("update",this.onUpdate,this)},setTimeout:function(t,i,e,n,o){return setTimeout(t,i,e,n,o)},clearTimeout:function(t){clearTimeout(t)},onUpdate:function(t){}};Timer.init();var Collectable=pc.createScript("collectable");Collectable.attributes.add("delay",{type:"number",default:0}),Collectable.prototype.initialize=function(){this.createdAt=Date.now(),this.entity.on("Trigger",this.onTrigger,this)},Collectable.prototype.onTrigger=function(t){if(!this.entity.collision.enabled)return!1;if(this.delay>0&&Date.now()-this.createdAt<1e3*this.delay)return!1;if(!t)return!1;var e=this;t.fire("SetToCarry",this.entity,(function(){e.entity.fire("Collected",t)})),this.app.fire("Collectable:Collect",this.entity.name)};var Carry=pc.createScript("carry");Carry.attributes.add("characterEntity",{type:"entity"}),Carry.attributes.add("holderEntity",{type:"entity"}),Carry.attributes.add("hoverEntity",{type:"entity"}),Carry.attributes.add("dropPoint",{type:"entity"}),Carry.attributes.add("mapHolder",{type:"entity"}),Carry.prototype.initialize=function(){this.lastInteractionTime=Date.now(),this.index=0,this.carryIndexes=[],this.shownItem=!1,this.currentHover=!1,this.lastHoverTime=Date.now(),this.app.on("Player:Action",this.onAction,this),this.entity.on("SetToCarry",this.setToCarry,this),this.entity.on("Drop",this.onDrop,this),this.entity.on("Clear",this.onClear,this),this.characterEntity.anim.on("Show",this.onShow,this),this.characterEntity.anim.on("Hide",this.onHide,this)},Carry.prototype.onClear=function(){this.carryIndexes=[],this.characterEntity.anim.setBoolean("Holding",!1),this.characterEntity.anim.setBoolean("Running",!1)},Carry.prototype.onShow=function(t){var e=this.entity.findByName(t.string);e&&(e.enabled=!0,this.shownItem=e)},Carry.prototype.onHide=function(){this.shownItem&&(this.shownItem.enabled=!1,this.shownItem=!1)},Carry.prototype.setToCarry=function(t,e){return!(Date.now()-this.lastInteractionTime<500)&&(!(this.carryIndexes.length>0)&&(!(pc.MoveAnimate.checkExist(t)>-1)&&(this.currentHover=t,this.lastHoverTime=Date.now(),this.hoverEntity.setPosition(t.getPosition()),this.hoverEntity.enabled=!0,t.fire("CarriedBy",this.entity),t.parent.fire("CollectedBy",this.entity),this.entity.on("AfterCarry",t),this.app.fire("Overlay:AddItem",t.name),this.entity.sound.play("Take-Item"),this.lastInteractionTime=Date.now(),void(e&&e()))))},Carry.prototype.onCarry=function(t){if(!t)return!1;var e=this;this.app.fire("MoveAnimate:Entity",t,this.holderEntity.getPosition().clone(),(function(t){t.reparent(e.holderEntity),t.setLocalPosition(0,0,0),t.setLocalEulerAngles(0,0,0)})),this.index++,this.carryIndexes.push(t),t.collision.enabled=!1,this.app.fire("EffectManager:LandSmoke",t.getPosition().clone()),this.hoverEntity.enabled=!1,this.currentHover=!1},Carry.prototype.snap=function(t){return Math.round(t)},Carry.prototype.getItemByName=function(t){for(var e=this.carryIndexes.length;e--;){if(this.carryIndexes[e].name===t)return this.carryIndexes[e]}return!1},Carry.prototype.onDrop=function(t,e){var i=this.carryIndexes[0];return!!i&&(-1!==i.tags.list().indexOf(t)&&(!(pc.MoveAnimate.checkExist(i)>-1)&&(e.fire("Transfer",i),this.carryIndexes.splice(this.carryIndexes.indexOf(i),1),void this.entity.sound.play("Drop-Item"))))},Carry.prototype.onDropGround=function(t){var e=this;this.dropPosition=this.dropPoint.getPosition().clone(),this.dropPosition.x=this.snap(this.dropPosition.x),this.dropPosition.z=this.snap(this.dropPosition.z),t&&(this.app.fire("MoveAnimate:Entity",t,this.dropPosition,(function(t){t.reparent(e.mapHolder),t.collision.enabled=!0,t.fire("Ground"),t.setLocalPosition(e.dropPosition),t.setLocalEulerAngles(0,0,0)})),this.carryIndexes.splice(this.carryIndexes.indexOf(t),1))},Carry.prototype.onAction=function(){return!(this.carryIndexes.length>0)&&(!!this.currentHover&&(this.onCarry(this.currentHover),this.characterEntity.anim.setTrigger("Take"),void(this.currentHover=!1)))},Carry.prototype.setKeyboard=function(){this.app.keyboard.wasPressed(pc.KEY_SPACE)||this.app.keyboard.wasPressed(pc.KEY_ENTER)},Carry.prototype.update=function(t){Date.now()-this.lastHoverTime>60&&this.currentHover&&(this.currentHover=!1,this.hoverEntity.enabled=!1),this.setKeyboard(),this.onAction(),this.characterEntity.anim.setBoolean("Holding",this.carryIndexes.length>0)};var Droppable=pc.createScript("droppable");Droppable.attributes.add("acceptedType",{type:"string",default:"Log"}),Droppable.attributes.add("count",{type:"number",default:1}),Droppable.attributes.add("dropPoints",{type:"entity",array:!0}),Droppable.attributes.add("afterDestroy",{type:"boolean",default:!1}),Droppable.prototype.initialize=function(){this.lastDropTime=Date.now(),this.isActive=!0,this.itemArray=[],this.entity.on("Trigger",this.onTrigger,this),this.entity.on("Transfer",this.onTransfer,this),this.entity.on("Clear",this.onClear,this),this.entity.on("Consume",this.onConsume,this),this.entity.on("Remove",this.onRemove,this),this.entity.on("Droppable:State",this.setState,this)},Droppable.prototype.onClear=function(t){for(var e=this.itemArray.length;e--;)this.itemArray[e].destroy();this.itemArray=[]},Droppable.prototype.setState=function(t){this.isActive=t},Droppable.prototype.onTrigger=function(t){return!!t&&(!!this.isActive&&(0!==t.script.carry.carryIndexes.length&&(!(this.count<=this.itemArray.length)&&(!(Date.now()-this.lastDropTime<150)&&(t.fire("Drop",this.acceptedType,this.entity),void(this.lastDropTime=Date.now()))))))},Droppable.prototype.onTransfer=function(t){if(!t)return!1;if(!this.isActive)return!1;var e=this,i=this.itemArray.length;if(!this.dropPoints[i])return!1;this.app.fire("MoveAnimate:Entity",t,this.dropPoints[i].getPosition().clone(),(function(t){t.reparent(e.dropPoints[i]),t.setLocalPosition(0,0,0),t.fire("Dropped",e.entity),e.entity.fire("Added",t,e.itemArray.length),pc.app.fire("Item:AddedTo",t.name,e.entity.name),e.afterDestroy&&(e.onRemove(t),t.destroy())})),this.itemArray.push(t)},Droppable.prototype.onConsume=function(t){if(this.itemArray.length>0){var e=this.itemArray.length-1,i=this.itemArray[e];i&&(i.destroy(),this.itemArray.splice(e,1))}},Droppable.prototype.onRemove=function(t){var e=this.itemArray.indexOf(t);e>-1&&this.itemArray.splice(e,1)};var MoveAnimate=pc.createScript("moveAnimate");MoveAnimate.attributes.add("speed",{type:"number",default:20}),MoveAnimate.attributes.add("threshold",{type:"number",default:.25}),MoveAnimate.prototype.initialize=function(){this.moving=[],this.app.on("MoveAnimate:Entity",this.onMove,this),pc.MoveAnimate=this},MoveAnimate.prototype.onMove=function(t,e,i){if(this.checkExist(t)>-1)return console.log("There is an ongoing process on MoveAnimate..."),!1;var o=t.getPosition().clone(),n={entity:t,to:e,speed:this.speed,callback:i,timer:Timer.setTimeout((function(t,e){var i=e.moving.indexOf(t);i>-1&&(e.moving.splice(i,1),t.callback(t.entity))}),1500,n,this)};this.moving.push(n),t.reparent(this.app.root),t.setPosition(o)},MoveAnimate.prototype.checkExist=function(t){for(var e=this.moving.length;e--;)if(this.moving[e].entity==t)return e},MoveAnimate.prototype.update=function(t){for(var e=this.moving.length;e--;){var i=this.moving[e],o=i.entity.getPosition(),n=i.to.clone(),s=o.clone().sub(n).length(),a=i.to.clone().sub(o.clone()).normalize(),r=i.speed*t,c=o.clone().add(a.scale(r));i.entity.setPosition(c),s<this.threshold&&(this.moving.splice(e,1),i.callback(i.entity),Timer.clearTimeout(i.timer))}};var Transformer=pc.createScript("transformer");Transformer.attributes.add("requiredAmount",{type:"number",default:1}),Transformer.attributes.add("time",{type:"number",default:1}),Transformer.attributes.add("cloneItem",{type:"entity"}),Transformer.attributes.add("amount",{type:"number",default:1}),Transformer.prototype.initialize=function(){this.addedEntities=[],this.entity.on("Added",this.onItemAdded,this)},Transformer.prototype.onItemAdded=function(t){this.addedEntities.push(t),this.entity.fire("ItemCount",this.addedEntities.length,this.requiredAmount)},Transformer.prototype.clearEntities=function(t){for(var e=Number(t);e--;)this.addedEntities[e].destroy(),this.addedEntities.splice(e,1);this.entity.fire("ItemCount",this.addedEntities.length,this.requiredAmount),this.isProccessing=!1,this.entity.fire("Proccessing",this.isProccessing)},Transformer.prototype.transform=function(){if(!this.cloneItem)return!1;var t=this.cloneItem.clone();t.enabled=!0,this.app.root.addChild(t)},Transformer.prototype.update=function(){!this.isProccessing&&this.addedEntities.length>=this.requiredAmount&&(Timer.setTimeout((function(t){t.clearEntities(t.requiredAmount),t.transform()}),1e3*this.time,this),this.isProccessing=!0,this.entity.fire("Proccessing",this.isProccessing))};function GridPoint(i,t,s){this.x=i,this.y=t,this.f=0,this.g=0,this.h=0,this.neighbors=[],this.parent=void 0,this.walkable=!0,this.position=new pc.Vec3(i-s.offset+s.position.x,0,t-s.offset+s.position.z),this.updateNeighbors=function(i){let t=this.x,e=this.y;t<s.size-1&&this.neighbors.push(i[t+1][e]),t>0&&this.neighbors.push(i[t-1][e]),e<s.size-1&&this.neighbors.push(i[t][e+1]),e>0&&this.neighbors.push(i[t][e-1])}}var PathFinding=pc.createScript("pathFinding");PathFinding.attributes.add("size",{type:"number",default:5}),PathFinding.prototype.initialize=function(){this.refresh(),this.entity.on("PathFinding:Search",this.search,this),this.entity.on("PathFinding:Walk",this.walk,this),this.entity.on("PathFinding:Refresh",this.refresh,this)},PathFinding.prototype.refresh=function(){var i=this;this.offset=Math.floor(this.size/2),this.grid=new Array(this.size),this.position=this.entity.getPosition().clone();for(let i=0;i<this.size;i++)this.grid[i]=new Array(this.size);for(let i=0;i<this.size;i++)for(let t=0;t<this.size;t++)this.grid[i][t]=new GridPoint(i,t,this);for(let i=0;i<this.size;i++)for(let t=0;t<this.size;t++)this.grid[i][t].updateNeighbors(this.grid);this.obstacles=this.entity.findByTag("Obstacle"),this.obstacles.forEach((function(t){var s=t.getPosition(),e=i.snap(s.x-i.position.x),n=i.snap(s.z-i.position.z);i.grid[e][n].walkable=!1}))},PathFinding.prototype.heuristic=function(i,t){return Math.abs(t.x-i.x)+Math.abs(t.y-i.y)},PathFinding.prototype.snap=function(i){return Math.floor(i)+this.offset},PathFinding.prototype.resetGrid=function(){for(let i=0;i<this.size;i++)for(let t=0;t<this.size;t++)this.grid[i][t].f=0,this.grid[i][t].g=0,this.grid[i][t].h=0,this.grid[i][t].parent=void 0},PathFinding.prototype.search=function(i,t){this.resetGrid();var s=[],e=[],n=[],h=this.snap(i.x-this.position.x),o=this.snap(i.z-this.position.z),r=this.snap(t.x-this.position.x),a=this.snap(t.z-this.position.z);for(end=this.grid[r][a],s.push(this.grid[h][o]);s.length>0;){let i=0;for(let t=0;t<s.length;t++)s[t].f<s[i].f&&(i=t);let t=s[i];if(t===end){let i=t;for(n.push(i);i.parent;)n.push(i.parent),i=i.parent;return n.reverse()}s.splice(i,1),e.push(t);let h=t.neighbors;for(let i=0;i<h.length;i++){let n=h[i];if(n.walkable&&!e.includes(n)){let i=t.g+1;if(s.includes(n)){if(i>=n.g)continue}else s.push(n);n.g=i,n.h=this.heuristic(n,end),n.f=n.g+n.h,n.parent=t}}}return[]},PathFinding.prototype.walk=function(i,t,s){var e=i.getPosition().clone(),n=t.clone();if(e.clone().sub(n).length()<.25)return Timer.setTimeout((function(){s()}),500),!1;var h=this.search(e,t);if(!h)return console.log("An issue with path",e,endPosition),!1;var o=[];for(var r in h)parseInt(r)>0&&o.push(h[r].position);if(0===o.length)return Timer.setTimeout((function(){s()}),500),!1;i.fire("Path:Move",o,s)};var PathMove=pc.createScript("pathMove");PathMove.attributes.add("directionEntity",{type:"entity"}),PathMove.attributes.add("speed",{type:"number",default:.025}),PathMove.attributes.add("turnSpeed",{type:"number",default:.15}),PathMove.prototype.initialize=function(){this.direction=0,this.nextDirection=90,this.randomizedVector=new pc.Vec3,this.isMoving=!1,this.isFocusing=!1,this.path=[],this.isReached=!1,this.destination=!1,this.entity.on("Path:Move",this.setPath,this),this.entity.on("Path:Stop",this.stopMoving,this),this.entity.on("Path:Focus",this.setFocus,this)},PathMove.prototype.stopMoving=function(){this.isMoving=!1,this.path=[],this.isFocusing=!1},PathMove.prototype.setFocus=function(t){this.isFocusing=t},PathMove.prototype.update=function(t){var i=this.entity.getPosition();if(this.isFocusing){var s=this.isFocusing.getPosition();this.nextDirection=Utils.lookAt(i.x,i.z,s.x,s.z)}if((this.isFocusing||this.isMoving)&&(this.direction=Utils.rotate(this.direction,this.nextDirection,this.turnSpeed)),this.directionEntity.setLocalEulerAngles(0,this.direction*pc.math.RAD_TO_DEG,0),this.isMoving&&this.path.length>0){s=this.path[0].clone().add(this.randomizedVector);var e=(new pc.Vec3).sub2(s,i),h=this.entity.getPosition().clone();this.nextDirection=Utils.lookAt(h.x,h.z,s.x,s.z),e.length()<.15?this.path.shift():(e.normalize().scale(this.speed*t*60),this.entity.translateLocal(e))}!this.isReached&&0===this.path.length&&this.destination&&(this.isReached=!0,this.entity.fire("Path:Reach",this.destination),this.reachCallback&&(this.reachCallback(),this.reachCallback=null)),this.entity.fire("Path:State",this.isMoving)},PathMove.prototype.setPath=function(t,i){if(this.isReached=!1,t.length>0){this.path=t,this.reachCallback=i,this.destination=t[t.length-1];var s=this.entity.getPosition(),e=this.path[this.path.length-1].clone();(new pc.Vec3).sub2(e,s).length()>.1&&(this.isFocusing=!1,this.isMoving=!0)}else this.isFocusing=!1,this.isMoving=!1};var Minion=pc.createScript("minion");Minion.attributes.add("characterEntity",{type:"entity"}),Minion.prototype.initialize=function(){this.entity.on("Behaviour:FIND_TREE",this.onFindTree,this),this.entity.on("Behaviour:WALK_TO",this.walkTo,this),this.entity.on("Behaviour:CHOP",this.chop,this),this.entity.on("Behaviour:DECIDE_DROP",this.decideDrop,this),this.entity.on("Behaviour:DROP_ITEM",this.dropItem,this),this.entity.on("Path:Move",this.onMove,this),this.entity.on("Path:Reach",this.onReach,this)},Minion.prototype.onFindTree=function(t,i){var n=this.app.root.findByTag("Tree").filter((function(t){return t.enabled})),e=Math.floor(Math.random()*n.length);n.length>0?this.entity.fire("Behaviour:Next",n[e]):this.entity.fire("Behaviour:Trigger","START")},Minion.prototype.walkTo=function(t,i){if(!t)return!1;this.app.fire("PathFinding:Walk",this.entity,t.getPosition().clone(),i)},Minion.prototype.onMove=function(){this.characterEntity.anim.setBoolean("Running",!0)},Minion.prototype.onReach=function(t){this.characterEntity.anim.setBoolean("Running",!1)},Minion.prototype.chop=function(t){t&&(t.enabled=!1),this.entity.fire("Behaviour:Next")},Minion.prototype.decideDrop=function(t,i){var n=new pc.Vec3(1,0,0);this.app.fire("PathFinding:Walk",this.entity,n,i)},Minion.prototype.dropItem=function(t){this.app.fire("ItemManager:Create","Log",this.entity.getPosition().clone()),this.entity.fire("Behaviour:Next")},Minion.prototype.update=function(t){this.characterEntity.anim.setBoolean("Chopping","CHOP"==this.entity.script.behaviour.state)};var Overlay=pc.createScript("overlay");Overlay.attributes.add("messageHolder",{type:"entity"}),Overlay.attributes.add("messageEntity",{type:"entity"}),Overlay.attributes.add("itemHolder",{type:"entity"}),Overlay.attributes.add("itemEntity",{type:"entity"}),Overlay.attributes.add("ribbonEntity",{type:"entity"}),Overlay.attributes.add("ribbonText",{type:"entity"}),Overlay.attributes.add("transitionEntity",{type:"entity"}),Overlay.attributes.add("keyboardInstructions",{type:"entity"}),Overlay.attributes.add("touchInstructions",{type:"entity"}),Overlay.prototype.initialize=function(){this.itemEntity.enabled=!1,this.app.on("Overlay:Adblock",this.onAdblock,this),this.app.on("Overlay:Message",this.onMessage,this),this.app.on("Overlay:Ribbon",this.onRibbon,this),this.app.on("Overlay:AddItem",this.addItem,this),this.app.on("Overlay:Sound",this.playSound,this),this.app.keyboard.on("keydown",this.onKeydown,this),this.app.touch&&this.app.touch.on("touchstart",this.onTouchStart,this),Utils.isMobile()&&(this.keyboardInstructions.enabled=!1,this.touchInstructions.enabled=!0),Utils.isIOS()&&(this.keyboardInstructions.enabled=!1,this.touchInstructions.enabled=!0),Utils.setOnce("Keyboard")||(this.keyboardInstructions.enabled=!1),Utils.setOnce("Touch")||(this.touchInstructions.enabled=!1),this.transitionEntity.enabled=!0,this.app.on("Mount:Ready",this.onLoaded,this)},Overlay.prototype.onTouchStart=function(){this.touchInstructions.enabled=!1},Overlay.prototype.onLoaded=function(){this.app.fire("Overlay:Loaded")},Overlay.prototype.onAdblock=function(t){this.onMessage("Please disable adblock!")},Overlay.prototype.playSound=function(t){this.entity.sound.play(t)},Overlay.prototype.onKeydown=function(t){t.key!==pc.KEY_UP&&t.key!==pc.KEY_DOWN&&t.key!==pc.KEY_LEFT&&t.key!==pc.KEY_RIGHT&&t.key!==pc.KEY_W&&t.key!==pc.KEY_A&&t.key!==pc.KEY_D&&t.key!==pc.KEY_S||(this.keyboardInstructions.enabled=!1)},Overlay.prototype.addItem=function(t){var e=this.itemEntity.clone();e.findByName("Text").element.text=t,e.enabled=!0,this.itemHolder.addChild(e),Timer.setTimeout((function(t){t.destroy()}),5e3,e)},Overlay.prototype.onMessage=function(t){this.messageHolder.enabled=!0,this.messageEntity.element.text=t,Timer.setTimeout((function(t){t.messageHolder.enabled=!1}),3e3,this)},Overlay.prototype.onRibbon=function(t){this.ribbonEntity.enabled=!0,this.ribbonText.element.text=t,Timer.setTimeout((function(t){t.ribbonEntity.enabled=!1}),5e3,this)};var Timeline=pc.createScript("timeline");Timeline.attributes.add("autoplay",{type:"boolean"}),Timeline.attributes.add("loop",{type:"boolean",default:!1}),Timeline.attributes.add("yoyo",{type:"boolean",default:!1}),Timeline.attributes.add("position",{type:"boolean",default:!1}),Timeline.attributes.add("scale",{type:"boolean",default:!1}),Timeline.attributes.add("rotation",{type:"boolean",default:!1}),Timeline.attributes.add("opacity",{type:"boolean",default:!1}),Timeline.attributes.add("custom",{type:"boolean",default:!1}),Timeline.attributes.add("playSound",{type:"boolean",default:!1}),Timeline.attributes.add("duration",{type:"number",default:1}),Timeline.attributes.add("delay",{type:"number",default:0}),Timeline.attributes.add("repeat",{type:"number",default:0}),Timeline.attributes.add("soundDelay",{type:"number",default:0}),Timeline.attributes.add("rollback",{type:"number",default:0}),Timeline.attributes.add("ease",{type:"string",enum:[{Linear:"Linear"},{QuadraticIn:"QuadraticIn"},{QuadraticOut:"QuadraticOut"},{QuadraticInOut:"QuadraticInOut"},{CubicIn:"CubicIn"},{CubicOut:"CubicOut"},{CubicInOut:"CubicInOut"},{QuarticIn:"QuarticIn"},{QuarticOut:"QuarticOut"},{QuarticInOut:"QuarticInOut"},{QuinticIn:"QuinticIn"},{QuinticOut:"QuinticOut"},{QuinticInOut:"QuinticInOut"},{SineIn:"SineIn"},{SineOut:"SineOut"},{SineInOut:"SineInOut"},{ExponentialIn:"ExponentialIn"},{ExponentialOut:"ExponentialOut"},{ExponentialInOut:"ExponentialInOut"},{CircularIn:"CircularIn"},{CircularOut:"CircularOut"},{CircularInOut:"CircularInOut"},{BackIn:"BackIn"},{BackOut:"BackOut"},{BackInOut:"BackInOut"},{BounceIn:"BounceIn"},{BounceOut:"BounceOut"},{BounceInOut:"BounceInOut"},{ElasticIn:"ElasticIn"},{ElasticOut:"ElasticOut"},{ElasticInOut:"ElasticInOut"}],default:"Linear"}),Timeline.attributes.add("startFrame",{type:"json",schema:[{name:"position",type:"vec3"},{name:"rotation",type:"vec3"},{name:"scale",type:"vec3",default:[1,1,1]},{name:"opacity",type:"number",default:1},{name:"custom",type:"string",description:"For example camera.fov = 40"}]}),Timeline.attributes.add("endFrame",{type:"json",schema:[{name:"position",type:"vec3"},{name:"rotation",type:"vec3"},{name:"scale",type:"vec3",default:[1,1,1]},{name:"opacity",type:"number",default:1},{name:"custom",type:"string",description:"For example camera.fov = 40"}]}),Timeline.prototype.initialize=function(){this.animation={custom:0},this.eventListener=!1,this.app.on("Timeline:"+this.entity.name,this.onPlay,this),this.app.on("Timeline:"+this.entity.name+"@Time",this.setTime,this),this.entity.on("Timeline",this.onPlay,this),this.on("destroy",this.onDestroy,this),this.on("state",this.onStateChange,this),this.autoplay&&this.onPlay()},Timeline.prototype.setTime=function(t){this.duration=t},Timeline.prototype.onStateChange=function(t){!0===t?this.autoplay&&this.onPlay():this.reset()},Timeline.prototype.onDestroy=function(){},Timeline.prototype.getEase=function(){return pc[this.ease]},Timeline.prototype.reset=function(){this.positionFrames&&this.positionFrames.stop(),this.rotationFrames&&this.rotationFrames.stop(),this.scaleFrames&&this.scaleFrames.stop(),this.opacityFrames&&this.opacityFrames.stop(),this.customFrames&&this.customFrames.stop()},Timeline.prototype.setFirstFrame=function(options){var frame=this.startFrame;if(options.isReverse&&(frame=this.endFrame),this.position&&this.entity.setLocalPosition(frame.position),this.rotation&&this.entity.setLocalEulerAngles(frame.rotation),this.scale&&this.entity.setLocalScale(frame.scale),this.opacity&&(this.entity.element.opacity=frame.opacity),this.custom){var parts=frame.custom.split(" = "),query=parts[0],value=parseFloat(parts[1]);this.animation.custom=value,eval("this.entity."+this.custom)}},Timeline.prototype.onComplete=function(){},Timeline.prototype.onPlay=function(_options){var self=this,options={isReverse:!1,delay:this.delay,playSound:this.playSound};"object"==typeof _options&&(options.isReverse=!!_options.isReverse),"object"==typeof _options&&(options.playSound=!!_options.playSound),options.playSound&&Timer.setTimeout((function(t){t.entity.sound.play("Sound")}),1e3*this.soundDelay,this);var frame=this.endFrame;if(options.isReverse&&(options.delay=0,frame=this.startFrame),this.reset(),this.setFirstFrame(options),this.position&&(this.positionFrames=this.entity.tween(this.entity.getLocalPosition()).to({x:frame.position.x,y:frame.position.y,z:frame.position.z},this.duration,this.getEase()).delay(options.delay),this.eventListener||(this.eventListener=this.positionFrames.on("complete",this.onComplete,this)),this.loop&&this.positionFrames.loop(!0),this.yoyo&&this.positionFrames.yoyo(!0),this.repeat>0&&this.positionFrames.repeat(this.repeat),this.positionFrames.start()),this.rotation&&(this.rotationFrames=this.entity.tween(this.entity.getLocalEulerAngles()).rotate({x:frame.rotation.x,y:frame.rotation.y,z:frame.rotation.z},this.duration,this.getEase()).delay(options.delay),this.eventListener||(this.eventListener=this.rotationFrames.on("complete",this.onComplete,this)),this.loop&&this.rotationFrames.loop(!0),this.yoyo&&this.rotationFrames.yoyo(!0),this.repeat>0&&this.rotationFrames.repeat(this.repeat),this.rotationFrames.start()),this.scale&&(this.scaleFrames=this.entity.tween(this.entity.getLocalScale()).to({x:frame.scale.x,y:frame.scale.y,z:frame.scale.z},this.duration,this.getEase()).delay(options.delay),this.eventListener||(this.eventListener=this.scaleFrames.on("complete",this.onComplete,this)),this.loop&&this.scaleFrames.loop(!0),this.yoyo&&this.scaleFrames.yoyo(!0),this.repeat>0&&this.scaleFrames.repeat(this.repeat),this.scaleFrames.start()),this.opacity&&(this.opacityFrames=this.entity.tween(this.entity.element).to({opacity:frame.opacity},this.duration,this.getEase()).delay(options.delay),this.eventListener||(this.eventListener=this.opacityFrames.on("complete",this.onComplete,this)),this.loop&&this.opacityFrames.loop(!0),this.yoyo&&this.opacityFrames.yoyo(!0),this.repeat>0&&this.opacityFrames.repeat(this.repeat),this.opacityFrames.start()),this.custom){var parts=frame.custom.split(" = "),query=parts[0],value=parseFloat(parts[1]);this.customFrames=this.entity.tween(this.animation).to({custom:value},this.duration,this.getEase()).delay(options.delay),this.customFrames.on("update",(function(){eval("this.entity."+query+" = "+self.animation.custom)})),this.customFrames.start()}this.rollback>0&&!options.isReverse&&Timer.setTimeout((function(t){t.onPlay({isReverse:!0})}),1e3*this.rollback,this)};pc.extend(pc,function(){var TweenManager=function(t){this._app=t,this._tweens=[],this._add=[]};TweenManager.prototype={add:function(t){return this._add.push(t),t},update:function(t){for(var i=0,e=this._tweens.length;i<e;)this._tweens[i].update(t)?i++:(this._tweens.splice(i,1),e--);if(this._add.length){for(let t=0;t<this._add.length;t++)this._tweens.indexOf(this._add[t])>-1||this._tweens.push(this._add[t]);this._add.length=0}}};var Tween=function(t,i,e){pc.events.attach(this),this.manager=i,e&&(this.entity=null),this.time=0,this.complete=!1,this.playing=!1,this.stopped=!0,this.pending=!1,this.target=t,this.duration=0,this._currentDelay=0,this.timeScale=1,this._reverse=!1,this._delay=0,this._yoyo=!1,this._count=0,this._numRepeats=0,this._repeatDelay=0,this._from=!1,this._slerp=!1,this._fromQuat=new pc.Quat,this._toQuat=new pc.Quat,this._quat=new pc.Quat,this.easing=pc.Linear,this._sv={},this._ev={}},_parseProperties=function(t){var i;return t instanceof pc.Vec2?i={x:t.x,y:t.y}:t instanceof pc.Vec3?i={x:t.x,y:t.y,z:t.z}:t instanceof pc.Vec4||t instanceof pc.Quat?i={x:t.x,y:t.y,z:t.z,w:t.w}:t instanceof pc.Color?(i={r:t.r,g:t.g,b:t.b},void 0!==t.a&&(i.a=t.a)):i=t,i};Tween.prototype={to:function(t,i,e,s,n,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),s&&this.delay(s),n&&this.repeat(n),r&&this.yoyo(r),this},from:function(t,i,e,s,n,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),s&&this.delay(s),n&&this.repeat(n),r&&this.yoyo(r),this._from=!0,this},rotate:function(t,i,e,s,n,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),s&&this.delay(s),n&&this.repeat(n),r&&this.yoyo(r),this._slerp=!0,this},start:function(){var t,i,e,s;if(this.playing=!0,this.complete=!1,this.stopped=!1,this._count=0,this.pending=this._delay>0,this._reverse&&!this.pending?this.time=this.duration:this.time=0,this._from){for(t in this._properties)this._properties.hasOwnProperty(t)&&(this._sv[t]=this._properties[t],this._ev[t]=this.target[t]);this._slerp&&(this._toQuat.setFromEulerAngles(this.target.x,this.target.y,this.target.z),i=void 0!==this._properties.x?this._properties.x:this.target.x,e=void 0!==this._properties.y?this._properties.y:this.target.y,s=void 0!==this._properties.z?this._properties.z:this.target.z,this._fromQuat.setFromEulerAngles(i,e,s))}else{for(t in this._properties)this._properties.hasOwnProperty(t)&&(this._sv[t]=this.target[t],this._ev[t]=this._properties[t]);this._slerp&&(i=void 0!==this._properties.x?this._properties.x:this.target.x,e=void 0!==this._properties.y?this._properties.y:this.target.y,s=void 0!==this._properties.z?this._properties.z:this.target.z,void 0!==this._properties.w?(this._fromQuat.copy(this.target),this._toQuat.set(i,e,s,this._properties.w)):(this._fromQuat.setFromEulerAngles(this.target.x,this.target.y,this.target.z),this._toQuat.setFromEulerAngles(i,e,s)))}return this._currentDelay=this._delay,this.manager.add(this),this},pause:function(){this.playing=!1},resume:function(){this.playing=!0},stop:function(){this.playing=!1,this.stopped=!0},delay:function(t){return this._delay=t,this.pending=!0,this},repeat:function(t,i){return this._count=0,this._numRepeats=t,this._repeatDelay=i||0,this},loop:function(t){return t?(this._count=0,this._numRepeats=1/0):this._numRepeats=0,this},yoyo:function(t){return this._yoyo=t,this},reverse:function(){return this._reverse=!this._reverse,this},chain:function(){for(var t=arguments.length;t--;)t>0?arguments[t-1]._chained=arguments[t]:this._chained=arguments[t];return this},update:function(t){if(this.stopped)return!1;if(!this.playing)return!0;if(!this._reverse||this.pending?this.time+=t*this.timeScale:this.time-=t*this.timeScale,this.pending){if(!(this.time>this._currentDelay))return!0;this._reverse?this.time=this.duration-(this.time-this._currentDelay):this.time-=this._currentDelay,this.pending=!1}var i=0;(!this._reverse&&this.time>this.duration||this._reverse&&this.time<0)&&(this._count++,this.complete=!0,this.playing=!1,this._reverse?(i=this.duration-this.time,this.time=0):(i=this.time-this.duration,this.time=this.duration));var e,s,n=0===this.duration?1:this.time/this.duration,r=this.easing(n);for(var h in this._properties)this._properties.hasOwnProperty(h)&&(e=this._sv[h],s=this._ev[h],this.target[h]=e+(s-e)*r);if(this._slerp&&this._quat.slerp(this._fromQuat,this._toQuat,r),this.entity&&(this.entity._dirtifyLocal(),this.element&&this.entity.element&&(this.entity.element[this.element]=this.target),this._slerp&&this.entity.setLocalRotation(this._quat)),this.fire("update",t),this.complete){var a=this._repeat(i);return a?this.fire("loop"):(this.fire("complete",i),this.entity&&this.entity.off("destroy",this.stop,this),this._chained&&this._chained.start()),a}return!0},_repeat:function(t){if(this._count<this._numRepeats){if(this._reverse?this.time=this.duration-t:this.time=t,this.complete=!1,this.playing=!0,this._currentDelay=this._repeatDelay,this.pending=!0,this._yoyo){for(var i in this._properties){var e=this._sv[i];this._sv[i]=this._ev[i],this._ev[i]=e}this._slerp&&(this._quat.copy(this._fromQuat),this._fromQuat.copy(this._toQuat),this._toQuat.copy(this._quat))}return!0}return!1}};var BounceOut=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},BounceIn=function(t){return 1-BounceOut(1-t)};return{TweenManager:TweenManager,Tween:Tween,Linear:function(t){return t},QuadraticIn:function(t){return t*t},QuadraticOut:function(t){return t*(2-t)},QuadraticInOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},CubicIn:function(t){return t*t*t},CubicOut:function(t){return--t*t*t+1},CubicInOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},QuarticIn:function(t){return t*t*t*t},QuarticOut:function(t){return 1- --t*t*t*t},QuarticInOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},QuinticIn:function(t){return t*t*t*t*t},QuinticOut:function(t){return--t*t*t*t*t+1},QuinticInOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},SineIn:function(t){return 0===t?0:1===t?1:1-Math.cos(t*Math.PI/2)},SineOut:function(t){return 0===t?0:1===t?1:Math.sin(t*Math.PI/2)},SineInOut:function(t){return 0===t?0:1===t?1:.5*(1-Math.cos(Math.PI*t))},ExponentialIn:function(t){return 0===t?0:Math.pow(1024,t-1)},ExponentialOut:function(t){return 1===t?1:1-Math.pow(2,-10*t)},ExponentialInOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))},CircularIn:function(t){return 1-Math.sqrt(1-t*t)},CircularOut:function(t){return Math.sqrt(1- --t*t)},CircularInOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},BackIn:function(t){var i=1.70158;return t*t*((i+1)*t-i)},BackOut:function(t){var i=1.70158;return--t*t*((i+1)*t+i)+1},BackInOut:function(t){var i=2.5949095;return(t*=2)<1?t*t*((i+1)*t-i)*.5:.5*((t-=2)*t*((i+1)*t+i)+2)},BounceIn:BounceIn,BounceOut:BounceOut,BounceInOut:function(t){return t<.5?.5*BounceIn(2*t):.5*BounceOut(2*t-1)+.5},ElasticIn:function(t){var i,e=.1;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=.4*Math.asin(1/e)/(2*Math.PI),-e*Math.pow(2,10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/.4))},ElasticOut:function(t){var i,e=.1;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=.4*Math.asin(1/e)/(2*Math.PI),e*Math.pow(2,-10*t)*Math.sin((t-i)*(2*Math.PI)/.4)+1)},ElasticInOut:function(t){var i,e=.1,s=.4;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=s*Math.asin(1/e)/(2*Math.PI),(t*=2)<1?e*Math.pow(2,10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/s)*-.5:e*Math.pow(2,-10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/s)*.5+1)}}}()),function(){pc.AppBase.prototype.addTweenManager=function(){this._tweenManager=new pc.TweenManager(this),this.on("update",(function(t){this._tweenManager.update(t)}))},pc.AppBase.prototype.tween=function(t){return new pc.Tween(t,this._tweenManager)},pc.Entity.prototype.tween=function(t,i){var e=this._app.tween(t);return e.entity=this,this.once("destroy",e.stop,e),i&&i.element&&(e.element=i.element),e};var t=pc.AppBase.getApplication();t&&t.addTweenManager()}();var EffectManager=pc.createScript("effectManager");EffectManager.attributes.add("landSmokeEffect",{type:"entity"}),EffectManager.attributes.add("landSmokeSprite",{type:"entity"}),EffectManager.attributes.add("spellEffect",{type:"entity"}),EffectManager.attributes.add("spellSprite",{type:"entity"}),EffectManager.attributes.add("confettiEntity",{type:"entity"}),EffectManager.attributes.add("rainEntity",{type:"entity"}),EffectManager.attributes.add("razorEntity",{type:"entity"}),EffectManager.prototype.initialize=function(){this.lastRainTime=Date.now()-5e4,this.rainEntity.enabled=!1,this.lastRainDelay=0,this.app.on("EffectManager:LandSmoke",this.playLandSmoke,this),this.app.on("EffectManager:Spell",this.playSpellEffect,this),this.app.on("EffectManager:Confetti",this.playConfetti,this),this.app.on("EffectManager:Razor",this.playRazor,this)},EffectManager.prototype.playLandSmoke=function(t){this.landSmokeEffect.setPosition(t),this.landSmokeSprite.sprite.stop(),this.landSmokeSprite.sprite.play("Fire")},EffectManager.prototype.playConfetti=function(t){this.confettiEntity.setPosition(t),this.confettiEntity.sound.play("Tada"),this.confettiEntity.particlesystem.stop(),this.confettiEntity.particlesystem.reset(),this.confettiEntity.particlesystem.play()},EffectManager.prototype.playSpellEffect=function(t){this.spellEffect.setPosition(t),this.spellSprite.sprite.stop(),this.spellSprite.sprite.play("Fire")},EffectManager.prototype.playRazor=function(t){this.razorEntity.setPosition(t),this.razorEntity.enabled=!0,this.razorEntity.particlesystem.reset(),this.razorEntity.particlesystem.play(),this.razorEntity.sound.play("Razor")},EffectManager.prototype.update=function(t){Date.now()-this.lastRainTime>1e3*(80+this.lastRainDelay)&&(this.rainEntity.enabled=!0,Timer.setTimeout((function(t){t.rainEntity.enabled=!1}),28e3,this),this.lastRainDelay+=100,this.lastRainTime=Date.now())};var Motion=pc.createScript("motion");Motion.attributes.add("motions",{type:"json",schema:[{name:"name",type:"string"},{name:"position",type:"curve",curves:["x","y","z"]},{name:"rotation",type:"curve",curves:["x","y","z"]},{name:"scale",type:"curve",curves:["x","y","z"]},{name:"speed",type:"number",default:1},{name:"autoplay",type:"boolean",default:!1},{name:"loop",type:"boolean",default:!1}],array:!0}),Motion.attributes.add("events",{type:"json",schema:[{name:"animationName",type:"string"},{name:"eventName",type:"string"},{name:"time",type:"number",default:1},{name:"type",type:"string",default:"Anytime",enum:[{Anytime:"Anytime"},{Start:"Start"},{End:"End"}]}],array:!0}),Motion.attributes.add("lerp",{type:"number",default:.5}),Motion.prototype.initialize=function(){this.timestamp=0,this.currentSpeed=0,this.currentMotion=!1,this.isReverting=!1,this.startPosition=this.entity.getLocalPosition().clone(),this.startRotation=this.entity.getLocalEulerAngles().clone(),this.startScale=this.entity.getLocalScale().clone(),this.position=new pc.Vec3(0,0,0),this.rotation=new pc.Vec3(0,0,0),this.scale=new pc.Vec3(0,0,0),this.motions.length>0&&this.motions[0].autoplay&&this.onMotionPlay(this.motions[0].name),this.app.on("Motion",this.onMotionPlay,this),this.app.on("Motion:Stop",this.onMotionStop,this),this.entity.on("Motion",this.onMotionPlay,this),this.entity.on("Motion:Play",this.onMotionPlay,this),this.entity.on("Motion:Stop",this.onMotionStop,this)},Motion.prototype.findMotion=function(t){var i=!1;for(var n in this.motions){var e=this.motions[n];e.name==t&&(i=e)}return i},Motion.prototype.onMotionStop=function(t){this.currentMotion&&this.currentMotion.name==t&&(this.isPlaying=!1,this.currentMotion=!1)},Motion.prototype.onMotionPlay=function(t,i){if(!i&&this.currentMotion&&this.currentMotion.name==t)return!1;var n=this.findMotion(t);if(!n)return!1;this.isPlaying=!0,this.timestamp=0,this.currentMotion=n,this.triggerStartEvent(this.currentMotion)},Motion.prototype.triggerEvents=function(t){for(var i in this.events){var n=this.events[i],e=n.time;n.animationName==this.currentMotion.name&&e>this.timestamp&&e<=this.timestamp+t&&this.app.fire(n.eventName)}},Motion.prototype.findEventByMotion=function(t,i){for(var n in this.events){var e=this.events[n];if(e.animationName==t.name&&e.type==i)return e}},Motion.prototype.triggerStartEvent=function(t){var i=this.findEventByMotion(t,"Start");i&&this.app.fire(i.eventName)},Motion.prototype.triggerEndEvent=function(t){var i=this.findEventByMotion(t,"End");i&&this.app.fire(i.eventName)},Motion.prototype.update=function(t){if(!this.isPlaying)return!1;if(!this.currentMotion)return!1;var i=this.currentMotion.position.value(this.timestamp),n=this.currentMotion.rotation.value(this.timestamp),e=this.currentMotion.scale.value(this.timestamp);this.position=this.position.lerp(this.position,new pc.Vec3(i[0],i[1],i[2]),this.lerp),this.rotation=this.rotation.lerp(this.rotation,new pc.Vec3(n[0],n[1],n[2]),this.lerp),this.scale=this.scale.lerp(this.scale,new pc.Vec3(e[0],e[1],e[2]),this.lerp),this.entity.setLocalPosition(this.position.clone().add(this.startPosition)),this.entity.setLocalEulerAngles(this.rotation.clone().add(this.startRotation)),this.entity.setLocalScale(this.scale.clone().add(this.startScale)),this.triggerEvents(t),this.timestamp>=1&&(this.isPlaying=!1,this.currentMotion.loop?this.onMotionPlay(this.currentMotion.name,!0):(this.triggerEndEvent(this.currentMotion),this.currentMotion=!1)),this.isReverting?(this.timestamp-=t*this.currentMotion.speed,this.timestamp<=0&&(this.triggerEndEvent(this.currentMotion),this.currentMotion=!1,this.isPlaying=!1,this.isReverting=!1)):this.timestamp+=t*this.currentMotion.speed,this.timestamp=Math.max(this.timestamp,0),this.timestamp=Math.min(this.timestamp,1)};var Workbench=pc.createScript("workbench");Workbench.attributes.add("recipes",{type:"string",array:!0}),Workbench.attributes.add("slot1",{type:"entity"}),Workbench.attributes.add("slot2",{type:"entity"}),Workbench.prototype.initialize=function(){this.addedItems=[],this.slot1.on("Added",this.onAdded,this),this.slot2.on("Added",this.onAdded,this)},Workbench.prototype.onAdded=function(t){this.addedItems.push(t),this.afterAdded()},Workbench.prototype.afterAdded=function(){console.log(this.addedItems)};var TextBackground=pc.createScript("textBackground");TextBackground.attributes.add("textEntity",{type:"entity"}),TextBackground.attributes.add("padding",{type:"number",default:10}),TextBackground.prototype.initialize=function(){},TextBackground.prototype.update=function(t){this.entity.element.width=this.textEntity.element.width+this.padding};var Behaviour=pc.createScript("behaviour");Behaviour.attributes.add("pathEntity",{type:"entity"}),Behaviour.attributes.add("states",{type:"json",schema:[{name:"event",type:"string"},{name:"walk",type:"boolean",default:!1},{name:"next",type:"string"},{name:"delay",type:"number",default:.1}],array:!0}),Behaviour.prototype.initialize=function(){this.delay=0,this.lastTrigger=Date.now(),this.behaviorTimer=!1,this.walkCallback=!1,this.entity.on("Behaviour:Trigger",this.onTrigger,this),this.entity.on("Behaviour:Callback",this.onCallback,this),this.entity.fire("Behaviour:Trigger","START")},Behaviour.prototype.onTrigger=function(t,e){var i=this,a=this.states.find((function(e){return e.event===t}));a&&(a.walk?(this.willWalk=a.walk,this.nextEvent=a.next,this.walkCallback=function(){i.executeEvent(i.nextEvent,e)},Timer.clearTimeout(this.timer),this.timer=Timer.setTimeout((function(t,i){t.walkTo(e)}),1e3*a.delay,this,a)):(Timer.clearTimeout(this.timer),this.timer=Timer.setTimeout((function(t,i){t.executeEvent(i.next,e)}),1e3*a.delay,this,a)))},Behaviour.prototype.executeEvent=function(t,e){var i=this.states.find((function(e){return t==e.event}));i&&(this.willWalk=i.walk,this.nextEvent=i.next,this.delay=i.delay),this.entity.fire("Behaviour:"+t,e),this.currentEventName=t},Behaviour.prototype.onCallback=function(t){this.timer=Timer.setTimeout((function(e){e.completeCallback(t)}),1e3*this.delay,this)},Behaviour.prototype.completeCallback=function(t){var e=this;this.nextEvent&&(this.willWalk?(this.walkCallback=function(){e.executeEvent(e.nextEvent,t)},this.walkTo(t)):this.executeEvent(this.nextEvent,t))},Behaviour.prototype.walkTo=function(t){return!!t&&(t.getPosition?void this.pathEntity.fire("PathFinding:Walk",this.entity,t.getPosition().clone(),this.walkCallback):(console.log("Failed position data"),!1))},Behaviour.prototype.onNextTrigger=function(t){this.callback&&(this.callback(t),this.callback=!1)};var ItemManager=pc.createScript("itemManager");ItemManager.attributes.add("holderEntity",{type:"entity"}),ItemManager.prototype.initialize=function(){this.items=this.entity.findByTag("Item"),this.entities=[],this.app.on("ItemManager:Create",this.onCreate,this)},ItemManager.prototype.getByName=function(t){var e=[];for(var i in this.items){var n=this.items[i];n.name==t&&e.push(n)}return e},ItemManager.prototype.onCreate=function(t,e,i){var n=this,a=Utils.getRandom(this.getByName(t)).clone();a.enabled=!0,this.app.fire("EffectManager:LandSmoke",e.clone()),i?(a.setLocalPosition(0,0,0),i.addChild(a)):(a.setLocalPosition(e.x,0,e.z),this.holderEntity.addChild(a)),this.entities.push(a),this.app.fire("Camera:Focus",a),a.on("destroy",(function(){n.entities.splice(n.entities.indexOf(a),1)}))},ItemManager.prototype.isPositionAvailable=function(t){for(var e=0;e<this.entities.length;e++){if(this.entities[e].getPosition().sub(t).length()<.5)return!1}return!0};var World2ScreenAnimate=pc.createScript("world2ScreenAnimate");World2ScreenAnimate.attributes.add("elements",{type:"entity",array:!0}),World2ScreenAnimate.attributes.add("speed",{type:"number",default:1}),World2ScreenAnimate.attributes.add("randomModifier",{type:"number",default:0}),World2ScreenAnimate.attributes.add("scaleCurve",{type:"curve",curves:["x"]}),World2ScreenAnimate.attributes.add("cameraEntity",{type:"entity"}),World2ScreenAnimate.attributes.add("holderEntity",{type:"entity"}),World2ScreenAnimate.prototype.initialize=function(){this.movingElements=[],this.elements.forEach((function(e){e.enabled=!1})),this.app.on("World2Screen:Animate",this.onCollect,this)},World2ScreenAnimate.prototype.onCollect=function(e,t,n){var i=this.getElementByName(e);if(i){var r=this.getScreenPosition(t),a=n.getPosition().clone(),o=i.clone(),s=(Math.random()-Math.random())*this.randomModifier;o.setLocalPosition(r.x+s,r.y+s,0),o.enabled=!0,this.movingElements.push({timestamp:0,element:o,screenPosition:r,destinationPosition:a}),this.holderEntity.addChild(o)}},World2ScreenAnimate.prototype.getScreenPosition=function(e){if(!this.cameraEntity)return console.warn("Camera doesnt exist!"),!1;var t=new pc.Vec3,n=this.cameraEntity.camera,i=this.app.graphicsDevice.maxPixelRatio,r=this.entity.screen.scale,a=this.app.graphicsDevice;return n?(n.worldToScreen(e,t),t.x*=i,t.y*=i,new pc.Vec2(t.x/r,(a.height-t.y)/r)):(console.warn("Camera doesnt exist!"),!1)},World2ScreenAnimate.prototype.getElementByName=function(e){for(var t=0;t<this.elements.length;t++)if(this.elements[t].name===e)return this.elements[t];return null},World2ScreenAnimate.prototype.update=function(e){for(var t=this.movingElements.length;t--;){var n=this.movingElements[t];if(n&&(n.timestamp+=e*this.speed,n.timestamp>0)){var i=n.timestamp,r=this.scaleCurve.value(i),a=n.element.getPosition();i>.25&&a.lerp(a,n.destinationPosition,.1),n.element.setPosition(a),n.element.setLocalScale(r,r,r),i>=1&&(this.movingElements.splice(t,1),n.element.destroy())}}};var World2Screen=pc.createScript("world2Screen");World2Screen.attributes.add("cameraEntity",{type:"entity"}),World2Screen.attributes.add("holderEntity",{type:"entity"}),World2Screen.attributes.add("display",{type:"entity",array:!0}),World2Screen.prototype.postInitialize=function(){this.interactions=[],this.frameDrawn=0,this.nextFrameVisible=!1,this.app.on("World2Screen:Clone",this.cloneInteraction,this),this.app.on("World2Screen:Show",this.addInteraction,this),this.app.on("World2Screen:Visible",this.visibleInteraction,this),this.app.on("World2Screen:Hide",this.removeInteraction,this),this.hideAllDisplays(),this.on("destroy",this.onDestroy,this)},World2Screen.prototype.hideAllDisplays=function(){for(var e in this.display){this.display[e].enabled=!1}},World2Screen.prototype.onDestroy=function(){this.app.off("World2Screen:Show",this.setInteraction,this)},World2Screen.prototype.getInteractionDisplay=function(e){var t=!1;for(var i in this.display){var n=this.display[i];n.name==e&&(t=n)}return t},World2Screen.prototype.removeInteraction=function(e,t){var i=this.getInteractionDisplay(e);i&&(i.enabled=!1,i.entity=!1)},World2Screen.prototype.addInteraction=function(e,t,i,n){var r=this.getInteractionDisplay(e);r&&(r.entity!=t&&(r.enabled=!1),r.offset=i||new pc.Vec3(0,0,0),r.entity=t,r.type=e,r.enabled=!0,r.createdAt=Date.now(),n>0&&(Timer.clearTimeout(this.interactionTimer),this.interactionTimer=Timer.setTimeout((function(t){t.removeInteraction(e)}),1e3*n,this)))},World2Screen.prototype.cloneInteraction=function(e,t,i,n,r){var o=this.getInteractionDisplay(e),a=this;o&&((o=o.clone()).name=t._guid,o.enabled=!0,o.offset=i||new pc.Vec3(0,0,0),o.entity=t,o.type=e,o.enabled=!0,o.createdAt=Date.now(),o.destroyAfter=r,n&&n(o),t.parentDisplay=o,t.on("destroy",(function(){o.destroy(),a.display.splice(a.display.indexOf(o),1)})),this.holderEntity.addChild(o),this.display.push(o))},World2Screen.prototype.visibleInteraction=function(e,t,i){this.addInteraction(e,t,i),this.frameDrawn=0,this.nextFrameVisible=e},World2Screen.prototype.updateInteraction=function(e){if(!this.cameraEntity)return!1;var t=new pc.Vec3,i=this.cameraEntity.camera,n=this.app.graphicsDevice.maxPixelRatio,r=this.entity.screen.scale,o=this.app.graphicsDevice;if(!i)return!1;if(!e.entity)return!1;if(e.offset&&e.offset.name?i.worldToScreen(e.offset.getPosition().clone(),t):i.worldToScreen(e.entity.getPosition().clone().add(e.offset),t),t.x*=n,t.y*=n,void 0!==e.visible&&!1===e.visible)return e.setLocalPosition(-1e3,-1e3,0),!1;if(t.x>0&&t.x<this.app.graphicsDevice.width&&t.y>0&&t.y<this.app.graphicsDevice.height&&t.z>0?(e.setLocalPosition(t.x/r,(o.height-t.y)/r,0),e.enabled=e.entity.enabled):e.enabled=!1,e.destroyAfter>0&&Date.now()-e.createdAt>1e3*e.destroyAfter){this.display.indexOf(e);e.destroy()}},World2Screen.prototype.update=function(e){for(var t=this.display.length;t--;){var i=this.display[t];i&&this.updateInteraction(i)}this.nextFrameVisible&&this.frameDrawn>0&&this.removeInteraction(this.nextFrameVisible),this.frameDrawn++};var Mount=pc.createScript("mount");Mount.prototype.initialize=function(){Timer.setTimeout((function(){pc.app.fire("Mount:Ready")}),60)};var TutorialManager=pc.createScript("tutorialManager");TutorialManager.attributes.add("stations",{type:"json",schema:[{name:"sortIndex",type:"number",default:0},{name:"price",type:"number",default:10},{name:"buildingAnimation",type:"string",enum:[{Hammer:"Hammer"},{Whistle:"Whistle"}],default:"Hammer"},{name:"icon",type:"asset"},{name:"typeIcon",type:"asset"},{name:"showPrice",type:"boolean",default:!1},{name:"autoplay",type:"boolean",default:!1},{name:"upgrades",type:"entity",array:!0},{name:"minUpgradeCount",type:"number",default:0},{name:"priceMultiplier",type:"number",default:0},{name:"upgradeLevel",type:"number",default:0},{name:"shadow",type:"entity"}],array:!0}),TutorialManager.attributes.add("cursorEntity",{type:"entity"}),TutorialManager.attributes.add("buildingEntity",{type:"entity"}),TutorialManager.attributes.add("gridEntity",{type:"entity"}),TutorialManager.attributes.add("isDebug",{type:"boolean",default:!1}),TutorialManager.prototype.clearLevels=function(){this.levelStations=this.app.root.findByTag(this.entity.name);for(var e=0;e<this.levelStations.length;e++)this.levelStations[e].enabled=!1},TutorialManager.prototype.initialize=function(){this.stations.sort((function(e,t){return e.sortIndex-t.sortIndex})),this.isDebug&&this.logAllPrices(),this.currentIndex=0,this.alreadyCompleted=!1,this.entity.on("Ready",this.onReady,this)},TutorialManager.prototype.onReady=function(){if(this.alreadyCompleted)return!1;var e=Utils.getItemAsArray("Stations_"+this.entity.name);e.length>0?this.restore(e):this.setStation(),this.alreadyCompleted=!0},TutorialManager.prototype.restore=function(e){var t=e.length-1,a=!1;for(var i in e){var r=e[i],n=this.getStationByName(r.name);if(parseInt(i)===e.length-1&&r.isBranched&&(t++,a=!0),parseInt(i)===e.length-1&&!r.isBranched&&r.upgrades>=n.upgrades.length&&(t++,a=!0),r.upgrades>0){for(var o=0;o<r.upgrades;o++)n.upgrades[o].enabled=!0;n.upgradeLevel=r.upgrades,r.upgrades<=n.upgrades.length&&this.createCursor(n),n.shadow&&(n.shadow.enabled=!1)}}this.currentIndex=t,a&&this.setStation()},TutorialManager.prototype.setStation=function(){var e=this.stations[this.currentIndex];e&&this.createCursor(e)},TutorialManager.prototype.serialize=function(){return this.stations.map((function(e){return{name:e.upgrades[0].name,upgrades:e.upgradeLevel,isBranched:e.isBranched}})).filter((function(e){return e.upgrades>0}))},TutorialManager.prototype.onComplete=function(e,t){var a=t>0?t:2500;if(e.upgradeLevel>e.upgrades.length-1)return!1;var i=e.upgrades[e.upgradeLevel];this.playCompleteAnimation(i,e.buildingAnimation),e.upgradeLevel++,(e.minUpgradeCount>0&&e.upgradeLevel>=e.minUpgradeCount||e.upgradeLevel>e.upgrades.length-1)&&(e.isBranched||(this.currentIndex++,Timer.setTimeout((function(e){e.setStation()}),a,this),e.isBranched=!0)),e.upgrades.length>e.upgradeLevel&&Timer.setTimeout((function(t){t.createCursor(e)}),a,this),Utils.setItem("Stations_"+this.entity.name,JSON.stringify(this.serialize()))},TutorialManager.prototype.quickComplete=function(e){},TutorialManager.prototype.playCompleteAnimation=function(e,t){var a=2;"Hammer"==t&&(this.buildingEntity.enabled=!0,this.buildingEntity.setPosition(e.getPosition()),this.buildingEntity.fire("Play"),a=2),"Whistle"==t&&(this.app.fire("EffectManager:Spell",e.getPosition().clone()),a=0),this.app.fire("World2Screen:Clone",t,this.buildingEntity,!1,!1,2),this.app.fire("Overlay:Sound",t),Timer.setTimeout((function(a){a.buildingEntity.enabled=!1,e.enabled=!0,pc.app.fire("Motion","LittleShake"),pc.app.fire("Overlay:Sound",t+"-Complete")}),1e3*a,this)},TutorialManager.prototype.createCursor=function(e){var t=e.upgrades[e.upgradeLevel];if(!t)return!1;var a=this.cursorEntity.clone();a.setPosition(t.getPosition().clone()),a.enabled=!0,this.app.root.addChild(a),a.fire("Define",e,this.entity),Timer.clearTimeout(this.focusTimer),this.focusTimer=Timer.setTimeout((function(e){pc.app.fire("Camera:Focus",t)}),1e3,this),e&&e.shadow&&(e.shadow.enabled=!1)},TutorialManager.prototype.getStationByName=function(e){for(var t=0;t<this.stations.length;t++)if(this.stations[t].upgrades[0].name==e)return this.stations[t];return!1},TutorialManager.prototype.getPrice=function(e,t){return e.price+Math.round(Math.pow(e.price,e.priceMultiplier*t))-1},TutorialManager.prototype.logAllPrices=function(){for(var e=0;e<this.stations.length;e++)for(var t=this.stations[e],a=0;a<t.upgrades.length;a++)console.log(t.upgrades[a].name+" - "+a+" : "+this.getPrice(t,a))};var MoneyManager=pc.createScript("moneyManager");MoneyManager.attributes.add("startMoney",{type:"number",default:8}),MoneyManager.attributes.add("moneyColor",{type:"entity"}),MoneyManager.attributes.add("noMoneyAlert",{type:"entity"}),MoneyManager.attributes.add("moneyEntity",{type:"entity"}),MoneyManager.attributes.add("playerEntity",{type:"entity"}),MoneyManager.attributes.add("payPoint",{type:"entity"}),MoneyManager.attributes.add("coinEntity",{type:"entity"}),MoneyManager.attributes.add("alerts",{type:"entity",array:!0}),MoneyManager.prototype.initialize=function(){this.money=this.startMoney,this.totalMoney=this.startMoney,this.lastMoneySave=-1,this.notifications={},Utils.getItem("Money")&&(this.money=parseInt(Utils.getItem("Money"))),isNaN(this.money)&&(this.money=0),this.app.on("Money:Remove",this.remove,this),this.app.on("Money:Add",this.add,this),this.app.on("Money:Has",this.has,this),this.app.on("Money:NoMoney",this.showNoMoney,this),this.payMultiplier=1,this.app.on("Money:Pay",this.pay,this),this.app.on("Money:SetPayMultiplier",this.onSetPayMultiplier,this),this.updateMoney(),this.renderAlerts(),pc.MoneyManager=this},MoneyManager.prototype.onSetPayMultiplier=function(t){this.payMultiplier=parseInt(t)},MoneyManager.prototype.pay=function(t,e,n){var o=this,i=this.payPoint.getPosition();t*=this.payMultiplier,e&&(i=e.getPosition());for(var a=0;a<t;a++){var s=this.coinEntity.clone();s.setLocalPosition(i.clone().add(new pc.Vec3(Math.random()-Math.random(),0,Math.random()-Math.random()))),s.enabled=!0,s.on("Trigger",(function(){o.notifications[n]&&o.notifications[n]--,o.renderAlerts()})),s.script.coin.type=n,this.entity.addChild(s),this.notifications[n]?this.notifications[n]++:this.notifications[n]=1,this.renderAlerts()}this.entity.sound.play("Pay")},MoneyManager.prototype.renderAlerts=function(){for(var t=this.alerts.length;t--;){var e=this.alerts[t];this.notifications[e.name]?(e.enabled=!0,this.notifications[e.name]>e.findByName("Number").element.text&&e.findByName("Notify").fire("Timeline")):e.enabled=!1}},MoneyManager.prototype.showNoMoney=function(){this.noMoneyAlert.enabled||(this.entity.sound.play("NoMoney"),this.noMoneyAlert.enabled=!0,this.noMoneyTimer=Timer.setTimeout((function(t){t.noMoneyAlert.enabled=!1}),1e3,this))},MoneyManager.prototype.has=function(t,e,n){var o=parseInt(t);this.money>=o?e&&e():n&&n()},MoneyManager.prototype.remove=function(t){t<=this.money&&(this.money-=parseInt(t)),this.updateMoney(),this.entity.sound.play("Remove")},MoneyManager.prototype.add=function(t,e){this.money+=parseInt(t),this.totalMoney+=parseInt(t),this.updateMoney(),this.entity.sound.play("Add"),this.app.fire("Money:Added",t,this.money),this.notifications[e]&&this.notifications[e]--,this.renderAlerts()},MoneyManager.prototype.updateMoney=function(){this.moneyEntity.element.text=this.money+"",Date.now()-this.lastMoneySave>1e3&&(Utils.setItem("Money",this.money),this.lastMoneySave=Date.now()),this.money<=0?this.moneyColor.element.color=pc.Color.RED:this.moneyColor.element.color=pc.Color.BLACK};var Rotate=pc.createScript("rotate");Rotate.attributes.add("axis",{type:"string",enum:[{x:"x"},{y:"y"},{z:"z"}]}),Rotate.attributes.add("speed",{type:"number"}),Rotate.attributes.add("waveStyle",{type:"boolean"}),Rotate.attributes.add("waveWidth",{type:"number"}),Rotate.attributes.add("children",{type:"boolean"}),Rotate.attributes.add("graphName",{type:"string"}),Rotate.prototype.initialize=function(){this.currentElement=this.entity,this.timestamp=0,this.children&&(this.currentElement=this.entity.findByName(this.graphName))},Rotate.prototype.update=function(t){var e=this.speed*(60*t);this.waveStyle&&(e=Math.cos(this.timestamp*this.speed)*this.waveWidth,this.timestamp+=60*t),this.currentElement?("x"==this.axis&&this.currentElement.rotateLocal(e,0,0),"y"==this.axis&&this.currentElement.rotateLocal(0,e,0),"z"==this.axis&&this.currentElement.rotateLocal(0,0,e)):this.children&&(this.currentElement=this.entity.findByName(this.graphName))};var Item=pc.createScript("item");Item.attributes.add("modelEntity",{type:"entity"}),Item.attributes.add("shadowEntity",{type:"entity"}),Item.prototype.initialize=function(){this.entity.on("Ground",this.onGround,this),this.entity.on("Dropped",this.onDrop,this),this.entity.on("CarriedBy",this.onDrop,this)},Item.prototype.onDrop=function(){this.modelEntity&&this.modelEntity.script&&this.modelEntity.script.rotate&&(this.modelEntity.script.rotate.enabled=!1),this.shadowEntity.enabled=!1},Item.prototype.onGround=function(){this.modelEntity&&this.modelEntity.script&&this.modelEntity.script.rotate&&(this.modelEntity.script.rotate.enabled=!0),this.shadowEntity.enabled=!0};var Shelf=pc.createScript("shelf");Shelf.attributes.add("type",{type:"string",default:"Fruit"}),Shelf.attributes.add("eatingPoint",{type:"entity"}),Shelf.attributes.add("allowSpawn",{type:"entity"}),Shelf.attributes.add("eatingParticle",{type:"entity"}),Shelf.attributes.add("requestCustomer",{type:"string",default:"Hungry"}),Shelf.prototype.initialize=function(){this.eatingPoint.enabled=!0,this.reservedBy=!1,this.app.fire("Player:SecureSpawn",this.entity),this.offset=new pc.Vec3(0,1.25,0),this.entity.on("Added",this.onAdded,this),this.entity.on("Eat",this.onConsume,this),this.entity.on("Reserved",this.onReserved,this),this.entity.on("Leave",this.onLeave,this),this.app.on("Mount:Ready",this.showIcon,this),this.showIcon()},Shelf.prototype.showIcon=function(){this.allowSpawn&&this.allowSpawn.fire("Allow")},Shelf.prototype.onConsume=function(t,e){this.entity.script.droppable.itemArray.length>0?(this.doConsume(),t()):e&&(this.waitingForItem=t,e())},Shelf.prototype.onAdded=function(t){this.entity.fire("Droppable:State",!1),this.app.fire("Shelf",t.name),this.app.fire("EffectManager:LandSmoke",this.entity.getPosition().clone().add(new pc.Vec3(0,.75,0))),this.waitingForItem&&(this.doConsume(),this.waitingForItem(),this.waitingForItem=!1)},Shelf.prototype.onReserved=function(t){this.eatingPoint.enabled=!1,this.reservedBy=t},Shelf.prototype.doConsume=function(){this.reservedBy&&(this.reservedBy.fire("StartEating",this.entity.script.droppable.itemArray[0]),this.eatingParticle.particlesystem.reset(),this.eatingParticle.particlesystem.play(),this.entity.sound.play("Eating")),Timer.setTimeout((function(t){t.entity.sound.stop("Eating"),t.eatingParticle.particlesystem.stop(),t.reservedBy.fire("FinishEating"),t.reservedBy=!1,t.entity.fire("Droppable:State",!0),t.entity.fire("Clear"),t.eatingPoint.enabled=!0}),6500,this)},Shelf.prototype.onLeave=function(){},Shelf.prototype.update=function(){this.reservedBy||"None"==this.requestCustomer||this.app.fire("CustomerManager:Request",this.requestCustomer,1e3)};var Gameplay=pc.createScript("gameplay");Gameplay.attributes.add("pauseEntity",{type:"entity"}),Gameplay.attributes.add("playEntity",{type:"entity"}),Gameplay.attributes.add("lightEntity",{type:"entity"}),Gameplay.attributes.add("resetPopupEntity",{type:"entity"}),Gameplay.attributes.add("transitionEntity",{type:"entity"}),Gameplay.attributes.add("musicVolumeSlider",{type:"entity"}),Gameplay.attributes.add("gameVolumeSlider",{type:"entity"}),Gameplay.prototype.initialize=function(){this.isPaused=!1,this.transitionEntity.enabled=!0,this.lastMidroll=Date.now(),this.musicVolume=Utils.getItemAsFloat("MusicVolume",1),this.gameVolume=Utils.getItemAsFloat("GameVolume",.5),this.musicVolumeSlider.scrollbar.value=this.musicVolume,this.gameVolumeSlider.scrollbar.value=this.gameVolume,this.musicVolumeSlider.scrollbar.on("set:value",this.updateVolumes,this),this.gameVolumeSlider.scrollbar.on("set:value",this.updateVolumes,this),this.updateVolumes(),this.app.on("Gameplay:Pause",this.onPause,this),this.app.on("Gameplay:Play",this.onPlay,this),this.app.on("Gameplay:PausePlay",this.onPausePlay,this),this.app.on("Gameplay:Reset",this.onReset,this),this.app.on("Gameplay:ShowResetPopup",this.showResetPopup,this),this.app.on("Gameplay:CloseResetPopup",this.closeResetPopup,this)},Gameplay.prototype.updateVolumes=function(){this.musicVolume=this.musicVolumeSlider.scrollbar.value,this.gameVolume=this.gameVolumeSlider.scrollbar.value,this.entity.sound.slots.Music.volume=this.musicVolume,this.app.systems.sound.originalVolume=Number(this.gameVolume),this.app.systems.sound.volume=this.gameVolume,Utils.setItem("MusicVolume",this.musicVolume),Utils.setItem("GameVolume",this.gameVolume)},Gameplay.prototype.showResetPopup=function(){this.resetPopupEntity.enabled=!0},Gameplay.prototype.closeResetPopup=function(){this.resetPopupEntity.enabled=!1},Gameplay.prototype.onReset=function(){window.localStorage.clear(),window.location.reload()},Gameplay.prototype.onPausePlay=function(){this.isPaused?PokiPlugin.playGame():PokiPlugin.pauseGame()},Gameplay.prototype.onPause=function(){this.isPaused=!0,this.pauseEntity&&(this.pauseEntity.enabled=!this.isPaused,this.playEntity.enabled=this.isPaused)},Gameplay.prototype.onPlay=function(){this.isPaused=!1,this.pauseEntity&&(this.pauseEntity.enabled=!this.isPaused,this.playEntity.enabled=this.isPaused)},Gameplay.prototype.update=function(t){"undefined"!=typeof PokiPlugin&&PokiPlugin.tick(t)};var Button=pc.createScript("button");Button.attributes.add("action",{type:"string"}),Button.attributes.add("value",{type:"string"}),Button.attributes.add("cooldown",{type:"number",default:0}),Button.attributes.add("hoverStateEvent",{type:"boolean",default:!1}),Button.attributes.add("lockAfterAction",{type:"boolean",default:!1}),Button.attributes.add("hoverAction",{type:"string"}),Button.attributes.add("leaveAction",{type:"string"}),Button.attributes.add("hoverColor",{type:"rgb"}),Button.attributes.add("clickColor",{type:"rgb"}),Button.prototype.initialize=function(){this.cooldown>0&&(this.timerEntity=this.entity.findByName("Timer"),this.timerEntity.enabled=!1),this.entity.element.on("touchstart",this.onPress,this),this.entity.element.on("touchend",this.onLeave,this),this.entity.element.on("mouseenter",this.onHover,this),this.entity.element.on("mouseleave",this.onLeave,this),this.entity.element.on("mouseup",this.onPress,this),this.buttonUIParts=this.entity.findByTag("ButtonUI"),this.buttonUIParts.length>0&&(this.defaultColor=this.buttonUIParts[0].element.color.clone()),this.on("state",this.onStageChange,this)},Button.prototype.onStageChange=function(){this.lockAfterAction&&(this.entity.button.active=!0)},Button.prototype.onHover=function(t){document.body.style.cursor="pointer",this.hoverStateEvent&&this.app.fire(this.hoverAction,this.value),this.app.fire("Sound:Play","Button-Hover");for(var e=0;e<this.buttonUIParts.length;e++)this.buttonUIParts[e].element.color=this.hoverColor},Button.prototype.onLeave=function(t){this.hoverStateEvent&&this.app.fire(this.leaveAction,this.value),document.body.style.cursor="default";for(var e=0;e<this.buttonUIParts.length;e++)this.buttonUIParts[e].element.color=this.defaultColor},Button.prototype.onPress=function(t){var e=this;if(0===this.app.timeScale)return!1;if(this.timerEntity&&this.timerEntity.enabled)return!1;if(this.entity.button&&!this.entity.button.active)return!1;Utils.waitForChanges((function(){e.app.fire(e.action,e.value),e.entity.fire("Button:Click",e.action,e.value)})),this.timerEntity&&(this.timerEntity.enabled=!0);for(var i=0;i<this.buttonUIParts.length;i++)this.buttonUIParts[i].element.color=this.clickColor;Timer.setTimeout((function(t){for(var e=0;e<t.buttonUIParts.length;e++)t.buttonUIParts[e].element.color=t.defaultColor}),120,this),Timer.setTimeout((function(t){t.timerEntity&&(t.timerEntity.enabled=!1)}),1e3*this.cooldown,this),this.lockAfterAction&&(this.entity.button.active=!1,setTimeout((function(t){t.entity.button.active=!0}),1e3,this)),pc.lastClickTime=Date.now()};var Time=pc.createScript("time");Time.attributes.add("start",{type:"number",default:0}),Time.attributes.add("direction",{type:"string",default:"Forward",enum:[{Forward:"Forward"},{Backward:"Backward"}]}),Time.attributes.add("startEvent",{type:"string"}),Time.attributes.add("endEvent",{type:"string"}),Time.prototype.initialize=function(){this.startEventTriggered=!1,this.endEventTriggered=!1,this.time=parseFloat(this.start+""),this.on("state",this.onStateChange,this),this.startEvent&&!this.startEventTriggered&&(this.app.fire(this.startEvent),this.startEventTriggered=!0)},Time.prototype.onStateChange=function(){this.startEventTriggered=!1,this.endEventTriggered=!1,this.time=parseFloat(this.start+"")},Time.prototype.update=function(t){"Forward"==this.direction?this.time+=t:this.time-=t,"Backward"==this.direction&&this.endEvent&&this.time<=0&&!this.endEventTriggered&&(this.app.fire(this.endEvent),this.endEventTriggered=!0),this.entity.element.text=Utils.mmss(this.time)};var Hungry=pc.createScript("hungry");Hungry.attributes.add("food",{type:"string",default:"Berry"}),Hungry.attributes.add("payment",{type:"string",default:"Berry"}),Hungry.attributes.add("gridEntity",{type:"entity"}),Hungry.attributes.add("characterEntity",{type:"entity"}),Hungry.attributes.add("leavePoint",{type:"entity"}),Hungry.attributes.add("centerEntity",{type:"entity"}),Hungry.prototype.initialize=function(){this.currentPlate=!1,this.isEating=!1,this.shouldPay=!0,this.entity.on("Behaviour:LOCATE_FOOD",this.locateFood,this),this.entity.on("Behaviour:LOCATE_LEAVE",this.locateLeave,this),this.entity.on("Behaviour:EAT",this.eat,this),this.entity.on("Behaviour:DONE",this.done,this),this.entity.on("Behaviour:PAY",this.pay,this),this.entity.on("StartEating",this.startEating,this),this.entity.on("FinishEating",this.finishEating,this)},Hungry.prototype.locateFood=function(t){var i=(i=this.gridEntity.findByTag("EatingPoint")).filter((function(t){return t.enabled&&t.parent.enabled})),e=Math.floor(Math.random()*i.length);if(i.length>0)for(var n=0;n<i.length;n++){var a=i[n];a.enabled&&a.parent.enabled&&a.parent.script.droppable.itemArray.length>0&&(e=n)}i.length>0?(this.currentPlate=i[e],this.currentPlate.parent.fire("Reserved",this.entity),this.entity.fire("Behaviour:Callback",i[e])):this.entity.fire("Behaviour:Trigger","START")},Hungry.prototype.locateLeave=function(){this.isEating=!1,this.entity.fire("Behaviour:Callback",this.leavePoint)},Hungry.prototype.eat=function(){var t=this;this.entity.fire("Path:Focus",this.currentPlate.parent),this.currentPlate?this.currentPlate.parent.fire("Eat",(function(){pc.app.fire("Eat:"+t.entity.name,"Feeded"),Math.random()>.4&&t.app.fire("EmojiManager:React",t.entity,"Yummy")}),(function(){t.app.fire("EmojiManager:React",t.entity,t.food)})):this.entity.fire("Behaviour:Callback")},Hungry.prototype.startEating=function(t){this.isEating=!0,this.shouldPay&&this.app.fire("Money:Pay",pc.Prices.Food,this.entity,this.payment)},Hungry.prototype.finishEating=function(){this.isEating=!1,this.entity.fire("Behaviour:Callback")},Hungry.prototype.pay=function(){this.shouldPay,this.entity.fire("Behaviour:Callback")},Hungry.prototype.done=function(){this.entity.destroy()},Hungry.prototype.update=function(t){this.characterEntity.anim.setBoolean("Eating",this.isEating),this.centerEntity.fire("Motion:State",this.isEating?"Eating":"Default")};var CustomerManager=pc.createScript("customerManager");CustomerManager.attributes.add("customers",{type:"entity",array:!0}),CustomerManager.attributes.add("spawnPoints",{type:"entity",array:!0}),CustomerManager.attributes.add("maxAmounts",{type:"json",schema:[{name:"type",type:"string"},{name:"amount",type:"number",default:1}],array:!0}),CustomerManager.prototype.initialize=function(){this.lastSpawnDelay={},this.lastSpawnTime={},this.typeAmounts={},this.maxAmountsCached={};for(var t=0;t<this.maxAmounts.length;t++)this.typeAmounts[this.maxAmounts[t].type]=0,this.maxAmountsCached[this.maxAmounts[t].type]=this.maxAmounts[t].amount;this.app.on("CustomerManager:Request",this.onRequest,this),this.app.on("CustomerManager:Spawn",this.spawnCustomer,this),this.app.on("Money:Pay",this.onPay,this),this.app.on("Money:Add",this.onAdd,this)},CustomerManager.prototype.onAdd=function(t,e){this.typeAmounts[e]>0&&(this.typeAmounts[e]-=t)},CustomerManager.prototype.onPay=function(t,e,a){this.typeAmounts[a]+=t},CustomerManager.prototype.spawnCustomer=function(t){var e=this.getCustomerByName(t);if(!e)return!1;var a=e.clone();a.enabled=!0,this.entity.addChild(a)},CustomerManager.prototype.getCustomerByName=function(t){return this.customers.find((function(e){return e.name==t}))},CustomerManager.prototype.onRequest=function(t,e){var a=e||3e3;return!(this.lastSpawnTime[t]&&Date.now()-this.lastSpawnTime[t]<this.lastSpawnDelay[t])&&(this.lastSpawnTime[t]=Date.now(),this.lastSpawnDelay[t]=7*Math.random()*1e3+a,!(this.typeAmounts&&this.typeAmounts[t]>=this.maxAmountsCached[t])&&void this.spawnCustomer(t))},CustomerManager.prototype.update=function(t){};var EmojiManager=pc.createScript("emojiManager");EmojiManager.prototype.initialize=function(){this.offset=new pc.Vec3(0,.7,0),this.app.on("EmojiManager:React",this.onReact,this)},EmojiManager.prototype.onReact=function(e,t){this.reaction=t,this.app.fire("World2Screen:Clone","Emoji",e,this.offset,this.onLabel.bind(this),3.5)},EmojiManager.prototype.onLabel=function(e){e.findByName("Icon").element.textureAsset=this.app.assets.find("Emoji-"+this.reaction+".png")};var MotionState=pc.createScript("motionState");MotionState.attributes.add("speed",{type:"number",default:.1}),MotionState.attributes.add("states",{type:"json",schema:[{name:"state",type:"string"},{title:"Set Position",name:"hasPosition",type:"boolean",default:!1},{name:"position",type:"vec3",default:[0,0,0]},{title:"Set Rotation",name:"hasRotation",type:"boolean",default:!1},{name:"rotation",type:"vec3",default:[0,0,0]},{title:"Set Scale",name:"hasScale",type:"boolean",default:!1},{name:"scale",type:"vec3",default:[1,1,1]}],array:!0}),MotionState.prototype.initialize=function(){this.hasPosition=!1,this.hasRotation=!1,this.hasScale=!1,this.nextPosition=new pc.Vec3(0,0,0),this.nextRotation=new pc.Vec3(0,0,0),this.nextScale=new pc.Vec3(0,0,0),this.entity.on("Motion:State",this.setMotionState,this)},MotionState.prototype.setMotionState=function(t){var e=this.states.find((function(e){return e.state==t}));e&&(this.nextPosition=e.position,this.hasPosition=e.hasPosition,this.nextRotation=e.rotation,this.hasRotation=e.hasRotation,this.nextScale=e.scale,this.hasScale=e.hasScale)},MotionState.prototype.update=function(t){this.hasPosition&&this.entity.setLocalPosition(this.entity.getLocalPosition().lerp(this.entity.getLocalPosition(),this.nextPosition,this.speed)),this.hasRotation&&this.entity.setLocalEulerAngles(this.entity.getLocalEulerAngles().lerp(this.entity.getLocalEulerAngles(),this.nextRotation,this.speed)),this.hasScale&&this.entity.setLocalScale(this.entity.getLocalScale().lerp(this.entity.getLocalScale(),this.nextScale,this.speed))};var Coin=pc.createScript("coin");Coin.attributes.add("type",{type:"string",default:"None"}),Coin.attributes.add("value",{type:"number",default:5}),Coin.attributes.add("coinDisplay",{type:"entity"}),Coin.prototype.initialize=function(){this.isDestroyed=!1,setTimeout((function(t){t.entity.collision.enabled=!0}),300,this),this.entity.on("Trigger",this.onTrigger,this)},Coin.prototype.onTrigger=function(t){if(this.isDestroyed)return!1;this.app.fire("Money:Add",this.value,this.type),this.app.fire("World2Screen:Animate","Coin",this.entity.getPosition(),this.coinDisplay),this.entity.destroy(),this.isDestroyed=!0};var ShakableTree=pc.createScript("shakableTree");ShakableTree.attributes.add("spawnItem",{type:"string",default:"Food"}),ShakableTree.attributes.add("trigger",{type:"string",default:"Kick"}),ShakableTree.attributes.add("canSpawnItem",{type:"boolean",default:!1}),ShakableTree.prototype.initialize=function(){this.spawnPoints=this.entity.findByTag("Spawn"),this.lastItemSpawn=-1,this.entity.on("Allow",this.allowSpawn,this),this.entity.on("Trigger",this.onShake,this)},ShakableTree.prototype.allowSpawn=function(){this.canSpawnItem=!0},ShakableTree.prototype.onShake=function(t){if(!this.canSpawnItem)return!1;if(Date.now()-this.lastItemSpawn<3500)return!1;var e=Utils.getRandom(this.spawnPoints).getPosition().clone();this.app.fire("ItemManager:Create",this.spawnItem,e),this.entity.fire("Chop"),this.entity.fire("Motion","Shake"),this.app.fire("Motion","LittleShake"),t.fire(this.trigger),this.entity.sound.play("Damage"),this.lastItemSpawn=Date.now()};var AttentionIcon=pc.createScript("attentionIcon");AttentionIcon.attributes.add("iconName",{type:"string"}),AttentionIcon.attributes.add("offset",{type:"vec3",default:[0,.5,0]}),AttentionIcon.attributes.add("triggerDestroy",{type:"boolean",default:!0}),AttentionIcon.attributes.add("cameraFocus",{type:"boolean",default:!0}),AttentionIcon.prototype.postInitialize=function(){this.attentionDisplay=!1,this.app.fire("World2Screen:Clone",this.iconName,this.entity,this.offset,this.setDisplay.bind(this)),this.triggerDestroy&&this.entity.on("Trigger",this.onTrigger,this),this.cameraFocus&&Timer.setTimeout((function(t){t.app.fire("Camera:Focus",t.entity)}),250,this)},AttentionIcon.prototype.onTrigger=function(t){this.entity.destroy()},AttentionIcon.prototype.setDisplay=function(t){this.attentionDisplay=t};var Campfire=pc.createScript("campfire");Campfire.attributes.add("fireEntity",{type:"entity"}),Campfire.attributes.add("allowSpawn",{type:"entity"}),Campfire.attributes.add("zzzParticle",{type:"entity"}),Campfire.attributes.add("consumeTime",{type:"number",default:3}),Campfire.prototype.initialize=function(){this.lastConsume=-1,this.allowSpawn.fire("Allow"),this.waitingLine=[],this.offset=new pc.Vec3(0,.4,0),this.sleepingPoints=this.entity.findByTag("SleepingPoint"),this.entity.on("Added",this.onAdded,this),this.entity.on("Reserved",this.onReserved,this),this.entity.on("Sleep",this.onSleep,this),this.entity.on("Leave",this.onLeave,this),this.entity.on("CanSleep",this.canSleep,this)},Campfire.prototype.onSleep=function(t){this.zzzParticle.particlesystem.play(),this.zzzParticle.setLocalPosition(t.getLocalPosition().clone().add(this.offset))},Campfire.prototype.onReserved=function(){},Campfire.prototype.canSleep=function(t,e){this.hasLogs?t():(this.waitingLine.push(t),e())},Campfire.prototype.onLeave=function(t){this.zzzParticle.particlesystem.stop()},Campfire.prototype.onAdded=function(){this.lastConsume=Date.now(),this.waitingLine.length>0&&(this.waitingLine.forEach((function(t){t()})),this.waitingLine=[]),this.app.fire("Campfire","Added")},Campfire.prototype.consume=function(){if(Date.now()-this.lastConsume<1e3*this.consumeTime)return!1;this.entity.fire("Consume"),this.lastConsume=Date.now()},Campfire.prototype.hasPlace=function(){for(var t=!1,e=0;e<this.sleepingPoints.length;e++)this.sleepingPoints[e].enabled&&!this.sleepingPoints[e].isReserved&&(t=!0);return t},Campfire.prototype.update=function(t){this.hasLogs=this.entity.script.droppable.itemArray.length>0,this.fireEntity.enabled=this.hasLogs,this.entity.sound.volume=this.hasLogs?.6:0,this.consume(),this.hasPlace()&&this.app.fire("CustomerManager:Request","Campfire")};var Sleepy=pc.createScript("sleepy");Sleepy.attributes.add("characterEntity",{type:"entity"}),Sleepy.attributes.add("payPoint",{type:"entity"}),Sleepy.attributes.add("leavePoint",{type:"entity"}),Sleepy.attributes.add("sleepingDirections",{type:"entity",array:!0}),Sleepy.attributes.add("centerEntity",{type:"entity"}),Sleepy.attributes.add("payment",{type:"number",default:1}),Sleepy.prototype.initialize=function(){this.isSleeping=!1,this.onSleepingBed=!1,this.entity.on("Behaviour:LOCATE_BED",this.locateBed,this),this.entity.on("Behaviour:LOCATE_LEAVE",this.locateLeave,this),this.entity.on("Behaviour:LOCATE_PAY",this.locatePay,this),this.entity.on("Behaviour:SLEEP",this.sleep,this),this.entity.on("Behaviour:PAY",this.pay,this),this.entity.on("Behaviour:DONE",this.done,this)},Sleepy.prototype.locateBed=function(e){var t=(t=this.app.root.findByTag("SleepingPoint")).filter((function(e){return e.enabled&&!e.isReserved})),i=Math.floor(Math.random()*t.length);t.length>0?(this.currentBed=t[i],this.currentBed.isReserved=!0,this.entity.fire("Behaviour:Callback",t[i])):this.entity.fire("Behaviour:Trigger","START")},Sleepy.prototype.locateLeave=function(){this.currentBed&&(this.currentBed.parent.fire("Leave",this.entity),this.currentBed.isReserved=!1),this.isSleeping=!1,this.entity.fire("Behaviour:Callback",this.leavePoint)},Sleepy.prototype.locatePay=function(){this.isSleeping=!1,this.onSleepingBed=!1,this.entity.fire("Behaviour:Callback",this.payPoint)},Sleepy.prototype.sleep=function(){var e=this;this.onSleepingBed=!0,this.currentBed.parent.fire("CanSleep",(function(){e.isSleeping=!0,e.entity.sound.play("Sleeping"),e.currentBed&&e.currentBed.parent.fire("Sleep",e.currentBed),e.entity.fire("Behaviour:Callback")}),(function(){e.app.fire("EmojiManager:React",e.entity,"Campfire")})),this.entity.fire("Path:Focus",Utils.getRandom(this.sleepingDirections))},Sleepy.prototype.pay=function(){this.entity.sound.stop("Sleeping"),this.app.fire("Money:Pay",this.payment,this.entity,"Campfire"),this.entity.fire("Behaviour:Callback")},Sleepy.prototype.done=function(){this.entity.destroy()},Sleepy.prototype.update=function(e){this.characterEntity.anim.setBoolean("Sleeping",this.isSleeping),this.centerEntity.fire("Motion:State",this.onSleepingBed?"Sleeping":"Default")};var Npc=pc.createScript("npc");Npc.attributes.add("originEntity",{type:"entity"}),Npc.attributes.add("characterEntity",{type:"entity"}),Npc.attributes.add("differentSizes",{type:"boolean",default:!0}),Npc.prototype.initialize=function(){var t=1;Math.random()>.5&&(t=.7),this.differentSizes&&this.originEntity.setLocalScale(t,t,t),this.entity.on("Path:Move",this.onMove,this),this.entity.on("Path:Reach",this.onReach,this)},Npc.prototype.onMove=function(){this.characterEntity.anim.setBoolean("Running",!0)},Npc.prototype.onReach=function(t){this.characterEntity.anim.setBoolean("Running",!1)},Npc.prototype.update=function(t){};var Bucket=pc.createScript("bucket");Bucket.attributes.add("waterEntity",{type:"entity"}),Bucket.prototype.initialize=function(){this.hasWater=!1,this.entity.on("CarriedBy",this.setCarrier,this),this.entity.on("UseWater",this.useWater,this)},Bucket.prototype.useWater=function(t){this.entity.collision.enabled=!0,this.entity.tags.remove("Bucket"),this.hasWater=!1},Bucket.prototype.setCarrier=function(t){t.on("Waterfall",this.onWaterCollect,this)},Bucket.prototype.onWaterCollect=function(t,e){if(this.hasWater)return!1;this.hasWater=!0,this.entity.tags.add("Bucket"),t.off("Waterfall",this.onWaterCollect,this)},Bucket.prototype.update=function(){this.waterEntity.enabled=this.hasWater};var Waterfall=pc.createScript("waterfall");Waterfall.prototype.initialize=function(){this.entity.on("Trigger",this.onTrigger,this)},Waterfall.prototype.onTrigger=function(t){t.fire("Waterfall",t,this.entity)};var Pool=pc.createScript("pool");Pool.attributes.add("waterEntity",{type:"entity"}),Pool.attributes.add("speed",{type:"number",default:1}),Pool.prototype.initialize=function(){this.waterLevel=0,this.entity.on("Added",this.onAdded,this)},Pool.prototype.onAdded=function(t){this.waterLevel=-.1,Timer.setTimeout((function(e){t.fire("UseWater"),e.entity.fire("Remove",t)}),1e4,this)},Pool.prototype.update=function(t){this.waterLevel>-.6&&(this.waterLevel-=t*this.speed),this.waterEntity.setLocalPosition(.5,this.waterLevel,.5)};var Reactions=pc.createScript("reactions");Reactions.attributes.add("characterEntity",{type:"entity"}),Reactions.prototype.postInitialize=function(){this.entity.on("AfterCarry",this.onCarry,this)},Reactions.prototype.onCarry=function(t){"Poop"==t.name&&this.app.fire("EmojiManager:React",this.entity,"Puke")};var Garbage=pc.createScript("garbage");Garbage.prototype.initialize=function(){this.entity.on("Added",this.onAdded,this)},Garbage.prototype.onAdded=function(e){this.app.fire("Garbage",e.name)};var Shitter=pc.createScript("shitter");Shitter.attributes.add("characterEntity",{type:"entity"}),Shitter.attributes.add("leavePoint",{type:"entity"}),Shitter.prototype.initialize=function(){this.isShitting=!1,this.entity.on("Behaviour:LOCATE_SHIT",this.locateShit,this),this.entity.on("Behaviour:LOCATE_LEAVE",this.locateLeave,this),this.entity.on("Behaviour:SHIT",this.shit,this),this.entity.on("Behaviour:DONE",this.done,this),this.characterEntity.anim.on("Shit",this.onShit,this)},Shitter.prototype.locateShit=function(){var t=this.app.root.findByTag("ShitPoint"),i=Math.floor(Math.random()*t.length);this.entity.fire("Behaviour:Callback",t[i])},Shitter.prototype.locateLeave=function(){this.isShitting=!1,this.entity.fire("Behaviour:Callback",this.leavePoint)},Shitter.prototype.shit=function(){this.characterEntity.anim.setTrigger("Shit"),Timer.setTimeout((function(t){t.entity.sound.play(Utils.getRandom(["Poop-1","Poop-2"]))}),300,this)},Shitter.prototype.onShit=function(){this.app.fire("ItemManager:Create","Poop",this.entity.getPosition().clone()),this.entity.fire("Behaviour:Callback")},Shitter.prototype.done=function(){this.entity.destroy()};var OthersManager=pc.createScript("othersManager");OthersManager.prototype.initialize=function(){this.lastShitterSpawn=Date.now()},OthersManager.prototype.update=function(t){Date.now()-this.lastShitterSpawn>12e4&&(this.app.fire("CustomerManager:Spawn","Shitter"),this.lastShitterSpawn=Date.now())};var Dirty=pc.createScript("dirty");Dirty.attributes.add("characterEntity",{type:"entity"}),Dirty.attributes.add("modelEntity",{type:"entity"}),Dirty.attributes.add("leavePoint",{type:"entity"}),Dirty.attributes.add("cleanMaterial",{type:"asset"}),Dirty.attributes.add("payment",{type:"number",default:4}),Dirty.prototype.initialize=function(){this.isShowering=!1,this.inShower=!1,this.entity.on("Behaviour:LOCATE_SHOWER",this.locateShower,this),this.entity.on("Behaviour:LOCATE_LEAVE",this.locateLeave,this),this.entity.on("Behaviour:WAIT_SHOWER",this.waitShower,this),this.entity.on("Behaviour:PAY",this.pay,this),this.entity.on("Behaviour:DONE",this.done,this),this.app.assets.load(this.cleanMaterial)},Dirty.prototype.locateShower=function(){var t=(t=this.app.root.findByTag("ShowerPoint")).filter((function(t){return t.enabled&&!t.script.shower.isReserved})),i=Math.floor(Math.random()*t.length);this.showerPoint=t[i],this.showerPoint.script.shower.isReserved=!0,this.entity.fire("Behaviour:Callback",this.showerPoint)},Dirty.prototype.waitShower=function(){var t=this;this.app.fire("EmojiManager:React",this.entity,"Shower"),this.showerPoint.fire("WaitShower",(function(){t.clean(),t.entity.fire("Behaviour:Callback")})),this.entity.fire("Path:Focus",this.showerPoint.findByName("LookPoint"))},Dirty.prototype.locateLeave=function(){this.isShowering=!1,this.entity.fire("Behaviour:Callback",this.leavePoint)},Dirty.prototype.clean=function(){this.modelEntity.render.meshInstances[0].material=this.cleanMaterial.resource},Dirty.prototype.pay=function(){this.app.fire("Money:Pay",this.payment,this.entity,"Shower"),this.entity.fire("Behaviour:Callback")},Dirty.prototype.done=function(){this.entity.destroy(),this.showerPoint.script.shower.isReserved=!1,this.showerPoint.fire("Leave")},Dirty.prototype.update=function(t){this.showerPoint&&this.characterEntity.anim.setBoolean("Showering",this.showerPoint.script.shower.isShowering)};var Instructions=pc.createScript("instructions");Instructions.attributes.add("steps",{type:"json",schema:[{name:"type",type:"string",enum:[{Animation:"Animation"},{Arrow:"Arrow"}],default:"Animation"},{name:"animation",type:"string",default:"None"},{name:"position",type:"entity"},{name:"eventName",type:"string"},{name:"eventValue",type:"string"},{name:"focus",type:"boolean",default:!1}],array:!0}),Instructions.attributes.add("resetEventName",{type:"string",default:"None"}),Instructions.attributes.add("resetEventValue",{type:"string",default:"None"}),Instructions.attributes.add("delay",{type:"number",default:0}),Instructions.prototype.initialize=function(){if(this.stepIndex=0,this.currentStep=!1,this.isCompleted=Utils.getItemAsBoolean(this.entity.name+"_Instructions"),this.isCompleted)return!1;Timer.clearTimeout(this.stepTimer),this.stepTimer=Timer.setTimeout((function(t){t.setStep()}),1e3*this.delay,this),this.app.on(this.resetEventName,this.onResetEvent,this)},Instructions.prototype.onResetEvent=function(t){this.resetEventValue==t&&(this.currentStep&&this.app.off(this.currentStep.eventName,this.onEvent,this),this.stepIndex=0,this.currentStep=!1,this.app.fire("Camera:Clear"),this.app.fire("LevelManager:HideInstruction"),Timer.clearTimeout(this.stepTimer),this.stepTimer=Timer.setTimeout((function(t){t.setStep()}),1e3*this.delay,this))},Instructions.prototype.setStep=function(){var t=this.steps[this.stepIndex];if(!t)return!1;this.currentStep=t,"Animation"==this.currentStep.type?this.app.fire("LevelManager:ShowCharacter",this.currentStep.animation,this.currentStep.position):"Arrow"==this.currentStep.type&&this.app.fire("LevelManager:ShowArrow",this.currentStep.position),Timer.clearTimeout(this.focusTimer),this.currentStep.focus&&(this.focusTimer=Timer.setTimeout((function(t){pc.app.fire("Camera:Focus",t.currentStep.position)}),1e3,this)),this.app.on(this.currentStep.eventName,this.onEvent,this)},Instructions.prototype.nextStep=function(){this.app.fire("LevelManager:HideInstruction"),this.stepIndex<this.steps.length-1?(this.stepIndex++,this.setStep()):(this.app.off(this.resetEventName,this.onResetEvent,this),this.isCompleted=!0,Utils.setItem(this.entity.name+"_Instructions","Completed"),console.log("Completed:",this.entity.name))},Instructions.prototype.onEvent=function(t){t==this.currentStep.eventValue&&(this.app.off(this.currentStep.eventName,this.onEvent,this),this.nextStep())};var PopupManager=pc.createScript("popupManager");PopupManager.attributes.add("popupEntity",{type:"entity"}),PopupManager.prototype.initialize=function(){this.views=this.popupEntity.findByTag("View");for(var i=0;i<this.views.length;i++)this.views[i].enabled=!1;this.app.on("PopupManager:Show",this.onShow,this),this.app.on("PopupManager:Hide",this.onHide,this)},PopupManager.prototype.onShow=function(i){pc.hasActiveInterface=!0,PokiPlugin.isSatisfied=!1,this.popupEntity.enabled=!0;for(var t=0;t<this.views.length;t++)this.views[t].name===i?this.views[t].enabled=!0:this.views[t].enabled=!1;PokiPlugin.onPause()},PopupManager.prototype.onHide=function(){pc.hasActiveInterface=!1,this.popupEntity.enabled=!1,PokiPlugin.checkSatisfaction()?PokiPlugin.showConditionedMidroll():PokiPlugin.onPlay()};var CosmeticsManager=pc.createScript("cosmeticsManager");CosmeticsManager.attributes.add("items",{type:"json",schema:[{name:"name",type:"string"},{name:"icon",type:"asset",assetType:"texture"},{name:"asset",type:"asset"},{name:"material",type:"asset"},{name:"bodyPart",type:"entity"},{name:"price",type:"number",default:100},{name:"adsCount",type:"number",default:0},{name:"isEquiped",type:"boolean",default:!1}],array:!0}),CosmeticsManager.attributes.add("itemEntity",{type:"entity"}),CosmeticsManager.attributes.add("itemHolder",{type:"entity"}),CosmeticsManager.attributes.add("cursorEntity",{type:"entity"}),CosmeticsManager.prototype.initialize=function(){this.renderNextFrame=!1,this.currentAdsCount=0,this.itemArray=[],this.createdAt=Date.now(),this.tutorialActive=!0,this.unlockedItems=Utils.getItemAsArray("UnlockedItems"),this.app.on("CosmeticsManager:Apply",this.applySkin,this),this.app.on("PopupManager:Show",this.onShow,this),this.renderItems(),Utils.getItemAsBoolean("CursorCosmetics")&&(this.cursorEntity.enabled=!1,this.tutorialActive=!1),this.load()},CosmeticsManager.prototype.onShow=function(e){"Cosmetics"==e&&(this.cursorEntity.enabled=!1,this.tutorialActive=!1,Utils.setItem("CursorCosmetics","Shown"))},CosmeticsManager.prototype.applySkin=function(e){var t=this.getSkinByName(e);return!!t&&(t.price>0&&pc.MoneyManager.money<=t.price?(this.app.fire("Overlay:Message","Not enough money!"),!1):this.isUnlocked(t.name)?(t.isEquiped?this.unequip(t.name):this.equip(t.name),this.save(),!1):t.adsCount>0&&!(this.currentAdsCount>=t.adsCount)?(this.currentAdsCount++,this.renderNextFrame=!0,!1):(this.unlock(t.name),this.equip(t.name),void this.save()))},CosmeticsManager.prototype.getSkinByName=function(e){for(var t=0;t<this.items.length;t++)if(this.items[t].name===e)return this.items[t];return!1},CosmeticsManager.prototype.renderItems=function(){this.clearItems(),this.itemEntity.enabled=!1;for(var e=0;e<this.items.length;e++){var t=this.items[e],i=this.itemEntity.clone();i.enabled=!0,i.findByName("AdsCount").enabled=t.adsCount>0&&!this.isUnlocked(t.name),i.findByName("AdsCount").element.text=this.currentAdsCount+" / "+t.adsCount,i.findByName("PriceTag").enabled=t.price>0&&!this.isUnlocked(t.name),i.findByName("PriceTag").element.text=t.price,i.findByName("Icon").element.textureAsset=t.icon,i.findByName("CanEquip").enabled=!t.isEquiped&&(this.isUnlocked(t.name)||0===t.price),i.findByName("Equiped").enabled=t.isEquiped,t.isEquiped&&(i.element.color=Utils.getColor("95FF00")),i.script.button.value=t.name,this.itemHolder.addChild(i),this.itemArray.push(i)}},CosmeticsManager.prototype.clearItems=function(){for(var e=this.itemArray.length;e--;)this.itemArray[e].destroy();this.itemArray=[]},CosmeticsManager.prototype.unlock=function(e){-1===this.unlockedItems.indexOf(e)&&this.unlockedItems.push(e),Utils.setItem("UnlockedItems",JSON.stringify(this.unlockedItems))},CosmeticsManager.prototype.isUnlocked=function(e){return this.unlockedItems.indexOf(e)>-1},CosmeticsManager.prototype.equip=function(e){var t=this.getSkinByName(e);if(!t)return!1;if(t.bodyPart&&t.bodyPart.currentSkin&&this.unequip(t.bodyPart.currentSkin),t.isEquiped=!t.isEquiped,t.bodyPart.enabled=t.isEquiped,t.bodyPart.currentSkin=e,t.bodyPart.model&&(t.bodyPart.model.asset=t.asset,t.bodyPart.model.ready((function(e){var i=t.material;i.ready((function(){e.meshInstances[0].material=i.resource})),pc.app.assets.load(i)}))),t.bodyPart.render){t.bodyPart.render.asset=t.asset;var i=t.material;i.ready((function(){t.bodyPart.render.meshInstances[0].material=i.resource})),this.app.assets.load(i)}this.renderNextFrame=!0},CosmeticsManager.prototype.unequip=function(e){var t=this.getSkinByName(e);if(!t)return!1;t.isEquiped=!1,t.bodyPart.enabled=t.isEquiped,this.renderNextFrame=!0},CosmeticsManager.prototype.save=function(){for(var e=[],t=0;t<this.items.length;t++)this.items[t].isEquiped&&e.push(this.items[t].name);Utils.setItem("EquipedItems",JSON.stringify(e))},CosmeticsManager.prototype.load=function(){for(var e=Utils.getItemAsArray("EquipedItems"),t=0;t<e.length;t++)this.equip(e[t])},CosmeticsManager.prototype.postUpdate=function(){this.renderNextFrame&&(this.renderItems(),this.renderNextFrame=!1),this.tutorialActive&&Date.now()-this.createdAt>6e4&&(this.cursorEntity.enabled=!0)};var ModelComponentAddon=pc.createScript("modelComponentAddon");ModelComponentAddon.prototype.initialize=function(){if(pc.ModelComponent.prototype.ready)return!1;pc.ModelComponent.prototype.ready=function(e){var o=this;if(o.isLoaded)return e(this),!1;if(this.asset){var t=pc.app.assets.get(this.asset);t.ready((function(){var t=o.meshInstances;for(var n in t)t[n];Timer.setTimeout((function(){e(o),o.isLoaded=!0}),100)})),pc.app.assets.load(t)}}};var BuildingAnimation=pc.createScript("buildingAnimation");BuildingAnimation.attributes.add("parts",{type:"entity",array:!0}),BuildingAnimation.prototype.initialize=function(){this.lastUpdate=Date.now(),this.lastIndex=0;for(var t=0;t<this.parts.length;t++)this.parts[t].enabled=!1;this.entity.on("Play",this.onPlay,this)},BuildingAnimation.prototype.onPlay=function(){this.lastUpdate=Date.now()-500,this.lastIndex=0,this.entity.sound.play("Building")},BuildingAnimation.prototype.update=function(t){Date.now()-this.lastUpdate>500&&(this.parts[this.lastIndex].enabled=!0,this.parts.length-1>this.lastIndex&&this.lastIndex++,this.lastUpdate=Date.now())};var AnimatedSprite=pc.createScript("animatedSprite");AnimatedSprite.attributes.add("autoplay",{type:"boolean",default:!0}),AnimatedSprite.attributes.add("speed",{type:"number",default:1}),AnimatedSprite.attributes.add("frameCount",{type:"number",default:1}),AnimatedSprite.attributes.add("loop",{type:"boolean",default:!0}),AnimatedSprite.prototype.initialize=function(){this.currentFrame=0,this.isPlaying=!1,this.entity.on("AnimatedSprite:Play",this.onPlay,this),this.entity.on("AnimatedSprite:Pause",this.onPause,this),this.entity.on("AnimatedSprite:Reset",this.onReset,this),this.autoplay&&this.onPlay(),this.on("state",this.onStateChange,this)},AnimatedSprite.prototype.onStateChange=function(){this.onReset(),this.autoplay&&this.onPlay()},AnimatedSprite.prototype.onPlay=function(){this.isPlaying=!0,this.currentFrame=0},AnimatedSprite.prototype.onPause=function(){this.isPlaying=!1},AnimatedSprite.prototype.onReset=function(){this.isPlaying=!1,this.currentFrame=0},AnimatedSprite.prototype.update=function(t){this.entity.element.spriteFrame=Math.round(this.currentFrame),this.isPlaying&&(this.currentFrame+=this.speed*t,this.currentFrame>=this.frameCount&&this.loop&&(this.currentFrame=0),this.currentFrame=Math.min(this.currentFrame,this.frameCount))};var Objectives=pc.createScript("objectives");Objectives.attributes.add("objectives",{type:"json",schema:[{name:"item",type:"entity"},{name:"objective",type:"entity"}],array:!0}),Objectives.attributes.add("directionArrow",{type:"entity"}),Objectives.attributes.add("objectiveMark",{type:"entity"}),Objectives.prototype.initialize=function(){this.nextObjective=!1,this.objectiveItem=!1,this.objectiveEntity=!1,this.entity.on("SetToCarry",this.onCarry,this),this.entity.on("Drop",this.onDrop,this),this.directionArrow.enabled=!1,this.objectiveMark.enabled=!1,this.app.on("Objective:Set",this.setObjective,this)},Objectives.prototype.onDrop=function(){this.nextObjective&&this.onComplete()},Objectives.prototype.setObjective=function(t){if(!t)return this.directionArrow.enabled=!1,this.objectiveMark.enabled=!1,this.nextObjective=!1,this.objectiveItem=!1,this.objectiveEntity=!1,!1;this.objectiveEntity=t,this.nextObjective=t},Objectives.prototype.onCarry=function(t){var e=this.getObjectiveByItem(t);e&&(Utils.getItemAsBoolean(t.name+"_Objective")||(this.nextObjective=e,this.objectiveItem=t,this.objectiveMark.setPosition(this.nextObjective.getPosition()),this.objectiveMark.enabled=!0))},Objectives.prototype.getObjectiveByItem=function(t){for(var e=0;e<this.objectives.length;e++)if(this.objectives[e].item.name===t.name)return this.objectives[e].objective},Objectives.prototype.onComplete=function(){this.objectiveMark.enabled=!1,this.directionArrow.enabled=!1,Utils.setItem(this.objectiveItem.name+"_Objective","Completed"),this.nextObjective=!1,this.objectiveItem=!1},Objectives.prototype.update=function(t){if(this.nextObjective){this.objectiveEntity&&(this.objectiveMark.setPosition(this.objectiveEntity.getPosition()),this.objectiveMark.enabled=this.objectiveEntity.enabled);var e=this.nextObjective.getPosition().sub(this.entity.getPosition());e.normalize(),this.directionArrow.setEulerAngles(0,180*Math.atan2(e.x,e.z)/Math.PI-90,0),this.directionArrow.enabled=!0;var i=this.entity.getPosition().sub(this.nextObjective.getPosition()).length();this.directionArrow.findByName("Line").setLocalScale(.06,.45,i),i<1.5&&this.onComplete()}};var CashMachine=pc.createScript("cashMachine");CashMachine.attributes.add("levelName",{type:"string",default:"Level-1"}),CashMachine.attributes.add("signEntity",{type:"entity"}),CashMachine.prototype.initialize=function(){Utils.getItemAsBoolean("Level_"+this.levelName)||(this.app.fire("EffectManager:Confetti",this.entity.getPosition()),this.entity.sound.play("Tada"),this.app.fire("Overlay:Ribbon",this.levelName),Timer.setTimeout((function(e){pc.app.fire("TutorialManager:Focus")}),2e3,this),Utils.setItem("Level_"+this.levelName,"Completed")),this.signEntity&&(this.signEntity.enabled=!0)},CashMachine.prototype.update=function(e){};var RandomMaterial=pc.createScript("randomMaterial");RandomMaterial.attributes.add("materials",{type:"asset",array:!0}),RandomMaterial.prototype.postInitialize=function(){var a=this;this.material=Utils.getRandom(this.materials),this.material.ready((function(){a.entity.render.meshInstances[0].material=a.material.resource})),this.app.assets.load(this.material)};var UpgradeManager=pc.createScript("upgradeManager");UpgradeManager.attributes.add("upgrades",{type:"json",schema:[{name:"title",type:"string",default:"None"},{name:"description",type:"string",default:"None"},{name:"price",type:"number",default:10},{name:"multiplier",type:"number",default:1},{name:"icon",type:"asset",assetType:"texture"},{name:"entity",type:"entity"}],array:!0}),UpgradeManager.attributes.add("rowEntity",{type:"entity"}),UpgradeManager.attributes.add("holderEntity",{type:"entity"}),UpgradeManager.attributes.add("upgradeNotification",{type:"entity"}),UpgradeManager.attributes.add("nothingIcon",{type:"entity"}),UpgradeManager.prototype.initialize=function(){this.upgradeItems=[],this.rowEntity.enabled=!1,this.notificationShowed=!1,this.currentUpgrades=Utils.getItemAsArray("Upgrades"),this.loadUpgrades(),this.app.on("UpgradeManager:Upgrade",this.onUpgrade,this),this.app.on("UpgradeManager:Refresh",this.onRender,this),this.app.on("PopupManager:Show",this.onPopup,this),this.app.on("Mount:Ready",this.onReady,this),this.app.on("Money:Added",this.onMoneyAdd,this)},UpgradeManager.prototype.onReady=function(){this.onMoneyAdd()},UpgradeManager.prototype.onPopup=function(e){"Upgrades"==e&&(this.notificationShowed=!0,this.onRender())},UpgradeManager.prototype.onUpgrade=function(e){if(this.currentUpgrades.indexOf(e)>-1)return!1;var t=this.getUpgradeByName(e);if(!t)return!1;var a=this.getCurrentPrice(t);if(a>pc.MoneyManager.money)return this.app.fire("Money:NoMoney"),!1;t.entity.enabled=!0,t.entity.fire("Upgrade"),this.app.fire("Camera:Focus",t.entity),this.app.fire("Money:Remove",a),this.entity.sound.play("Purchase"),this.onMoneyAdd(),Timer.clearTimeout(this.renderTimeout),this.renderTimeout=Timer.setTimeout((function(t){t.onRender(e)}),10,this),this.notificationShowed=!1,PokiPlugin.isSatisfied=!0},UpgradeManager.prototype.loadUpgrades=function(){for(var e=this.upgrades.length;e--;){var t=this.upgrades[e];t&&this.currentUpgrades.indexOf(t.entity.name)>-1&&(t.entity.enabled=!0)}},UpgradeManager.prototype.onRender=function(e){this.clear();for(var t=this.upgrades.length,a=0;t--;){var n=this.upgrades[t];if(n){var i=this.rowEntity.clone();i.enabled=!0,a++,i.findByName("Title").element.text=n.title,i.findByName("Description").element.text=n.description,i.findByName("Icon").element.textureAsset=n.icon,n.entity.enabled?i.findByName("UpgradeLevel").element.text=n.entity.script.upgrade.level+" / "+n.entity.script.upgrade.maxLevel:(i.findByName("Title").element.text="?",i.findByName("Description").element.text="",i.findByName("Icon").element.color=pc.Color.BLACK,i.findByName("Icon").element.opacity=.5),i.findByName("Price").element.text=this.getCurrentPrice(n)+"",i.findByName("Buy").script.button.value=n.entity.name,e===n.entity.name&&(i.findByName("Fireworks").enabled=!0,n.entity.script.upgrade.maxLevel===n.entity.script.upgrade.level&&(this.entity.sound.play("Tada"),this.app.fire("Overlay:Ribbon",n.title+" max!"))),i.findByName("UpgradeFill").setLocalScale(n.entity.script.upgrade.level*(1/n.entity.script.upgrade.maxLevel),1,1),pc.MoneyManager.money<this.getCurrentPrice(n)&&(i.findByName("Buy").element.opacity=.2),n.entity.enabled?(i.findByName("Buy").enabled=!0,i.findByName("Active").enabled=!1):(i.findByName("Buy").enabled=!1,i.findByName("Active").enabled=!1),n.entity.script.upgrade.level>=n.entity.script.upgrade.maxLevel&&(i.findByName("Buy").enabled=!1,i.findByName("Active").enabled=!0),this.holderEntity.addChild(i),this.upgradeItems.push(i)}}this.nothingIcon.enabled=0===a},UpgradeManager.prototype.clear=function(){for(var e=this.upgradeItems.length;e--;){this.upgradeItems[e].destroy()}this.upgradeItems=[]},UpgradeManager.prototype.getUpgradeByName=function(e){for(var t=this.upgrades.length;t--;){var a=this.upgrades[t];if(a.entity.name==e)return a}return!1},UpgradeManager.prototype.checkAvailableUpgrades=function(){for(var e=this.upgrades.length,t=!1;e--;){var a=this.upgrades[e],n=this.getCurrentPrice(a);!this.notificationShowed&&a&&!0===a.entity.enabled&&n>0&&pc.MoneyManager.money>0&&pc.MoneyManager.money>=n&&a.entity.script.upgrade.level<a.entity.script.upgrade.maxLevel&&(t=!0)}return t},UpgradeManager.prototype.onMoneyAdd=function(){this.checkAvailableUpgrades()?this.upgradeNotification.enabled=!0:this.upgradeNotification.enabled=!1},UpgradeManager.prototype.getCurrentPrice=function(e){return Math.round(Math.pow(e.price,e.multiplier*e.entity.script.upgrade.level+1))};var FerretHelper=pc.createScript("ferretHelper");FerretHelper.attributes.add("foodPoint",{type:"entity"}),FerretHelper.attributes.add("waitPoint",{type:"entity"}),FerretHelper.attributes.add("foodEntity",{type:"entity"}),FerretHelper.attributes.add("mounthEntity",{type:"entity"}),FerretHelper.attributes.add("plateEntities",{type:"entity",array:!0}),FerretHelper.prototype.initialize=function(){this.currentPlate=!1,this.entity.on("Behaviour:LOCATE_FOOD",this.locateFood,this),this.entity.on("Behaviour:GET_FOOD",this.getFood,this),this.entity.on("Behaviour:DELIVER",this.deliverFood,this),this.entity.on("Behaviour:LOCATE_EMPTY_PLATE",this.locatePlate,this),this.entity.on("Behaviour:GO_WAIT",this.goWait,this),this.entity.on("Upgrade:State",this.setUpgradeState,this)},FerretHelper.prototype.setUpgradeState=function(t){t>1&&t<=3?this.entity.script.pathMove.speed=.04:t>3&&t<=6?this.entity.script.pathMove.speed=.07:t>6&&t<=10&&(this.entity.script.pathMove.speed=.1)},FerretHelper.prototype.locateFood=function(){this.entity.fire("Behaviour:Callback",this.foodPoint)},FerretHelper.prototype.goWait=function(){this.entity.fire("Behaviour:Callback",!0)},FerretHelper.prototype.getFood=function(){var t=this.foodEntity.clone();t.enabled=!0,t.setLocalPosition(0,0,0),t.collision.enabled=!1,t.script.item&&t.script.item.onDrop(),this.mounthEntity.addChild(t),this.currentFoodEntity=t,this.currentFoodEntity.fire("Collected"),this.entity.fire("Behaviour:Callback",!1)},FerretHelper.prototype.locatePlate=function(){var t=this.getAvailablePlate();t?(this.currentPlate=t,this.currentPlate.on("Added",this.goWaitInstead,this),this.entity.fire("Behaviour:Callback",t.findByName("EatingPoint"))):(this.currentPlate&&this.currentPlate.off("Added",this.goWaitInstead,this),this.currentPlate=!1,this.goWaitInstead())},FerretHelper.prototype.goWaitInstead=function(){this.entity.fire("Behaviour:Trigger","GO_WAIT",this.waitPoint)},FerretHelper.prototype.getAvailablePlate=function(){for(var t=0;t<this.plateEntities.length;t++){if("FoodPlate"==this.plateEntities[t].name&&this.plateEntities[t].script.shelf.waitingForItem)return this.plateEntities[t];if("CampfireBed"==this.plateEntities[t].name&&this.plateEntities[t].script.droppable.itemArray.length<3)return this.plateEntities[t];if(this.plateEntities[t].script.animalFoodPlate&&this.plateEntities[t].script.animalFoodPlate.waitingForItem)return this.plateEntities[t]}return null},FerretHelper.prototype.deliverFood=function(){this.currentFoodEntity&&(this.entity.sound&&Math.random()>.5&&this.entity.sound.play("Deliver"),this.currentPlate.off("Added",this.goWaitInstead,this),this.currentPlate.fire("Transfer",this.currentFoodEntity),this.currentPlate.fire("Added",this.currentFoodEntity),this.currentFoodEntity=!1,this.currentPlate=!1),this.entity.fire("Path:Focus",this.currentPlate),this.entity.fire("Behaviour:Callback",!1)};var Slider=pc.createScript("slider");Slider.attributes.add("valueEntity",{type:"entity"}),Slider.attributes.add("sizeEntity",{type:"entity"}),Slider.prototype.initialize=function(){this.on("state",this.onUpdate,this),this.entity.scrollbar.on("set:value",this.onUpdate,this),this.onUpdate()},Slider.prototype.onUpdate=function(t){this.valueEntity.element.text=Math.round(100*this.entity.scrollbar.value)+"%",this.sizeEntity.setLocalScale(this.entity.scrollbar.value,1,1)};var Gateway=pc.createScript("gateway");Gateway.attributes.add("playerEntity",{type:"entity"}),Gateway.attributes.add("imageEntity",{type:"entity"}),Gateway.attributes.add("minDistance",{type:"number",default:10}),Gateway.attributes.add("multiplier",{type:"number",default:.3}),Gateway.attributes.add("connectedEntities",{type:"entity",array:!0}),Gateway.attributes.add("enableEntities",{type:"entity",array:!0}),Gateway.attributes.add("requiredTag",{type:"string",default:"Level-1"}),Gateway.attributes.add("playAnimation",{type:"boolean",default:!0}),Gateway.prototype.postInitialize=function(){this.gameLoaded=Date.now(),this.stations=this.app.root.findByTag(this.requiredTag),this.isActive=!0},Gateway.prototype.onUnlock=function(){if(0===this.stations.length)return!1;for(var t=0;t<this.connectedEntities.length;t++)this.connectedEntities[t].enabled=!1;this.entity.enabled=!1;for(t=0;t<this.enableEntities.length;t++)this.enableEntities[t].enabled=!0;this.playAnimation&&(this.app.fire("LevelManager:LevelUnlock",this.requiredTag),Utils.setOnce(this.requiredTag)&&(this.app.fire("Overlay:Ribbon",this.requiredTag+" unlocked!"),this.app.fire("EffectManager:Confetti",this.entity.getPosition()),this.app.fire("Camera:Focus",this.entity)),Date.now()-this.gameLoaded>1e4&&Timer.setTimeout((function(t){console.log("Midroll triggered!"),PokiPlugin.showMidroll((function(){console.log("Midroll successfully played!")}))}),4e3,this)),this.isActive=!1},Gateway.prototype.update=function(t){if(!this.isActive)return!1;var e=this.playerEntity.getPosition(),i=this.entity.getPosition(),a=e.clone().sub(i).length();a<this.minDistance?this.imageEntity.element.opacity=(1-a/this.minDistance)*this.multiplier:this.imageEntity.element.opacity=0,this.checkRequiredTag()},Gateway.prototype.checkRequiredTag=function(t){for(var e=0,i=0;i<this.stations.length;i++)this.stations[i].enabled&&e++;e===this.stations.length&&this.onUnlock()};var Cursor=pc.createScript("cursor");Cursor.attributes.add("delay",{type:"number",default:1}),Cursor.prototype.initialize=function(){this.threshold=0,this.lastTrigger=Date.now(),this.investedMoney=0,this.lastUpdate=-1,this.isCompleted=!1,this.tutorialManager=!1,this.offset=new pc.Vec3(0,.5,0),this.entity.on("Trigger",this.onTrigger,this),this.entity.on("Define",this.setDetails,this),this.on("destroy",this.onDestroy,this),this.app.on("LevelManager:Complete",this.onComplete,this)},Cursor.prototype.onDestroy=function(){this.app.off("LevelManager:Complete",this.onComplete,this)},Cursor.prototype.setDisplay=function(t){this.progressionEntity=t,this.progressionEntity.visible=!1},Cursor.prototype.setDetails=function(t,e){this.currentLevel=e,this.station=t,this.icon=t.icon,this.typeIcon=t.typeIcon,this.price=t.price+Math.round(Math.pow(t.price,t.priceMultiplier*t.upgradeLevel))-1,this.showPrice=t.showPrice,this.investedMoney=0,this.app.fire("World2Screen:Clone","BuyStation",this.entity,this.offset,this.onLabel.bind(this))},Cursor.prototype.onLabel=function(t){this.textEntity=t.findByName("Text"),this.iconEntity=t.findByName("Icon"),this.typeEntity=t.findByName("Type"),this.iconEntity.element.textureAsset=this.icon,this.typeEntity.element.textureAsset=this.typeIcon},Cursor.prototype.onTrigger=function(t,e){if(this.isCompleted)return!1;if(Date.now()-this.lastUpdate<60)return!1;var i=1;this.price>40?i=10:this.price>30?i=5:this.price>15&&(i=2);var s=this.price-this.investedMoney;if(s<i&&(i=s),pc.MoneyManager.money<i)return this.app.fire("Money:NoMoney",s),!1;this.investedMoney+=i,this.lastTrigger=Date.now(),this.app.fire("Money:Remove",i),this.price<=this.investedMoney&&(this.isCompleted=!0,this.currentLevel.script.tutorialManager.onComplete(this.station),"undefined"!=typeof PokiPlugin&&PokiPlugin.showConditionedMidroll(),this.entity.destroy()),this.lastUpdate=Date.now()},Cursor.prototype.onComplete=function(){this.currentLevel.script.tutorialManager.onComplete(this.station,.1),this.entity.destroy()},Cursor.prototype.updateText=function(){this.textEntity&&(this.textEntity.element.text=this.price-this.investedMoney+"")},Cursor.prototype.update=function(t){this.updateText()};var AvailableCheck=pc.createScript("availableCheck");AvailableCheck.attributes.add("dropEntity",{type:"entity"}),AvailableCheck.attributes.add("garbageEntity",{type:"entity"}),AvailableCheck.prototype.initialize=function(){this.entity.on("CarriedBy",this.onDrop,this)},AvailableCheck.prototype.onDrop=function(){this.dropEntity.script.droppable.count<=this.dropEntity.script.droppable.itemArray.length&&this.app.fire("Objective:Set",this.garbageEntity)};var Upgrade=pc.createScript("upgrade");Upgrade.attributes.add("maxLevel",{type:"number",default:10}),Upgrade.prototype.initialize=function(){this.level=Utils.getItemAsNumber(this.entity.name+"_Upgrade"),this.entity.on("Upgrade",this.onUpgrade,this),this.entity.fire("Upgrade:State",this.level)},Upgrade.prototype.onUpgrade=function(){if(this.level>=this.maxLevel)return!1;this.level++,this.entity.fire("Upgrade:State",this.level),Utils.setItem(this.entity.name+"_Upgrade",this.level)};var Field=pc.createScript("field");Field.prototype.initialize=function(){this.entity.on("Trigger",this.onTrigger,this)},Field.prototype.onTrigger=function(r){if(!r)return!1;if(0===r.script.carry.carryIndexes.length)return!1;var e=r.script.carry.carryIndexes[0];"Bucket"==e.name&&e.fire("UseWater")};var Npcrandom=pc.createScript("npcrandom");Npcrandom.attributes.add("removeAfter",{type:"number",default:5}),Npcrandom.attributes.add("speed",{type:"number",default:1}),Npcrandom.prototype.initialize=function(){this.timer=0},Npcrandom.prototype.update=function(t){this.entity.translateLocal(0,0,this.speed*t),this.timer+=t,this.timer>this.removeAfter&&this.entity.destroy()};var Npcstreet=pc.createScript("npcstreet");Npcstreet.prototype.initialize=function(){this.lastSpawn=-1,this.entities=this.entity.findByTag("NPC");for(var t=0;t<this.entities.length;t++)this.entities[t].enabled=!1},Npcstreet.prototype.update=function(t){this.randomSpawn()},Npcstreet.prototype.randomSpawn=function(){if(Date.now()-this.lastSpawn<3e3)return!1;var t=Utils.getRandom(this.entities);if(t){var e=t.clone();e.enabled=!0,this.entity.addChild(e)}this.lastSpawn=Date.now()};var Price=pc.createScript("price");pc.Prices={},Price.attributes.add("priceName",{type:"string",default:"None"}),Price.attributes.add("price",{type:"number",default:1}),Price.attributes.add("multiplier",{type:"number",default:1}),Price.prototype.initialize=function(){pc.Prices[this.priceName]=this.price,this.entity.on("Upgrade:State",this.setUpgradeState,this)},Price.prototype.setUpgradeState=function(e){pc.Prices[this.priceName]=this.price+Math.round(e*this.multiplier),console.log("Current price",this.priceName,pc.Prices[this.priceName])};var FarmerPanda=pc.createScript("farmerPanda");FarmerPanda.attributes.add("loadPoint",{type:"entity"}),FarmerPanda.attributes.add("leavePoint",{type:"entity"}),FarmerPanda.attributes.add("focusPoint",{type:"entity"}),FarmerPanda.attributes.add("loaderNPC",{type:"entity"}),FarmerPanda.attributes.add("item",{type:"string",default:"Carrot"}),FarmerPanda.prototype.initialize=function(){this.totalCarrot=1,this.eventAdded=!1,this.entity.on("Behaviour:LOCATE_LOAD_POINT",this.locateLoadPoint,this),this.entity.on("Behaviour:LOCATE_LEAVE",this.locateLeave,this),this.entity.on("Behaviour:WAIT_LOAD",this.waitLoad,this),this.entity.on("Behaviour:DONE",this.done,this),this.entity.on("Behaviour:PAY",this.pay,this)},FarmerPanda.prototype.waitLoad=function(){this.app.fire("Camera:Focus",this.entity),this.app.fire("EmojiManager:React",this.entity,this.item),this.entity.fire("Path:Focus",this.focusPoint),this.eventAdded||(this.entity.on("Added",this.onLoad,this),this.eventAdded=!0),this.loaderNPC&&this.loaderNPC.fire("Request:Items",this.entity)},FarmerPanda.prototype.onLoad=function(t,e){for(var i=this.app.root.findByTag(this.item),a=0,r=0;r<i.length;r++)i[r].enabled&&a++;this.totalCarrot=parseInt(a+""),a===this.entity.script.droppable.itemArray.length||this.entity.script.droppable.itemArray.length>=this.entity.script.droppable.count?(this.app.fire("Money:Pay",pc.Prices[this.item],this.entity,"Carrot"),this.entity.fire("Behaviour:Callback",!0)):this.loaderNPC&&this.loaderNPC.fire("Request:Items",this.entity)},FarmerPanda.prototype.locateLoadPoint=function(){this.entity.fire("Behaviour:Callback",this.loadPoint)},FarmerPanda.prototype.locateLeave=function(){this.entity.fire("Behaviour:Callback",this.leavePoint)},FarmerPanda.prototype.pay=function(){this.entity.fire("Behaviour:Callback")},FarmerPanda.prototype.done=function(){this.entity.fire("Clear"),this.entity.enabled=!1},FarmerPanda.prototype.update=function(t){};var Producer=pc.createScript("producer");Producer.attributes.add("itemEntity",{type:"entity"}),Producer.attributes.add("speed",{type:"number",default:.1}),Producer.attributes.add("startProgress",{type:"number",default:1}),Producer.prototype.postInitialize=function(){this.itemEntity.enabled=!1,this.itemPosition=this.itemEntity.getPosition().clone(),this.updatedAt=-1,this.isActive=!0,this.progression=this.startProgress,this.app.fire("World2Screen:Clone","Progress",this.entity,!1,this.setDisplay.bind(this)),this.entity.on("CollectedBy",this.onCollected,this),this.entity.fire("Producer:Reset")},Producer.prototype.setDisplay=function(t){this.progressionEntity=t,this.progressionEntity.visible=!0},Producer.prototype.onCollected=function(){if(this.isActive)return!1;this.progression=0,this.isActive=!0,this.progressionEntity.visible=!0,this.entity.fire("Producer:Reset")},Producer.prototype.create=function(){var t=this.itemEntity.clone();t.enabled=!0,this.entity.addChild(t),this.app.fire("Overlay:Sound","Plant-Produce"),this.app.fire("Camera:Focus",this.entity),this.progressionEntity.visible=!1},Producer.prototype.update=function(t){this.progression+=t*this.speed,this.isActive&&this.progression>1&&(this.create(),this.isActive=!1),this.progressionEntity&&this.progressionEntity.fire("Progress",this.progression),this.progressionEntity&&this.progression+.01>=1&&(this.progressionEntity.visible=!1)};var ChopLog=pc.createScript("chopLog");ChopLog.attributes.add("particleEntity",{type:"entity"}),ChopLog.attributes.add("spawnPoint",{type:"entity"}),ChopLog.attributes.add("logs",{type:"entity",array:!0}),ChopLog.attributes.add("speed",{type:"number",default:.1}),ChopLog.prototype.initialize=function(){this.lastLogSpawn=-1,this.canSpawnItem=!1,this.lastLogChop=-1,this.logCount=0,this.progression=1;for(var t=0;t<this.logs.length;t++)this.logs[t].enabled=!1;this.entity.on("Allow",this.allowSpawn,this),this.entity.on("Trigger",this.onTrigger,this),this.app.on("Mount:Ready",this.onReady,this)},ChopLog.prototype.onReady=function(){this.app.fire("World2Screen:Clone","Progress",this.entity,!1,this.setDisplay.bind(this))},ChopLog.prototype.setDisplay=function(t){this.progressionEntity=t,this.progressionEntity.visible=!0},ChopLog.prototype.allowSpawn=function(){this.canSpawnItem=!0},ChopLog.prototype.onTrigger=function(t){return 0!==this.logCount&&(!!this.canSpawnItem&&(!(Date.now()-this.lastLogChop<2e3)&&(this.particleEntity.particlesystem.reset(),this.particleEntity.particlesystem.play(),this.app.fire("ItemManager:Create","Log",this.spawnPoint.getPosition()),this.entity.fire("Motion","Shake"),this.app.fire("Motion","LittleShake"),t.fire("Chop"),this.entity.sound.play("Damage"),this.logCount--,this.logs[this.logCount].enabled=!1,this.lastLogChop=Date.now(),void(this.lastLogSpawn=Date.now()))))},ChopLog.prototype.addLogs=function(){if(Date.now()-this.lastLogChop<2e3)return!1;this.logCount<3&&(this.logs[this.logCount].enabled=!0,this.logCount++,this.progression=0)},ChopLog.prototype.update=function(t){this.progression+=t*this.speed,this.canSpawnItem&&this.progression>1&&(this.addLogs(),this.lastLogSpawn=Date.now()),this.progressionEntity&&(0===this.logCount&&this.canSpawnItem?this.progressionEntity.visible=!0:this.progressionEntity.visible=!1,this.progressionEntity.fire("Progress",this.progression))};var Farm=pc.createScript("farm");Farm.attributes.add("delay",{type:"number",default:5}),Farm.attributes.add("collectorNPC",{type:"entity"}),Farm.prototype.initialize=function(){this.updatedAt=-1,this.collectorNPC.enabled=!1},Farm.prototype.callNPC=function(){this.collectorNPC.enabled=!0,this.collectorNPC.fire("Clear"),this.collectorNPC.fire("Behaviour:Trigger","START")},Farm.prototype.update=function(t){Date.now()-this.updatedAt>1e3*this.delay&&(this.callNPC(),this.updatedAt=Date.now())};var LevelManager=pc.createScript("levelManager");LevelManager.attributes.add("instructionEntity",{type:"entity"}),LevelManager.attributes.add("forceLevel",{type:"number",default:0}),LevelManager.attributes.add("playerEntity",{type:"entity"}),LevelManager.prototype.initialize=function(){console.log(this.entity.name+" enabled!"),this.types={Kicking:1,Holding:2},this.lastCount=Date.now(),this.levels=this.entity.findByTag("Level"),this.levels.forEach((function(e){e.script.tutorialManager.clearLevels(),e.enabled=!1})),this.forceLevel>0?this.currentLevelIndex=this.forceLevel:this.currentLevelIndex=Utils.getItemAsNumber("Level"),this.instructionEntity.enabled=!1,this.app.on("LevelManager:ShowCharacter",this.showCharacter,this),this.app.on("LevelManager:ShowArrow",this.showArrow,this),this.app.on("LevelManager:HideInstruction",this.hideInstructions,this),this.app.on("LevelManager:Focus",this.onFocus,this),this.app.on("LevelManager:LevelUnlock",this.unlockLevel,this),this.app.on("Money:Added",this.onMoneyAdd,this),this.app.on("Mount:Ready",this.onSceneReady,this)},LevelManager.prototype.onSceneReady=function(){this.setLevels()},LevelManager.prototype.unlockLevel=function(e){var t=e.split("-")[1];this.currentLevelIndex=Math.max(parseInt(t),this.currentLevelIndex),this.setLevels()},LevelManager.prototype.setLevels=function(){for(var e=0;e<this.currentLevelIndex+1;e++)this.levels[e]&&(this.levels[e].enabled=!0,this.levels[e].fire("Ready"));var t=this.levels[this.currentLevelIndex];if(t&&t.script.tutorialManager)t.script.tutorialManager.gridEntity.findByName("PlayerSpawn")},LevelManager.prototype.showArrow=function(e){this.app.fire("Objective:Set",e)},LevelManager.prototype.showCharacter=function(e,t){this.instructionEntity.setPosition(t.getPosition()),this.instructionEntity.setRotation(t.getRotation()),this.instructionEntity.enabled=!0,this.instructionEntity.anim.setInteger("Type",this.types[e]),this.app.fire("Camera:Focus",this.instructionEntity)},LevelManager.prototype.hideInstructions=function(e){this.instructionEntity.enabled=!1,this.app.fire("Objective:Set",!1)},LevelManager.prototype.onMoneyAdd=function(){pc.MoneyManager.money>=this.price&&this.app.fire("Camera:Focus",this.stationEntity)},LevelManager.prototype.onFocus=function(){this.app.fire("Camera:Focus",this.stationEntity)},LevelManager.prototype.update=function(){if(Date.now()-this.lastCount<1e3)return!1;var e=this.app.root.findByTag("Station").filter((function(e){return e.enabled})).length;Utils.logCheckpoint("Station-"+e),this.app.fire("LevelManager-Station",e),this.lastCount=Date.now()};var Progress=pc.createScript("progress");Progress.attributes.add("checkEntity",{type:"entity"}),Progress.prototype.initialize=function(){this.checkEntity&&(this.checkEntity.enabled=!1),this.entity.parent.on("Progress",this.onProgress,this)},Progress.prototype.onProgress=function(t){this.entity.fire("MaterialShader:Set","progress",t),this.checkEntity&&(this.checkEntity.enabled=t>=1)};var MaterialShader=pc.createScript("materialShader");MaterialShader.attributes.add("inEditor",{type:"boolean",default:!0,title:"In Editor"}),MaterialShader.attributes.add("isDebug",{type:"boolean",default:!1}),MaterialShader.attributes.add("isElement",{type:"boolean",default:!1}),MaterialShader.attributes.add("isStatic",{type:"boolean",default:!1}),MaterialShader.attributes.add("isBatched",{type:"boolean",default:!1}),MaterialShader.attributes.add("color",{type:"boolean",default:!0}),MaterialShader.attributes.add("transform",{type:"boolean",default:!0}),MaterialShader.attributes.add("light",{type:"boolean",default:!0}),MaterialShader.attributes.add("material",{type:"asset",assetType:"material"}),MaterialShader.attributes.add("textures",{type:"json",schema:[{name:"name",type:"string",default:"texture_0"},{name:"texture",type:"asset",assetType:"texture"}],array:!0}),MaterialShader.attributes.add("colors",{type:"json",schema:[{name:"name",type:"string",default:"color_0"},{name:"color",type:"rgba"}],array:!0}),MaterialShader.attributes.add("vectors",{type:"json",schema:[{name:"name",type:"string",default:"vector_0"},{name:"vector",type:"vec2"}],array:!0}),MaterialShader.attributes.add("numbers",{type:"json",schema:[{name:"name",type:"string",default:"number_0"},{name:"number",type:"number",default:0}],array:!0}),MaterialShader.attributes.add("curves",{type:"json",schema:[{name:"name",type:"string",default:"curve_0"},{name:"curve",type:"curve",curves:["x","y","z"]},{name:"speed",type:"number",default:1}],array:!0}),MaterialShader.attributes.add("billboard",{type:"boolean",default:!1}),MaterialShader.attributes.add("vertexSet",{type:"boolean",default:!1}),MaterialShader.attributes.add("cloneMaterial",{type:"boolean",default:!1}),MaterialShader.attributes.add("alphaRef",{type:"number",default:.15}),MaterialShader.attributes.add("shader",{type:"string",default:"dmVjNCBnZXRDb2xvcih2ZWMyIFVWKXsKLy92ZWMzIHRleHR1cmVfY29sb3IgPSB0ZXh0dXJlMkQodGV4dHVyZV8wLCBVVikucmdiOwpjb2xvci5yZ2IgPSB2ZWMzKDAuMCwgMS4wLCAwLjApOwpjb2xvci5hID0gMS4wOwoKcmV0dXJuIGNvbG9yOwp9Cgp2ZWMzIGdldFZlcnRleCh2ZWMzIGxvY2FsUG9zaXRpb24sIHZlYzMgd29ybGRQb3NpdGlvbiwgdmVjMiBVVil7CnZlcnRleC54eXogPSB2ZWMzKDAuMCwgMC4wLCAwLjApOwoKcmV0dXJuIHZlcnRleDsKfQ=="}),MaterialShader.prototype.initialize=function(){this.parameters=[],this.once=!1,this.reset(),this.isDebug?this.addCodeEditor():(this.emissive=atob(this.shader),this.updateMaterial()),this.on("attr:textures",this.onAttributeChange,this),this.on("attr:colors",this.onAttributeChange,this),this.on("attr:vectors",this.onAttributeChange,this),this.on("attr:numbers",this.onAttributeChange,this),this.on("attr:curves",this.onAttributeChange,this),this.on("attr:shader",this.onAttributeChange,this),this.entity.on("MaterialShader:Set",this.setVariable,this),this.on("state",this.onStateChange,this),this.on("destroy",this.onDestroy,this),this.entity.on("Model:Loaded",this.onModelLoaded,this),this.app.on("MaterialShader:Reset",this.onStateChange,this),this.material&&(this.totalAssets=2+this.textures.length,this.loaded=0,this.loadAllAssets()),this.isElement&&this.onAttributeChange()},MaterialShader.prototype.loadAllAssets=function(){if(this.isElement)return this.loaded=this.totalAssets,Timer.setTimeout((function(t){t.isLoaded()}),100,this),!1;var t=this,e=this.entity.model.asset,a=this.app.assets.get(e);for(var i in a?(a.ready((function(){t.loaded++,t.isLoaded()})),this.app.assets.load(a)):(this.loaded++,this.isLoaded()),this.material.ready((function(){t.loaded++,t.isLoaded()})),this.app.assets.load(this.material),this.textures){var r=this.textures[i];r.texture.ready((function(){t.loaded++,t.isLoaded()})),this.app.assets.load(r.texture)}},MaterialShader.prototype.isLoaded=function(){this.loaded>=this.totalAssets&&(this.isBatched?Timer.setTimeout((function(t){t.getMaterialByBatch(),t.updateMaterial()}),100,this):(this.cloneMaterial?(this.currentMaterial=this.material.resource.clone(),this.isElement?this.entity.element.material=this.currentMaterial:this.entity.model.meshInstances[0].material=this.currentMaterial):this.currentMaterial=this.material.resource,this.updateMaterial()))},MaterialShader.prototype.setVariable=function(t,e){for(var a in this.parameters){var i=this.parameters[a];this.currentMaterial.setParameter(i.name,i.resource),i.name==t&&(this.parameters[a].resource=e)}},MaterialShader.prototype.updateDynamicVariables=function(){for(var t in this.curves){var e=this.curves[t];for(var a in this.parameters){var i=this.parameters[a];if(i.name==e.name){var r=e.curve.value(this.timestamp*e.speed%1);i.resource=[r[0],r[1],r[2]]}}}},MaterialShader.prototype.onDestroy=function(){this.cloneMaterial&&this.currentMaterial&&this.currentMaterial.destroy()},MaterialShader.prototype.onModelLoaded=function(t){!0===t&&Timer.setTimeout((function(t){t.onAttributeChange()}),3e3,this)},MaterialShader.prototype.onStateChange=function(t){this.reset()},MaterialShader.prototype.copy=function(t){var e=btoa(t);navigator.clipboard.writeText(e).then((function(){console.log("Async: Copying to clipboard was successful!")}),(function(t){console.error("Async: Could not copy text: ",t)}))},MaterialShader.prototype.addCodeEditor=function(){var t=this,e=document.createElement("button");e.style.position="fixed",e.style.left="10px",e.style.top="340px",e.style.width="100px",e.style.height="40px",e.style.zIndex="5000",e.style.background="rgba(0, 0, 0, 0.5)",e.style.color="#fff",e.textContent="Copy",e.onclick=function(){t.copy(t.emissiveCode.value)},document.body.appendChild(e);var a=document.createElement("textarea");a.style.position="fixed",a.style.left="10px",a.style.top="10px",a.style.width="400px",a.style.height="300px",a.style.padding="10px",a.style.zIndex="5000",a.style.background="rgba(0, 0, 0, 0.5)",a.style.outline="none",a.style.color="white",a.onkeyup=this.onShaderChange.bind(this);var i=document.createElement("style");i.innerText="#application-console{max-height: 80px;}",document.body.appendChild(i),this.emissiveCode=a,this.emissiveCode.value=atob(this.shader),this.emissive=this.emissiveCode.value,this.updateMaterial(),document.body.appendChild(a)},MaterialShader.prototype.onShaderChange=function(){Timer.clearTimeout(this.timer),this.timer=Timer.setTimeout((function(t){t.emissive=t.emissiveCode.value,t.updateMaterial()}),100,this)},MaterialShader.prototype.reset=function(){this.timestamp=0},MaterialShader.prototype.line=function(t){return t+"\n"},MaterialShader.prototype.number=function(t){return parseFloat(t).toFixed(2)},MaterialShader.prototype.colorRGB=function(t){return"vec3("+this.number(t.data[0])+", "+this.number(t.data[1])+", "+this.number(t.data[2])+")"},MaterialShader.prototype.colorRGBA=function(t){return"vec4("+this.number(t.data[0])+", "+this.number(t.data[1])+", "+this.number(t.data[2])+", "+this.number(t.data[3])+")"},MaterialShader.prototype.addParameter=function(t,e){var a="";for(var i in this[t]){var r=this[t][i],s=!1;if(a+=this.line("uniform "+e+" "+r.name+";"),"textures"==t&&(s=r.texture.resource),"colors"==t&&(s=r.color.data),"vectors"==t&&(s=r.vector.data),"curves"==t){var n=r.curve.value(this.timestamp*r.speed);s=[n[0],n[1],n[2]]}"numbers"==t&&(s=r.number),this.parameters.push({name:r.name,resource:s})}return a},MaterialShader.prototype.generateShaderOutput=function(){var t="";return t+=this.addParameter("textures","sampler2D"),t+=this.addParameter("colors","vec4"),t+=this.addParameter("vectors","vec2"),t+=this.addParameter("numbers","float"),t+=this.addParameter("curves","vec3"),t+=this.line("uniform float timestamp;"),t+=this.line("uniform float alpha_ref;"),t+=this.line("vec4 color  = vec4(0.0);"),t+=this.line("vec3 vertex = vec3(0.0);"),t+=this.line(this.emissive),t+=this.line("void getEmission() {"),t+=this.line("}"),t+=this.line("void getAlbedo() {"),t+=this.line("}"),t+=this.line("void getOpacity() {"),t+=this.line("}"),t+=this.line("void alphaTest(float a) {"),t+=this.line("if (a < alpha_ref) discard;"),t+=this.line("}")},MaterialShader.prototype.onAttributeChange=function(){this.reset(),this.updateMaterial()},MaterialShader.prototype.generateTransformOutput=function(){var t="";return t+=this.addParameter("textures","sampler2D"),t+=this.addParameter("colors","vec4"),t+=this.addParameter("vectors","vec2"),t+=this.addParameter("numbers","float"),t+=this.addParameter("curves","vec3"),this.isBatched&&(t+=this.line("#define DYNAMICBATCH")),t+=this.line("uniform float timestamp;"),t+=this.line("uniform mat4 matrix_viewInverse;"),t+=this.line("mat4 getModelMatrix() {"),t+=this.line("#ifdef DYNAMICBATCH"),t+=this.line("return getBoneMatrix(vertex_boneIndices);"),t+=this.line("#elif defined(INSTANCING)"),t+=this.line("return mat4(instance_line1, instance_line2, instance_line3, instance_line4);"),t+=this.line("#else"),t+=this.line("return matrix_model;"),t+=this.line("#endif"),t+=this.line("}"),t+=this.line("vec4 color  = vec4(0.0);"),t+=this.line("vec3 vertex = vec3(0.0);"),t+=this.line(this.emissive),t+=this.line("vec4 getPosition() {"),t+=this.line("dModelMatrix = getModelMatrix();"),t+=this.line("vec3 localPos = vertex_position;"),t+=this.line("vec4 posW   = dModelMatrix * vec4(localPos, 1.0);"),t+=this.line("vec2 UV     = localPos.xy * 0.5 + vec2(0.5, 0.5);"),this.billboard&&(t+=this.line("vec3 CameraUp_worldspace = matrix_viewInverse[1].xyz;"),t+=this.line("vec3 CameraRight_worldspace = matrix_viewInverse[0].xyz;"),t+=this.line("vec3 particleCenter_wordspace = ( dModelMatrix * vec4(0.0, 0.0, 0.0, 1.0) ).xyz;"),t+=this.line("posW.xyz = particleCenter_wordspace.xyz + CameraRight_worldspace * localPos.x + CameraUp_worldspace * localPos.y;")),this.vertexSet?t+=this.line("posW.xyz = getFullVertex(localPos, posW.xyz, UV, dModelMatrix, matrix_viewInverse);"):t+=this.line("posW.xyz+= getVertex(localPos, posW.xyz, UV);"),t+=this.line("dPositionW = posW.xyz;"),t+=this.line("vec4 outputPosition = matrix_viewProjection * posW;"),t+=this.line("return outputPosition;"),t+=this.line("}"),t+=this.line("vec3 getWorldPosition() {"),t+=this.line("return dPositionW;"),t+=this.line("}")},MaterialShader.prototype.getMaterialByBatch=function(){var t=this.entity.model.batchGroupId,e=this.app.batcher.getBatches(t);for(var a in e){var i=e[a].meshInstance.material;this.currentMaterial=i}},MaterialShader.prototype.updateMaterial=function(){if(this.timestamp=0,!this.currentMaterial)return!1;this.transform&&(this.currentMaterial.chunks.transformVS=this.generateTransformOutput()),this.color&&(this.currentMaterial.chunks.diffusePS=this.generateShaderOutput(),this.currentMaterial.chunks.opacityPS=" ",this.currentMaterial.chunks.emissivePS=" ",this.currentMaterial.chunks.alphaTestPS=" ",this.currentMaterial.chunks.endPS="vec4 outputColor = getColor(vUv0);",this.currentMaterial.chunks.endPS+="dAlpha = outputColor.a;",this.currentMaterial.chunks.endPS+="if (dAlpha < "+this.alphaRef+"){ discard; }",this.currentMaterial.chunks.endPS+="gl_FragColor.rgb = outputColor.rgb;",this.currentMaterial.chunks.outputAlphaPS=" ",this.light&&(this.currentMaterial.chunks.endPS+="gl_FragColor.rgb = mix(gl_FragColor.rgb * dDiffuseLight, dSpecularLight + dReflection.rgb * dReflection.a, dSpecularity);",this.currentMaterial.chunks.endPS+="gl_FragColor.rgb = addFog(gl_FragColor.rgb);",this.currentMaterial.chunks.endPS+="gl_FragColor.rgb = toneMap(gl_FragColor.rgb);",this.currentMaterial.chunks.endPS+="gl_FragColor.rgb = gammaCorrectOutput(gl_FragColor.rgb);"),this.currentMaterial.chunks.endPS+="gl_FragColor.a = dAlpha;"),this.currentMaterial.update()},MaterialShader.prototype.update=function(t){if(this.currentMaterial){if(this.updateDynamicVariables(),!this.isStatic||!this.once){for(var e in this.parameters){var a=this.parameters[e];this.currentMaterial.setParameter(a.name,a.resource)}this.once=!0}this.currentMaterial.setParameter("timestamp",this.timestamp),this.currentMaterial.update()}this.timestamp+=t};var Chicken=pc.createScript("chicken");Chicken.attributes.add("characterEntity",{type:"entity"}),Chicken.attributes.add("homeEntity",{type:"entity"}),Chicken.attributes.add("foodPoint",{type:"entity"}),Chicken.attributes.add("productionTime",{type:"number",default:20}),Chicken.prototype.initialize=function(){this.homeEntity.enabled=!0,this.entity.on("Behaviour:LOCATE_FOOD",this.locateFood,this),this.entity.on("Behaviour:EAT",this.eat,this),this.entity.on("Behaviour:LOCATE_HOME",this.locateHome,this),this.entity.on("Behaviour:LOCATE_HOME_WAIT",this.locateHomeWait,this),this.entity.on("Behaviour:PRODUCE_EGG",this.produce,this),this.entity.on("Connected",this.onConnected,this),this.entity.on("StartEating",this.startEating,this),this.entity.on("FinishEating",this.finishEating,this)},Chicken.prototype.locateFood=function(){this.characterEntity.anim.setBoolean("Sitting",!1);var t=this.foodPoint.findByName("EatingPoint");this.entity.fire("Behaviour:Callback",t)},Chicken.prototype.locateHome=function(){var t=this;this.homeEntity.fire("CanUse",(function(){t.entity.fire("Behaviour:Callback",t.homeEntity)}))},Chicken.prototype.locateHomeWait=function(){this.entity.fire("Behaviour:Callback",this.homeEntity.findByName("WaitPoint"))},Chicken.prototype.startEating=function(t){this.isEating=!0},Chicken.prototype.finishEating=function(){this.isEating=!1,this.entity.fire("Behaviour:Callback")},Chicken.prototype.produce=function(){this.characterEntity.anim.setBoolean("Sitting",!0),this.entity.fire("Path:Focus",this.homeEntity.findByName("LookPoint")),this.entity.sound.play("Produce"),this.homeEntity.fire("ItemCreated"),setTimeout((function(t){pc.app.fire("EggFarm:CallPanda"),pc.app.fire("ItemManager:Create","Egg",t.entity.getPosition(),t.homeEntity),t.entity.fire("Behaviour:Callback")}),1e3*this.productionTime,this)},Chicken.prototype.eat=function(){var t=this;this.entity.fire("Path:Focus",this.foodPoint),this.foodPoint?this.foodPoint.fire("Eat",(function(){Math.random()>.4&&t.app.fire("EmojiManager:React",t.entity,"Yummy")}),(function(){Math.random()>.7&&t.app.fire("EmojiManager:React",t.entity,"Cry")})):this.entity.fire("Behaviour:Callback")},Chicken.prototype.onConnected=function(t){this.foodPoint=t};var WheatItem=pc.createScript("wheatItem");WheatItem.attributes.add("itemAsset",{type:"asset"}),WheatItem.prototype.initialize=function(){this.entity.on("Collected",this.onCollected,this)},WheatItem.prototype.onCollected=function(){this.entity.model.asset=this.itemAsset};var ConnectedAnimal=pc.createScript("connectedAnimal");ConnectedAnimal.attributes.add("animalEntity",{type:"entity"}),ConnectedAnimal.prototype.postInitialize=function(){this.animalEntity.enabled=!0,this.animalEntity.fire("Connected",this.entity)};var Sheep=pc.createScript("sheep");Sheep.attributes.add("speed",{type:"number",default:.3}),Sheep.attributes.add("foodPoint",{type:"entity"}),Sheep.attributes.add("woolEntity",{type:"entity"}),Sheep.attributes.add("produceItem",{type:"string",default:"Wool"}),Sheep.attributes.add("spawnPoints",{type:"entity",array:!0}),Sheep.attributes.add("waitPointHolder",{type:"entity"}),Sheep.attributes.add("characterEntity",{type:"entity"}),Sheep.attributes.add("playerEntity",{type:"entity"}),Sheep.attributes.add("directionEntity",{type:"entity"}),Sheep.attributes.add("centerArea",{type:"entity"}),Sheep.attributes.add("runAwaySpeed",{type:"number",default:.3}),Sheep.attributes.add("offsetAngle",{type:"number",default:0}),Sheep.attributes.add("effect",{type:"string",default:"Razor"}),Sheep.prototype.postInitialize=function(){this.progression=0,this.offset=new pc.Vec3(0,.5,0),this.waitPoints=this.waitPointHolder.findByTag("WaitPoint"),this.woolTaken=!1,this.isEaten=!1,this.goingEating=!1,this.totalRun=0,this.isFirstTime=Utils.setOnce("Sheep_Fast_Progress"),this.app.fire("World2Screen:Clone","Progress",this.entity,this.offset,this.setDisplay.bind(this)),this.entity.on("Behaviour:LOCATE_FOOD",this.locateFood,this),this.entity.on("Behaviour:EAT",this.eat,this),this.entity.on("Behaviour:LOCATE_WAIT_POINT",this.locateWaitPoint,this),this.entity.on("Behaviour:SHIT_OR_WAIT",this.shitOrWait,this),this.entity.on("Connected",this.onConnected,this),this.entity.on("StartEating",this.startEating,this),this.entity.on("FinishEating",this.finishEating,this),this.entity.on("Trigger",this.onTrigger,this)},Sheep.prototype.setDisplay=function(t){this.progressionEntity=t,this.progressionEntity.visible=!1},Sheep.prototype.onTrigger=function(t){return!(t.script.carry.carryIndexes.length>0)&&(!!this.woolEntity.enabled&&(!this.woolTaken&&(this.characterEntity.anim.setTrigger("Jump"),this.app.fire("World2Screen:Show",this.effect,this.entity,this.offset,.6),this.app.fire("ItemManager:Create",this.produceItem,Utils.getRandom(this.spawnPoints).getPosition()),this.progressionEntity.visible=!1,this.woolEntity.enabled=!1,this.isFirstTime=!1,this.totalRun=0,this.entity.fire("Behaviour:Trigger","AFTER_SHEERING"),this.goingEating=!0,this.effect&&(this.app.fire("EffectManager:"+this.effect,this.entity.getPosition()),this.entity.sound.play(this.effect)),Math.random()>.5?this.entity.sound.play("Bleat"):this.entity.sound.play("Happy"),this.app.fire("Motion","LittleShake"),void(this.woolTaken=!0))))},Sheep.prototype.startEating=function(t){this.isEating=!0},Sheep.prototype.finishEating=function(){this.isEating=!1,this.entity.fire("Behaviour:Callback")},Sheep.prototype.eat=function(){var t=this;this.waitingForWool=!0,this.goingEating=!1,this.entity.fire("Path:Focus",this.foodPoint),this.foodPoint?this.foodPoint.fire("Eat",(function(){Math.random()>.4&&t.app.fire("EmojiManager:React",t.entity,"Yummy")}),(function(){Math.random()>.7&&t.app.fire("EmojiManager:React",t.entity,"Cry")})):this.entity.fire("Behaviour:Callback")},Sheep.prototype.onConnected=function(t){this.foodPoint=t},Sheep.prototype.locateFood=function(){var t=this.foodPoint.findByName("EatingPoint");this.entity.fire("Behaviour:Callback",t)},Sheep.prototype.locateWaitPoint=function(){this.progressionEntity.visible=!0,this.progression=0,this.isEaten=!0,this.entity.fire("Behaviour:Callback",Utils.getRandom(this.waitPoints))},Sheep.prototype.shitOrWait=function(){if(this.goingEating)return!1;this.entity.fire("Behaviour:Trigger","LOCATE_WAIT_POINT",Utils.getRandom(this.waitPoints))},Sheep.prototype.update=function(t){this.progressionEntity&&this.progressionEntity.visible&&(this.isEaten&&(this.isFirstTime?this.progression+=t*this.speed*4:this.progression+=t*this.speed,this.progression>=1&&(this.woolEntity.enabled=!0,this.app.fire("WoolFarm:CallPanda"),this.woolTaken=!1,this.isEaten=!1)),this.progressionEntity.fire("Progress",this.progression))},Sheep.prototype.postUpdate=function(t){},Sheep.prototype.runAwayFromPlayer=function(t){if(this.totalRun>1.5)return!1;if(this.playerEntity&&this.woolEntity.enabled){this.entity.fire("Path:Stop");var i=this.entity.getPosition(),e=this.playerEntity.getPosition().clone(),s=this.centerArea.getPosition();if(this.entity.getPosition().clone().sub(s).length()>4)return!1;if(this.entity.getPosition().clone().sub(this.playerEntity.getPosition()).length()<3){var n=-Utils.lookAt(i.x,i.z,e.x,e.z)-Math.PI/2,o=Math.cos(n)*this.runAwaySpeed*t,a=Math.sin(n)*this.runAwaySpeed*t;this.entity.translate(o,0,a),this.directionEntity.setLocalEulerAngles(0,-n*pc.math.RAD_TO_DEG-this.offsetAngle,0),this.characterEntity.anim.setBoolean("Running",!0),this.totalRun+=t}}};var AnimalFoodPlate=pc.createScript("animalFoodPlate");AnimalFoodPlate.attributes.add("eatingParticle",{type:"entity"}),AnimalFoodPlate.prototype.initialize=function(){this.waitingForItem=!1,this.entity.on("Eat",this.onEat,this),this.entity.on("Added",this.onAdded,this)},AnimalFoodPlate.prototype.onAdded=function(){this.entity.fire("Droppable:State",!1),this.app.fire("EffectManager:LandSmoke",this.entity.getPosition().clone().add(new pc.Vec3(0,.75,0))),this.waitingForItem&&(this.doConsume(),this.waitingForItem(),this.waitingForItem=!1)},AnimalFoodPlate.prototype.onEat=function(t,i){this.entity.script.droppable.itemArray.length>0?(this.doConsume(),t()):i&&(this.waitingForItem=t,i())},AnimalFoodPlate.prototype.doConsume=function(){this.eatingParticle.particlesystem.reset(),this.eatingParticle.particlesystem.play(),this.entity.sound.play("Eating"),Timer.setTimeout((function(t){t.entity.script.connectedAnimal.animalEntity.fire("Behaviour:Callback"),t.entity.sound.stop("Eating"),t.eatingParticle.particlesystem.stop(),t.entity.fire("Droppable:State",!0),t.entity.fire("Clear")}),3e3,this)};var Tractor=pc.createScript("tractor");Tractor.attributes.add("wagonEntity",{type:"entity"}),Tractor.attributes.add("coinPoint",{type:"entity"}),Tractor.attributes.add("tractorEntity",{type:"entity"}),Tractor.attributes.add("egsozEntity",{type:"entity"}),Tractor.attributes.add("smokePoint",{type:"entity"}),Tractor.prototype.initialize=function(){this.wagonEntity.on("Added",this.onDropped,this),this.app.on("Tractor:Complete",this.onComplete,this)},Tractor.prototype.onComplete=function(){this.tractorEntity.script.motion.enabled=!0,this.egsozEntity.enabled=!0,this.entity.sound.play("Running"),Timer.setTimeout((function(t){t.entity.fire("Motion","Complete")}),1500,this),Timer.setTimeout((function(t){t.wagonEntity.fire("Clear"),t.wagonEntity.fire("Droppable:State",!0),pc.app.fire("EffectManager:LandSmoke",t.smokePoint.getPosition())}),3e3,this),Timer.setTimeout((function(t){t.tractorEntity.script.motion.enabled=!1,t.egsozEntity.enabled=!1}),5e3,this)},Tractor.prototype.onDropped=function(){this.app.fire("Money:Pay",pc.Prices.Wool,this.coinPoint),this.app.fire("Tractor:Added","Wool"),this.wagonEntity.script.droppable.itemArray.length===this.wagonEntity.script.droppable.count&&this.app.fire("Tractor:Complete")};var ItemHolder=pc.createScript("itemHolder");ItemHolder.prototype.initialize=function(){this.isActive=!0,this.callback=!1,this.entity.on("CollectedBy",this.onCollected,this),this.entity.on("ItemCreated",this.onItemCreated,this),this.entity.on("CanUse",this.canUse,this)},ItemHolder.prototype.onCollected=function(){this.isActive=!0,this.callback&&(this.callback(),this.callback=!1)},ItemHolder.prototype.onItemCreated=function(){this.isActive=!1},ItemHolder.prototype.canUse=function(t){this.isActive?(t(),t=!1):this.callback=t};var ConnectedFoodSource=pc.createScript("connectedFoodSource");ConnectedFoodSource.attributes.add("foodSource",{type:"entity"}),ConnectedFoodSource.prototype.initialize=function(){this.foodSource.enabled=!0};var EggFarm=pc.createScript("eggFarm");EggFarm.attributes.add("farmerPanda",{type:"entity"}),EggFarm.prototype.initialize=function(){this.farmerPanda.enabled=!1,this.app.on("EggFarm:CallPanda",this.callPanda,this)},EggFarm.prototype.callPanda=function(a){if(this.farmerPanda.enabled)return!1;this.farmerPanda.enabled=!0,this.farmerPanda.fire("Clear"),this.farmerPanda.fire("Behaviour:Trigger","START")};var InventoryManager=pc.createScript("inventoryManager");InventoryManager.attributes.add("itemEntity",{type:"entity"}),InventoryManager.attributes.add("holderEntity",{type:"entity"}),InventoryManager.attributes.add("nothingEntity",{type:"entity"}),InventoryManager.attributes.add("alertEntity",{type:"entity"}),InventoryManager.attributes.add("playerEntity",{type:"entity"}),InventoryManager.attributes.add("lootboxScene",{type:"entity"}),InventoryManager.attributes.add("boxEntity",{type:"entity"}),InventoryManager.attributes.add("explosionSprite",{type:"entity"}),InventoryManager.attributes.add("lootboxContent",{type:"entity"}),InventoryManager.attributes.add("unlockButton",{type:"entity"}),InventoryManager.attributes.add("rewardButton",{type:"entity"}),InventoryManager.attributes.add("doneButton",{type:"entity"}),InventoryManager.attributes.add("deliveryGuy",{type:"entity"}),InventoryManager.attributes.add("deliveryDelay",{type:"number",default:120}),InventoryManager.attributes.add("content",{type:"json",schema:[{name:"name",type:"string",default:"Black Bow Tie"},{name:"icon",type:"asset"},{name:"type",type:"string",enum:[{Item:"Item"}],default:"Item"},{name:"entity",type:"entity"},{name:"category",type:"string",default:"Hat"},{name:"rewardAdsCount",type:"number",default:0},{name:"watchedAdsCount",type:"number",default:0},{name:"price",type:"number",default:0},{name:"active",type:"boolean",default:!1},{name:"equip",type:"boolean",default:!1}],array:!0}),InventoryManager.attributes.add("itemTitle",{type:"entity"}),InventoryManager.attributes.add("itemIcon",{type:"entity"}),InventoryManager.attributes.add("itemRewardText",{type:"entity"}),InventoryManager.attributes.add("itemRewardBar",{type:"entity"}),InventoryManager.attributes.add("itemRewardButton",{type:"entity"}),InventoryManager.attributes.add("itemEquipButton",{type:"entity"}),InventoryManager.attributes.add("itemBuyButton",{type:"entity"}),InventoryManager.prototype.initialize=function(){var t=this;this.itemEntity.enabled=!1,this.unreadCount=0,this.items=Utils.getItemAsArray("Items"),this.itemArray=[],this.activateEntities(),Utils.waitForChanges((function(){t.updateEquipments()})),this.app.on("InventoryManager:Show",this.showItem,this),this.app.on("InventoryManager:Equip",this.onEquip,this),this.app.on("InventoryManager:EquipAndClose",this.onEquipAndClose,this),this.app.on("InventoryManager:RewardWatch",this.onRewardWatch,this),this.app.on("InventoryManager:BuyItem",this.onBuyItem,this),this.app.on("InventoryManager:AddItem",this.onAddItem,this),this.app.on("InventoryManager:HasItem",this.hasItem,this),this.app.on("PopupManager:Show",this.onShow,this),this.updateUnread(),pc.InventoryManager=this},InventoryManager.prototype.showItem=function(t){var e=this.getItemById(t);e&&(this.itemTitle.element.text=e.name,this.itemIcon.element.textureAsset=e.icon,this.itemBuyButton.enabled=!1,this.itemRewardButton.enabled=!1,this.itemEquipButton.enabled=!1,e.price>0?(this.itemBuyButton.enabled=!0,this.itemBuyButton.findByName("Price").element.text=e.price+"",this.itemBuyButton.script.button.value=e.name):e.watchedAdsCount>=e.rewardAdsCount?(this.itemEquipButton.enabled=!0,this.itemEquipButton.script.button.value=e.name):(this.itemRewardText.element.text=e.watchedAdsCount+" / "+e.rewardAdsCount,this.itemRewardButton.script.button.value=e.name,this.itemRewardBar.script.timeline.endFrame.scale.x=1*e.watchedAdsCount/e.rewardAdsCount,this.itemRewardBar.fire("Timeline"),this.itemRewardBar.script.timeline.startFrame.scale.x=1*e.watchedAdsCount/e.rewardAdsCount,this.itemRewardButton.enabled=!0),this.app.fire("PopupManager:Show","Item"))},InventoryManager.prototype.onEquip=function(t){var e=this,n=this.getItemById(t);if(n){var a=!n.equip;this.disableByCategory(n.category),n.equip=a,n.active=!0}this.updateEquipments(),this.onItemsUpdated(),Utils.waitForChanges((function(){e.render()}))},InventoryManager.prototype.onEquipAndClose=function(t){this.onEquip(t),this.app.fire("PopupManager:Hide")},InventoryManager.prototype.disableByCategory=function(t){for(var e in this.content){var n=this.content[e];n.category==t&&(n.equip=!1)}},InventoryManager.prototype.updateEquipments=function(){for(var t in this.content){var e=this.content[t];e&&(e.entity.enabled=e.equip)}},InventoryManager.prototype.onRewardWatch=function(t){var e=this,n=this.getItemById(t);n&&PokiPlugin.showReward((function(){n.watchedAdsCount++,n.watchedAdsCount>=n.rewardAdsCount&&(n.active=!0,e.app.fire("EffectManager:Confetti",e.playerEntity.getPosition())),e.showItem(t),e.onItemsUpdated()}))},InventoryManager.prototype.onBuyItem=function(t){var e=this.getItemById(t);e&&(e.price<=pc.MoneyManager.money?(e.active=!0,e.equip=!0,this.onItemsUpdated(),this.updateEquipments(),this.app.fire("EffectManager:Confetti",this.playerEntity.getPosition()),this.app.fire("Money:Remove",e.price),this.app.fire("Overlay:Sound","Purchase"),this.app.fire("PopupManager:Hide")):(this.app.fire("Money:NoMoney"),this.app.fire("Overlay:Message","No money!"),this.app.fire("RewardManager:NoMoneyOnBuyItem")))},InventoryManager.prototype.onAddItem=function(t){var e=this.getItemById(t);e&&(e.active=!0,e.equip=!0,this.onItemsUpdated(),this.updateEquipments(),this.app.fire("EffectManager:Confetti",this.playerEntity.getPosition()),this.app.fire("PopupManager:Hide"))},InventoryManager.prototype.onShow=function(t){if("Inventory"!=t)return!1;this.render(),this.unreadCount=0,this.updateUnread()},InventoryManager.prototype.onItemsUpdated=function(){var t=[];for(var e in this.content){var n=this.content[e];t.push({itemId:n.name,equip:n.equip,active:n.active})}Utils.setItem("Items",JSON.stringify(t))},InventoryManager.prototype.hasItem=function(t){return this.getItemById(t).active},InventoryManager.prototype.updateUnread=function(){this.alertEntity.enabled=this.unreadCount>0,this.alertEntity.findByName("Text").element.text=this.unreadCount},InventoryManager.prototype.clear=function(){for(var t=this.itemArray.length;t--;)this.itemArray[t].destroy();this.itemArray=[]},InventoryManager.prototype.render=function(t){this.clear();for(var e=0;e<this.content.length;e++){var n=this.content[e],a=this.itemEntity.clone();a.enabled=!0,a.findByName("Name").element.text=n.name,a.findByName("Thumbnail").element.textureAsset=n.icon,n.active?(a.findByName("Label").enabled=!1,a.findByName("Check").enabled=n.entity.enabled,a.script.button.action="InventoryManager:Equip"):(a.findByName("Label").enabled=!0,n.rewardAdsCount>0&&(a.findByName("WatchAd").enabled=!0,a.findByName("Coin").enabled=!1,a.findByName("Price").element.text="0 / "+n.rewardAdsCount),n.price>0&&(a.findByName("WatchAd").enabled=!1,a.findByName("Coin").enabled=!0,a.findByName("Price").element.text=n.price+""),a.findByName("Thumbnail").element.color=pc.Color.BLACK,a.findByName("Thumbnail").element.opacity=.35,a.findByName("Check").enabled=!1),a.script.button.value=n.name,this.holderEntity.addChild(a),this.itemArray.push(a)}0===this.content.length?this.nothingEntity.enabled=!0:this.nothingEntity.enabled=!1},InventoryManager.prototype.getItemById=function(t){for(var e=0;e<this.content.length;e++)if(this.content[e].name===t)return this.content[e];return!1},InventoryManager.prototype.update=function(t){},InventoryManager.prototype.activateEntities=function(){for(var t in this.items){var e=this.items[t],n=this.getItemById(e.itemId);n&&(n.active=e.active,n.equip=e.equip)}};var Shower=pc.createScript("shower");Shower.attributes.add("foamEntity",{type:"entity"}),Shower.attributes.add("showerEffect",{type:"entity"}),Shower.attributes.add("requestCustomer",{type:"string",default:"Dirty"}),Shower.prototype.initialize=function(){this.showerCallback=!1,this.isShowering=!1,this.isReserved=!1,this.showerEffect.enabled=!1,this.entity.on("Trigger",this.onTrigger,this),this.entity.on("WaitShower",this.onWait,this)},Shower.prototype.onTrigger=function(t){return!!this.showerCallback&&(!this.isShowering&&(this.foamEntity.particlesystem.reset(),this.foamEntity.particlesystem.play(),this.entity.sound.play("Shower"),this.showerEffect.enabled=!0,this.app.fire("World2Screen:Show","Spounge",this.entity,this.offset,2),Timer.setTimeout((function(t){t.showerCallback&&(t.showerCallback(),t.showerCallback=!1),t.isShowering=!1,t.showerEffect.enabled=!1}),4e3,this),void(this.isShowering=!0)))},Shower.prototype.onWait=function(t){this.showerCallback=t},Shower.prototype.update=function(t){this.isReserved||"None"==this.requestCustomer||this.app.fire("CustomerManager:Request",this.requestCustomer,1e4)};var Clickable=pc.createScript("clickable");Clickable.attributes.add("cameraEntity",{type:"entity"}),Clickable.prototype.initialize=function(){this.lastUpdate=Date.now(),this.gridEntity=this.app.root.findByName("Grid"),this.ray=new pc.Ray,this.hitPosition=new pc.Vec3,this.shape=new pc.BoundingBox,this.app.keyboard.on("keydown",this.onKeyDown,this),this.app.mouse.on("mousemove",this.onMouseMove,this),this.app.mouse.on("mouseup",this.onClick,this),this.app.touch&&this.app.touch.on("touchstart",this.onClick,this),this.getClickables(),this.app.on("Scene:Refresh",this.getClickables,this)},Clickable.prototype.getClickables=function(){this.clickableEntities=this.app.root.findByTag("Clickable")},Clickable.prototype.doRaycast=function(t,i){return!!t&&(!!t.collision&&(!!t.collision.halfExtents&&(this.shape.center=t.getPosition().clone(),this.shape.halfExtents=t.collision.halfExtents.clone(),this.cameraEntity.camera.screenToWorld(i.x,i.y,this.cameraEntity.camera.farClip,this.ray.direction),this.ray.origin.copy(this.cameraEntity.getPosition()),this.ray.direction.sub(this.ray.origin).normalize(),!!this.shape.intersectsRay(this.ray,this.hitPosition)&&t)))},Clickable.prototype.onClick=function(t){if(pc.hasActiveInterface)return!1;if(pc.lastClickTime&&Date.now()-pc.lastClickTime<100)return!1;var i=this.checkRaycast(t);i&&i.fire("Click",t,this.hitPosition)},Clickable.prototype.onKeyDown=function(t){this.lastHoverEntity&&this.lastHoverEntity.fire("MouseLeave")},Clickable.prototype.onMouseMove=function(t){if(pc.hasActiveInterface)return!1;this.lastHoverEntity&&this.lastHoverEntity.fire("MouseLeave");var i=this.checkRaycast(t);i?(document.body.style.cursor="Pointer",i.fire("Hover",t,this.hitPosition),this.lastHoverEntity=i):document.body.style.cursor="Default"},Clickable.prototype.checkRaycast=function(t){for(var i=[],e=this.clickableEntities.length;e--;)if(!0===this.clickableEntities[e].enabled){var s=this.doRaycast(this.clickableEntities[e],t);s&&i.push(s)}return i.length>0?i[0]:this.doRaycast(this.gridEntity,t)},Clickable.prototype.update=function(t){Date.now()-this.lastUpdate>200&&(this.getClickables(),this.app.fire("Scene:Refresh"),this.lastUpdate=Date.now())};var Delivery=pc.createScript("delivery");Delivery.attributes.add("characterEntity",{type:"entity"}),Delivery.attributes.add("leavePoint",{type:"entity"}),Delivery.attributes.add("deliveryPoint",{type:"entity"}),Delivery.prototype.initialize=function(){this.entity.on("Behaviour:LOCATE_DELIVERY_POINT",this.locateDeliveryPoint,this),this.entity.on("Behaviour:LOCATE_LEAVE",this.locateLeave,this),this.entity.on("Behaviour:DELIVER",this.deliver,this),this.entity.on("Behaviour:DONE",this.done,this)},Delivery.prototype.locateDeliveryPoint=function(e){var t=this.app.root.findByTag("DeliveryPoint"),i=Math.floor(Math.random()*t.length);this.entity.fire("Behaviour:Callback",t[i])},Delivery.prototype.locateLeave=function(){this.entity.fire("Behaviour:Callback",this.leavePoint)},Delivery.prototype.deliver=function(){this.app.fire("ItemManager:Create","Box",this.deliveryPoint.getPosition().clone()),this.entity.fire("Behaviour:Callback")},Delivery.prototype.done=function(){this.entity.enabled=!1};var DeliveryBox=pc.createScript("deliveryBox");DeliveryBox.prototype.initialize=function(){this.isCollected=!1,this.entity.on("Trigger",this.onCollected,this)},DeliveryBox.prototype.onCollected=function(e){if(this.isCollected)return!1;this.app.fire("InventoryManager:Add",{itemId:Utils.generateUUID(),name:"?",icon:"Box-Big-Icon.png",type:"Lootbox"}),this.app.fire("InventoryManager:DeliveryTaken"),Timer.setTimeout((function(e){e.entity.destroy()}),100,this),this.isCollected=!0};var FishingRod=pc.createScript("fishingRod");FishingRod.attributes.add("rodEntity",{type:"entity"}),FishingRod.prototype.initialize=function(){this.entity.on("Producer:Reset",this.onReset,this)},FishingRod.prototype.onReset=function(){this.rodEntity.fire("Motion:Play","Take")};var ConnectedPlate=pc.createScript("connectedPlate");ConnectedPlate.attributes.add("plateEntity",{type:"entity"}),ConnectedPlate.prototype.initialize=function(){this.plateEntity&&(this.plateEntity.enabled=!0)};var QuestManager=pc.createScript("questManager");QuestManager.attributes.add("rowEntity",{type:"entity"}),QuestManager.attributes.add("holderEntity",{type:"entity"}),QuestManager.attributes.add("popupEntity",{type:"entity"}),QuestManager.attributes.add("notificationEntity",{type:"entity"}),QuestManager.attributes.add("tutorialEntity",{type:"entity"}),QuestManager.attributes.add("quests",{type:"json",schema:[{name:"questID",type:"number",default:0},{name:"icon",type:"asset"},{name:"title",type:"string",default:"None"},{name:"description",type:"string",default:"None"},{name:"triggerEventName",type:"string"},{name:"triggerEventArgumentPosition",type:"number",default:0},{name:"argumentName",type:"string"},{name:"goalNumber",type:"number",default:1},{name:"rewardEvent",type:"string",default:""},{name:"rewardEventValue",type:"string"},{name:"rewardText",type:"string",default:""},{name:"iconReward",type:"asset"},{name:"progress",type:"number",default:0}],array:!0}),QuestManager.prototype.initialize=function(){this.items=[],this.rowEntity.enabled=!1,this.getQuests(),this.app.on("QuestManager:Complete",this.questComplete,this),this.app.on("PopupManager:Show",this.renderPopup,this),this.app.on("Item:AddedTo",this.onAddedTo,this),this.app.on("Money:Add",this.onMoneyAdd,this),this.app.on("UpgradeManager:Upgrade",this.onUpgrade,this),this.app.on("Eat:Hungry",this.onEatHungry,this),this.app.on("LevelManager-Station",this.onNewStation,this),this.app.on("LevelManager:LevelUnlock",this.onLevelUnlock,this)},QuestManager.prototype.onNewStation=function(e){var t=this.quests.filter((function(e){return!e.isCompleted&&!e.isClaimed})).slice(0,3),n=t.filter((function(e){return"LevelManager-Station"===e.triggerEventName}));if(0===n.length)return!1;for(var r=!1,s=0;s<n.length;s++)for(var i=n[s],a=String(i.argumentName).split(""),o=0;o<a.length;o++){var u=a[o];parseInt(u)==parseInt(e)&&(i.progress+=1,i.progress>=i.goalNumber&&(i.isCompleted=!0),r=!0)}r&&this.updateQuestsInfo()},QuestManager.prototype.onEatHungry=function(e,t){var n=this.quests.filter((function(e){return!e.isCompleted&&!e.isClaimed})).slice(0,3),r=n.filter((function(e){return"Eat:Hungry"===e.triggerEventName}));if(0===r.length)return!1;for(var s=[e,t],i=!1,a=0;a<r.length;a++){var o=r[a];o.argumentName==s[o.triggerEventArgumentPosition]&&(o.progress+=1,o.progress>=o.goalNumber&&(o.isCompleted=!0),i=!0)}i&&this.updateQuestsInfo()},QuestManager.prototype.onAddedTo=function(e,t){var n=this.quests.filter((function(e){return!e.isCompleted&&!e.isClaimed})).slice(0,3),r=n.filter((function(e){return"Item:AddedTo"===e.triggerEventName}));if(0===r.length)return!1;for(var s=[e,t],i=!1,a=0;a<r.length;a++){var o=r[a];o.argumentName==s[o.triggerEventArgumentPosition]&&(o.progress+=1,o.progress>=o.goalNumber&&(o.isCompleted=!0),i=!0)}i&&this.updateQuestsInfo()},QuestManager.prototype.onLevelUnlock=function(e){var t=this.quests.filter((function(e){return!e.isCompleted&&!e.isClaimed})).slice(0,3),n=t.filter((function(e){return"LevelManager:LevelUnlock"===e.triggerEventName}));if(0===n.length)return!1;for(var r=!1,s=0;s<n.length;s++){var i=n[s];i.argumentName!=e&&"ANY"!=i.argumentName||(i.progress+=1,i.progress>=i.goalNumber&&(i.isCompleted=!0),r=!0),r=!0}r&&this.updateQuestsInfo()},QuestManager.prototype.onMoneyAdd=function(e,t){var n=this.quests.filter((function(e){return!e.isCompleted&&!e.isClaimed})).slice(0,3),r=n.filter((function(e){return"Money:Add"===e.triggerEventName}));if(0===r.length)return!1;for(var s=!1,i=0;i<r.length;i++){var a=r[i];a.progress=parseInt(a.progress)+parseInt(e),a.progress>=a.goalNumber&&(a.isCompleted=!0),s=!0}s&&this.updateQuestsInfo()},QuestManager.prototype.onUpgrade=function(e){var t=this.quests.filter((function(e){return!e.isCompleted&&!e.isClaimed})).slice(0,3),n=t.filter((function(e){return"UpgradeManager:Upgrade"===e.triggerEventName}));if(0===n.length)return!1;for(var r=!1,s=0;s<n.length;s++){var i=n[s];i.argumentName!=e&&"ANY"!=i.argumentName||(i.progress+=1,i.progress>=i.goalNumber&&(i.isCompleted=!0),r=!0)}r&&this.updateQuestsInfo()},QuestManager.prototype.questComplete=function(e){var t=this.getQuestById(e);if(!t)return!1;this.app.fire(t.rewardEvent,t.rewardEventValue),t.isClaimed=!0,this.updateQuestsInfo()},QuestManager.prototype.updateQuestsInfo=function(){this.updateQuestsLocalStorage(),this.updateNotifications(),this.renderPopup()},QuestManager.prototype.updateNotifications=function(){for(var e=0,t=0;t<this.quests.length;t++){var n=this.quests[t];n.isClaimed||n.isCompleted&&(e+=1)}e>0?(this.tutorialEntity.enabled=!0,this.notificationEntity.enabled=!0,this.notificationEntity.findByName("Number").element.text=e):(this.tutorialEntity.enabled=!1,this.notificationEntity.enabled=!1)},QuestManager.prototype.updateQuestsLocalStorage=function(){Utils.setItemAsArray("Quests",this.quests.map((function(e){return{name:e.questID,progress:e.progress,isCompleted:e.isCompleted,isClaimed:e.isClaimed}})))},QuestManager.prototype.renderPopup=function(e){if(e&&"Quests"!=e)return!1;if(!this.popupEntity.enabled)return!1;this.tutorialEntity.enabled=!0,this.tutorialEntity.enabled=!1,this.clearPopup();for(var t=0;t<this.quests.length;t++){var n=this.quests[t];if(!n.isClaimed){var r=this.rowEntity.clone();if(r.enabled=!0,r.name=n.questID,r.findByName("Title").element.text=n.title,r.findByName("Description").element.text=n.description,r.findByName("Icon").element.textureAsset=n.icon,r.findByName("RewardIcon").element.textureAsset=n.iconReward,r.findByName("RewardText").element.text=n.rewardText,r.findByName("CompleteButton").button.active=n.isCompleted,r.findByName("CompleteButton").script.button.value=n.questID,r.findByName("RewardCompleteIcon").enabled=n.isCompleted,r.findByName("ProgressFill").setLocalScale(Math.min(n.progress/n.goalNumber,1),1,1),r.findByName("ProgressText").element.text=Math.min(n.progress,n.goalNumber)+"/"+n.goalNumber,this.holderEntity.addChild(r),this.items.push(r),this.items.length>=3)break}}},QuestManager.prototype.clearPopup=function(){for(var e=0;e<this.items.length;e++){var t=this.items[e];t.enabled&&t.destroy()}this.items=[]},QuestManager.prototype.getQuests=function(){for(var e=Utils.getItemAsArray("Quests"),t=0;t<this.quests.length;t++){var n=this.quests[t],r=e.filter((function(e){return e.name===n.questID}));r.length>0&&(n.progress=r[0].progress,n.isCompleted=r[0].isCompleted,n.isClaimed=r[0].isClaimed,!n.isCompleted&&n.progress>=n.goalNumber&&(n.isCompleted=!0))}this.updateQuestsInfo()},QuestManager.prototype.getQuestById=function(e){return this.quests.find((function(t){return t.questID===e}))};var HoneySell=pc.createScript("honeySell");HoneySell.attributes.add("foodSource",{type:"entity"}),HoneySell.prototype.initialize=function(){this.foodSource.fire("Allow")},HoneySell.prototype.update=function(e){};var ConnectedEntity=pc.createScript("connectedEntity");ConnectedEntity.attributes.add("connectedEntity",{type:"entity"}),ConnectedEntity.prototype.initialize=function(){this.on("state",this.onStateChange,this),this.connectedEntity.enabled=!0},ConnectedEntity.prototype.onStateChange=function(t){this.connectedEntity.enabled=t};var PlaceManager=pc.createScript("placeManager");PlaceManager.attributes.add("pathEntity",{type:"entity"}),PlaceManager.attributes.add("gridEntity",{type:"entity"}),PlaceManager.attributes.add("hoverEntity",{type:"entity"}),PlaceManager.attributes.add("holderEntity",{type:"entity"}),PlaceManager.attributes.add("playerCamera",{type:"entity"}),PlaceManager.attributes.add("buildingCamera",{type:"entity"}),PlaceManager.attributes.add("buildingEntity",{type:"entity"}),PlaceManager.attributes.add("overlayEntity",{type:"entity"}),PlaceManager.attributes.add("clickablePlugin",{type:"entity"}),PlaceManager.attributes.add("actionMenu",{type:"entity"}),PlaceManager.attributes.add("nothingEntity",{type:"entity"}),PlaceManager.attributes.add("finalLevelEntity",{type:"entity"}),PlaceManager.attributes.add("itemEntity",{type:"entity"}),PlaceManager.attributes.add("itemHolderEntity",{type:"entity"}),PlaceManager.attributes.add("coinDisplay",{type:"entity"}),PlaceManager.attributes.add("cursorEntity",{type:"entity"}),PlaceManager.prototype.initialize=function(){this.offset=this.gridEntity.getPosition().clone(),this.stickyPosition=new pc.Vec3,this.buildings=this.entity.findByTag("Building"),this.buildings.forEach((function(i){i.enabled=!1})),this.interfaceArray=[],this.hoverEntity.enabled=!1,this.isBuilding=!1,this.currentBuilding=!1,this.buildingSelected=!1,this.buildingArray=Utils.getItemAsArray("Buildings"),this.loadBuildings(),this.gridEntity.on("Click",this.onClick,this),this.gridEntity.on("Hover",this.onHover,this),this.app.on("PlaceManager:Build",this.onBuildSelection,this),this.app.on("PlaceManager:Remove",this.removeBuilding,this),this.app.on("PlaceManager:Select",this.onSelect,this),this.app.on("PopupManager:Show",this.onShow,this)},PlaceManager.prototype.onShow=function(i){this.app.fire("PlaceManager:Select",!1),this.app.fire("World2Screen:Hide","ConfirmTooltip"),"Building"==i&&(this.renderPopupItems(),this.cursorEntity.enabled=!1)},PlaceManager.prototype.onSelect=function(i){this.currentBuildingId=i},PlaceManager.prototype.onBuildSelection=function(i){if(this.buildingSelected)return!1;var t=this,e=this.getBuildingByName(i);if(e){if(pc.MoneyManager.money<e.script.building.price)return this.app.fire("Money:NoMoney"),!1;this.currentBuilding=e;var n=this.currentBuilding.findByName("Model");n||console.log("Model entity doesnt exist!"),n.model.ready((function(){t.onModelLoaded(n,e)}))}this.app.fire("PopupManager:Hide"),this.actionMenu.enabled=!1},PlaceManager.prototype.onModelLoaded=function(i,t){this.hoverEntity.model.asset=i.model.asset,this.hoverEntity.setLocalScale(i.getLocalScale()),this.hoverEntity.enabled=!0,this.playerCamera.enabled=!1,this.buildingCamera.enabled=!0,this.overlayEntity.script.world2Screen.cameraEntity=this.buildingCamera,this.clickablePlugin.script.clickable.cameraEntity=this.buildingCamera,this.buildingSelected=!0,this.app.fire("Money:Remove",t.script.building.price),this.entity.sound.play("Purchase"),this.app.fire("Overlay:AddItem",t.script.building.name+" purchased")},PlaceManager.prototype.onClick=function(i,t){return this.app.fire("PlaceManager:Select",!1),this.app.fire("World2Screen:Hide","ConfirmTooltip"),!!this.hoverEntity.enabled&&(!!this.currentBuilding&&(this.stickyPosition.x=Math.floor(t.x+.5),this.stickyPosition.z=Math.floor(t.z+.5),this.hoverEntity.setLocalPosition(this.stickyPosition),this.hoverEntity.enabled=!1,this.buildingEntity.enabled=!0,this.buildingEntity.setPosition(this.stickyPosition),this.buildingEntity.fire("Play"),this.app.fire("World2Screen:Clone","Hammer",this.buildingEntity,!1,!1,2),this.app.fire("Overlay:Sound","Hammer"),Timer.setTimeout((function(i){var t=Utils.generateUUID();i.buildingEntity.enabled=!1,i.actionMenu.enabled=!0,i.app.fire("EffectManager:LandSmoke",i.stickyPosition.clone()),i.app.fire("Motion","LittleShake"),i.createBuilding(i.currentBuilding.name,t,i.stickyPosition.clone()),i.buildingArray.push({buildingId:t,name:i.currentBuilding.name,position:i.stickyPosition.clone()}),Utils.setItem("Buildings",JSON.stringify(i.buildingArray)),pc.app.fire("Overlay:Sound","Hammer-Complete")}),2e3,this),void Timer.setTimeout((function(i){i.playerCamera.enabled=!0,i.buildingCamera.enabled=!1,i.overlayEntity.script.world2Screen.cameraEntity=i.playerCamera,i.clickablePlugin.script.clickable.cameraEntity=i.playerCamera,i.buildingSelected=!1}),3e3,this)))},PlaceManager.prototype.createBuilding=function(i,t,e){var n=this.getBuildingByName(i);if(n){var a=n.clone();a.name=t,a.buildingId=t,a.setLocalPosition(e.clone().sub(this.offset)),a.enabled=!0,this.holderEntity.addChild(a)}this.pathEntity.fire("PathFinding:Refresh")},PlaceManager.prototype.onHover=function(i,t){if(!this.hoverEntity.enabled)return!1;this.stickyPosition.x=Math.floor(t.x+.5),this.stickyPosition.z=Math.floor(t.z+.5),this.hoverEntity.setPosition(this.stickyPosition)},PlaceManager.prototype.getBuildingByName=function(i){for(var t=0;t<this.buildings.length;t++)if(this.buildings[t].name===i)return this.buildings[t]},PlaceManager.prototype.loadBuildings=function(){for(var i=0;i<this.buildingArray.length;i++){var t=this.buildingArray[i];this.createBuilding(t.name,t.buildingId,new pc.Vec3(t.position.x,t.position.y,t.position.z))}},PlaceManager.prototype.removeBuilding=function(){var i=this.currentBuildingId;if(i){var t=this.holderEntity.findByName(i);this.app.fire("EffectManager:LandSmoke",t.getPosition().clone());for(var e=0;e<5;e++)this.app.fire("World2Screen:Animate","Coin",t.getPosition().clone(),this.coinDisplay);this.app.fire("Money:Add",10),this.app.fire("Motion","LittleShake"),this.entity.sound.play("Remove"),this.app.fire("Overlay:AddItem",t.script.building.name+" removed"),t&&t.destroy();for(e=0;e<this.buildingArray.length;e++)this.buildingArray[e].buildingId===i&&this.buildingArray.splice(e,1);Utils.setItem("Buildings",JSON.stringify(this.buildingArray))}this.app.fire("PlaceManager:Select",!1),this.app.fire("World2Screen:Hide","ConfirmTooltip")},PlaceManager.prototype.renderPopupItems=function(){this.clearPopup();var i=this.finalLevelEntity.enabled;for(var t in this.itemEntity.enabled=!1,this.buildings){var e=this.buildings[t],n=this.itemEntity.clone();n.enabled=!0,n.findByName("Name").element.text=e.script.building.name,n.findByName("Price").element.text=e.script.building.price+"",n.findByName("Thumbnail").element.textureAsset=e.script.building.icon,i?n.findByName("Level").enabled=!1:(n.findByName("Price").enabled=!1,n.findByName("Level").enabled=!0,n.findByName("Thumbnail").element.color=pc.Color.BLACK,n.findByName("Thumbnail").element.opacity=.5,n.button.active=!1),n.script.button.value=e.name,this.itemHolderEntity.addChild(n),this.interfaceArray.push(n)}this.nothingEntity.enabled=!1},PlaceManager.prototype.clearPopup=function(){for(var i=this.interfaceArray.length;i--;){this.interfaceArray[i].destroy()}this.interfaceArray=[]};var Building=pc.createScript("building");Building.attributes.add("name",{type:"string",default:"None"}),Building.attributes.add("price",{type:"number",default:100}),Building.attributes.add("icon",{type:"asset"}),Building.prototype.initialize=function(){var t=this;this.offset=new pc.Vec3(0,1,0),this.isLoaded=!1,this.modelEntity=this.entity.findByName("Model"),this.modelEntity.model.ready((function(){t.defaultMaterial=t.modelEntity.model.meshInstances[0].material,t.hoverMaterial=t.app.assets.find("HoverMaterial").resource,t.isLoaded=!0})),this.entity.on("Click",this.onClick,this),this.entity.on("Hover",this.onHover,this),this.entity.on("MouseLeave",this.onMouseLeave,this)},Building.prototype.onClick=function(t){this.app.fire("World2Screen:Show","ConfirmTooltip",this.entity,this.offset),this.app.fire("PlaceManager:Select",this.entity.buildingId)},Building.prototype.onHover=function(){if(!this.isLoaded)return!1;this.modelEntity.model.meshInstances[0].material=this.hoverMaterial},Building.prototype.onMouseLeave=function(){if(!this.isLoaded)return!1;this.modelEntity.model.meshInstances[0].material=this.defaultMaterial};var ModelComponent=pc.createScript("modelComponent");ModelComponent.attributes.add("loaded",{type:"boolean",default:!1}),ModelComponent.prototype.initialize=function(){if(this.loaded)return Timer.setTimeout((function(t){t.entity.fire("Model:Loaded",!0)}),1e3,this),!1;this.materialCount=0,this.materialLoaded=0;var t=this.entity.model.asset;if(!t)return!1;var e=this.app.assets.get(t),a=this;e.ready((function(){a.entity.fire("Model:Loaded",!1),a.checkMaterials()}))},ModelComponent.prototype.checkMaterials=function(){if(!this.entity.model)return!1;var t=this.entity.model.meshInstances,e=this;if(!t)return!1;for(var a in this.materialCount=t.length,t){var i=t[a].material,o=this.app.assets.find(i.name);if(!o)return!1;o.ready((function(){e.checkTextures(i)})),this.app.assets.load(o)}},ModelComponent.prototype.checkTextures=function(t){var e=t._assetReferences,a=0,i=0,o=this;for(var n in e){var s=e[n];i++,this.app.assets.load(s.asset),s.asset.ready((function(){++a>=i&&o.setMaterial()}))}0===i&&this.setMaterial()},ModelComponent.prototype.setMaterial=function(){this.materialLoaded++,this.materialCount==this.materialLoaded&&this.entity.fire("Model:Loaded",!0)};pc.script.createLoadingScreen((function(e){var t,o;t=["body {","    background-color: #283538;","}","","#application-splash-wrapper {","    position: absolute;","    top: 0;","    left: 0;","    height: 100%;","    width: 100%;","    background: url(https://assets.venge.io/Loading-Optimized-v2.jpg);","    background-position: center center;","    background-repeat: no-repeat;","    background-size: cover;","}","","","","#progress-bar-container {","    height: 20px;","    width: calc(100% - 40px);","    background: rgba(0, 0, 0, 0.3);","    position: fixed;","    border: solid 3px #000;","    border-radius: 4px;","    bottom: 20px;","    left: 20px;","}","","#progress-bar {","    width: 0%;","    height: 100%;","    background-color: #fff;","}",""].join("\n"),(o=document.createElement("style")).type="text/css",o.styleSheet?o.styleSheet.cssText=t:o.appendChild(document.createTextNode(t)),document.head.appendChild(o),function(){var e=document.createElement("div");e.id="application-splash-wrapper",document.body.appendChild(e);var t=document.createElement("div");t.id="application-splash",e.appendChild(t);var o=document.createElement("div");o.id="progress-bar-container",t.appendChild(o);var r=document.createElement("div");r.id="progress-bar",o.appendChild(r)}(),e.on("preload:end",(function(){e.off("preload:progress")})),e.on("preload:progress",(function(e){var t=document.getElementById("progress-bar");t&&(e=Math.min(1,Math.max(0,e)),t.style.width=100*e+"%")})),e.on("Overlay:Loaded",(function(){var e=document.getElementById("application-splash-wrapper");e.parentElement.removeChild(e)}))}));var CameraSetting=pc.createScript("cameraSetting");CameraSetting.attributes.add("mobile",{type:"vec3",default:[0,0,0]}),CameraSetting.prototype.initialize=function(){Utils.isMobile()&&this.entity.setLocalPosition(this.mobile)};var CursorEnable=pc.createScript("cursorEnable");CursorEnable.attributes.add("cursorEntity",{type:"entity"}),CursorEnable.prototype.initialize=function(){this.cursorEntity&&(this.cursorEntity.enabled=!0)};var Injured=pc.createScript("injured");Injured.attributes.add("gridEntity",{type:"entity"}),Injured.attributes.add("characterEntity",{type:"entity"}),Injured.attributes.add("leavePoint",{type:"entity"}),Injured.prototype.initialize=function(){this.offset=new pc.Vec3(0,.5,0),this.isInjured=!0,this.isWaitingHelp=!1,this.entity.on("Behaviour:LOCATE_HELP",this.locateHelp,this),this.entity.on("Behaviour:LOCATE_LEAVE",this.locateLeave,this),this.entity.on("Behaviour:WAIT_HELP",this.waitHelp,this),this.entity.on("Behaviour:DONE",this.done,this),this.entity.on("Trigger",this.onTrigger,this)},Injured.prototype.onTrigger=function(){if(!this.isWaitingHelp)return!1;this.isInjured=!1,this.app.fire("World2Screen:Show","Vaccine",this.entity,this.offset,1.5),this.isWaitingHelp=!1,setTimeout((function(t){pc.app.fire("Money:Pay",5,t.entity),t.entity.fire("Behaviour:Callback")}),1500,this)},Injured.prototype.locateHelp=function(){var t=!1,i=this.entity.getPosition().clone();for(var e in this.helpPoints=this.gridEntity.findByTag("HelpPoint"),this.helpPoints){var n=this.helpPoints[e],r=this.gridEntity.script.pathFinding.search(i,n.getPosition().clone());!t&&n&&r.length>0&&(this.helpPoint=n,this.helpPoint.parent.fire("CallNpc:Set",this.entity),this.entity.fire("Behaviour:Callback",this.helpPoint),t=!0)}},Injured.prototype.locateLeave=function(){this.entity.fire("Behaviour:Callback",this.leavePoint)},Injured.prototype.waitHelp=function(){this.isWaitingHelp=!0},Injured.prototype.done=function(){this.helpPoint.parent.fire("CallNpc:Leave",this.entity),this.entity.destroy()},Injured.prototype.update=function(t){this.characterEntity.anim.setBoolean("Injured",this.isInjured)};var CallNpc=pc.createScript("callNpc");CallNpc.attributes.add("NPCName",{type:"string"}),CallNpc.attributes.add("maxCount",{type:"number",default:1}),CallNpc.attributes.add("time",{type:"number",default:1}),CallNpc.prototype.initialize=function(){this.lastCheck=Date.now(),this.NPCs=[],this.entity.on("CallNpc:Set",this.setNPC,this),this.entity.on("CallNpc:Leave",this.onLeave,this)},CallNpc.prototype.setNPC=function(t){this.NPCs.push(t)},CallNpc.prototype.onLeave=function(t){this.NPCs.splice(this.NPCs.indexOf(t),1)},CallNpc.prototype.update=function(t){return!(Date.now()-this.lastCheck<1e3*this.time)&&(this.lastCheck=Date.now(),!(this.NPCs.length>=this.maxCount)&&void(this.NPCName&&this.app.fire("CustomerManager:Request",this.NPCName)))};var MusicAnimal=pc.createScript("musicAnimal");MusicAnimal.attributes.add("gridEntity",{type:"entity"}),MusicAnimal.attributes.add("characterEntity",{type:"entity"}),MusicAnimal.attributes.add("leavePoint",{type:"entity"}),MusicAnimal.prototype.initialize=function(){this.offset=new pc.Vec3(0,0,0),this.isDancing=!1,this.entity.on("Behaviour:LOCATE_MUSIC_BOX",this.locateMusicBox,this),this.entity.on("Behaviour:LOCATE_LEAVE",this.locateLeave,this),this.entity.on("Behaviour:DANCE",this.dance,this),this.entity.on("Behaviour:DONE",this.done,this)},MusicAnimal.prototype.locateMusicBox=function(t){var i=!1,n=this.entity.getPosition().clone();for(var e in this.dancePoints=this.gridEntity.findByTag("DancePoint"),this.dancePoints){var a=this.dancePoints[e],s=this.gridEntity.script.pathFinding.search(n,a.getPosition().clone());!i&&a&&s.length>0&&(this.dancePoint=a,this.dancePoint.parent.fire("CallNpc:Set",this.entity),this.entity.fire("Behaviour:Callback",this.dancePoint),i=!0)}},MusicAnimal.prototype.locateLeave=function(){this.isDancing=!1,this.entity.fire("Behaviour:Callback",this.leavePoint)},MusicAnimal.prototype.dance=function(){this.isDancing=!0,setTimeout((function(t){pc.app.fire("Money:Pay",2,t.entity),t.entity.fire("Behaviour:Callback")}),1e4,this)},MusicAnimal.prototype.done=function(){this.dancePoint&&this.dancePoint.parent.fire("CallNpc:Leave",this.entity),this.entity.destroy()},MusicAnimal.prototype.update=function(t){this.characterEntity.anim.setBoolean("Dancing",this.isDancing)};var WolfHelper=pc.createScript("wolfHelper");WolfHelper.attributes.add("gridEntity",{type:"entity"}),WolfHelper.prototype.initialize=function(){this.currentWheatItem=!1,this.entity.on("Behaviour:LOCATE_WHEAT",this.locateWheat,this),this.entity.on("Behaviour:GET_WHEAT",this.getWheat,this),this.entity.on("Behaviour:LOCATE_EMPTY_PLATE",this.locateEmptyPlate,this)},WolfHelper.prototype.locateWheat=function(){var t=this;this.entity.fire("WaitForCallback",(function(){var e=t.gridEntity.findByTag("Wheat"),i=!1;for(var r in e){var a=e[r];a.enabled&&a.collision.enabled&&(i=a)}return i}),(function(e){t.currentWheatItem=e,t.entity.fire("Behaviour:Callback",e)}))},WolfHelper.prototype.locateEmptyPlate=function(){var t=this;this.entity.fire("WaitForCallback",(function(){var e=t.gridEntity.findByTag("FoodPlate"),i=!1;for(var r in e){var a=e[r];wheatItem.enabled&&wheatItem.collision.enabled&&(i=a)}return i}),(function(e){t.currentWheatItem=e,t.entity.fire("Behaviour:Callback",e)}))},WolfHelper.prototype.getWheat=function(){this.currentWheatItem&&(this.currentWheatItem.parent.fire("CollectedBy",this.entity),this.currentWheatItem.destroy(),this.currentWheatItem=!1)};var WaitForCallback=pc.createScript("waitForCallback");WaitForCallback.prototype.initialize=function(){this.callbacks=[],this.entity.on("WaitForCallback",this.onCallbackAdd,this)},WaitForCallback.prototype.onCallbackAdd=function(a,t,l){this.callbacks.push({condition:a,callback:t,lastCheck:-1,time:l>0?l:100})},WaitForCallback.prototype.update=function(a){for(var t=this.callbacks.length;t--;){var l=this.callbacks[t];if(l&&Date.now()-l.lastCheck>100){var c=l.condition();c&&(console.log("Condition met!"),l.callback(c),this.callbacks.splice(t,1))}}};var RewardManager=pc.createScript("rewardManager");RewardManager.attributes.add("extraMoneyEntity",{type:"entity"}),RewardManager.attributes.add("money2xEntity",{type:"entity"}),RewardManager.attributes.add("money2xBoostEntity",{type:"entity"}),RewardManager.attributes.add("moneyPackEntity",{type:"entity"}),RewardManager.attributes.add("offerEntity",{type:"entity"}),RewardManager.attributes.add("playerEntity",{type:"entity"}),RewardManager.attributes.add("maxAmount",{type:"number",default:100}),RewardManager.attributes.add("offers",{type:"json",schema:[{name:"name",type:"string"},{name:"icon",type:"asset"},{name:"delay",type:"number",default:1},{name:"shown",type:"boolean",default:!1},{name:"entity",type:"entity"},{name:"loop",type:"boolean",default:!1}],array:!0}),RewardManager.prototype.initialize=function(){for(var e in this.lastRewardShown=Date.now(),this.gameplayStart=Date.now(),this.offers){this.offers[e].lastShown=Date.now()}this.nextShow2xMoneyDate=Date.now()+24e4,this.app.on("Money:NoMoney",this.onMoneyRequest,this),this.app.on("RewardManager:RequestExtraGold",this.requestExtraGold,this),this.app.on("RewardManager:RequestItem",this.requestItem,this),this.app.on("RewardManager:2xGoldWatch",this.on2xGoldWatch,this),this.app.on("RewardManager:MoneyPackWatch",this.onMoneyPackWatch,this),this.app.on("RewardManager:NoMoneyOnBuyItem",this.onNoMoneyOnBuyItem,this),this.lastMoneyPackEnabled=Date.now()-3e5,this.moneyPackAdsWatched=0,this.app.keyboard.on("keydown",this.onKeyDown,this)},RewardManager.prototype.onNoMoneyOnBuyItem=function(){this.lastMoneyPackEnabled+3e5<Date.now()&&(this.app.fire("PopupManager:Show","MoneyPack"),this.lastMoneyPackEnabled=Date.now())},RewardManager.prototype.onMoneyPackWatch=function(){var e=this;PokiPlugin.showReward((function(){e.moneyPackAdsWatched+=1;var t=e.moneyPackEntity;t.findByName("RewardCount").element.text=e.moneyPackAdsWatched+" / 2",t.findByName("Fill").script.timeline.endFrame.scale.x=e.moneyPackAdsWatched/2,t.findByName("Fill").fire("Timeline"),e.moneyPackAdsWatched>=2&&(pc.app.fire("Money:Add",200),pc.app.fire("PopupManager:Hide","MoneyPack"),pc.app.fire("EffectManager:Confetti",e.playerEntity.getPosition()))}))},RewardManager.prototype.on2xGoldWatch=function(){var e=this;PokiPlugin.showReward((function(){e.money2xEntity.enabled=!1,e.money2xBoostEntity.enabled=!0,e.nextShow2xMoneyDate=Date.now()+24e4,pc.app.fire("EffectManager:Confetti",e.playerEntity.getPosition())}))},RewardManager.prototype.requestExtraGold=function(e){if(!e)return!1;var t=this;PokiPlugin.showReward((function(){t.extraMoneyEntity.enabled=!1,t.app.fire("Money:Add",parseInt(e)),pc.app.fire("EffectManager:Confetti",t.playerEntity.getPosition())}))},RewardManager.prototype.onMoneyRequest=function(e){if(!e)return!1;if(e<3)return!1;if(Date.now()-this.lastRewardShown<6e4)return!1;var t=Math.min(e,this.maxAmount);this.disableAllRewards(),this.extraMoneyEntity.enabled=!0,this.extraMoneyEntity.findByName("Price").element.text="+"+t+" Gold",this.extraMoneyEntity.script.button.value=t,clearTimeout(this.rewardTimer),this.rewardTimer=setTimeout((function(e){e.extraMoneyEntity.enabled=!1}),1e4,this),this.lastRewardShown=Date.now()},RewardManager.prototype.requestItem=function(e){this.app.fire("InventoryManager:Show",e),this.disableAllRewards()},RewardManager.prototype.offerItem=function(e){if(pc.InventoryManager.hasItem(e.name))return!1;this.disableAllRewards(),this.offerEntity.enabled=!0,this.offerEntity.findByName("Name").element.text=e.name,this.offerEntity.findByName("Icon").element.textureAsset=e.icon,this.offerEntity.script.button.value=e.name,e.shown=!0,clearTimeout(this.rewardTimer),this.rewardTimer=setTimeout((function(e){e.offerEntity.enabled=!1}),15e3,this),this.lastRewardShown=Date.now()},RewardManager.prototype.disableAllRewards=function(){this.extraMoneyEntity.enabled=!1,this.offerEntity.enabled=!1,this.money2xEntity.enabled=!1},RewardManager.prototype.showCurrentOffer=function(){for(var e=0;e<this.offers.length;e++){var t=this.offers[e],a=!1;!t.loop&&!t.shown&&t.delay>0&&Date.now()-this.gameplayStart>1e3*t.delay&&(a=!0),t.loop&&Date.now()-t.lastShown>1e3*t.delay&&(a=!0),a&&(this.disableAllRewards(),t.entity?(t.entity.enabled=!0,t.lastShown=Date.now()):this.offerItem(t),clearTimeout(this.rewardTimer),this.rewardTimer=setTimeout((function(e){e.disableAllRewards()}),15e3,this))}},RewardManager.prototype.onKeyDown=function(e){this.offerEntity.enabled&&e.key===pc.KEY_SPACE&&this.app.fire("RewardManager:RequestItem",this.offerEntity.script.button.value)},RewardManager.prototype.update=function(e){this.showCurrentOffer()};var CarrorCollector=pc.createScript("carrorCollector");CarrorCollector.attributes.add("fieldEntity",{type:"entity"}),CarrorCollector.attributes.add("holderEntity",{type:"entity"}),CarrorCollector.prototype.initialize=function(){this.currentCarrot=!1,this.requestedBy=!1,this.entity.on("Request:Items",this.onRequest,this),this.entity.on("Behaviour:LOCATE_CARROT",this.locateCarrot,this),this.entity.on("Behaviour:GET_CARROT",this.getCarrot,this),this.entity.on("Behaviour:LOCATE_PANDA",this.locatePanda,this),this.entity.on("Behaviour:DELIVER",this.deliver,this)},CarrorCollector.prototype.onRequest=function(t){if(!t)return console.log("Requested is not defined!"),!1;this.entity.fire("Behaviour:Trigger","REQUEST_LOAD"),this.requestedBy=t},CarrorCollector.prototype.locateCarrot=function(){var t=this.fieldEntity.findByTag("Carrot").filter((function(t){return t.enabled}));t.length>0?(this.currentCarrot=t[0],this.currentCarrot.on("Collected",this.onCollected,this),this.entity.fire("Behaviour:Callback",t[0])):console.log("No carrot")},CarrorCollector.prototype.onCollected=function(){this.currentCarrot=!1,this.entity.fire("Behaviour:Trigger","REQUEST_LOAD")},CarrorCollector.prototype.getCarrot=function(){this.currentCarrot&&this.currentCarrot.parent&&(this.currentCarrot.collision.enabled=!1,this.currentCarrot.parent.fire("CollectedBy"),this.currentCarrot.reparent(this.holderEntity),this.entity.fire("Behaviour:Callback"))},CarrorCollector.prototype.locatePanda=function(){this.entity.fire("Behaviour:Callback",this.requestedBy)},CarrorCollector.prototype.deliver=function(){this.requestedBy.fire("Transfer",this.currentCarrot),this.currentCarrot=!1,this.entity.fire("Behaviour:Callback")};var Testing=pc.createScript("testing");Testing.attributes.add("version",{type:"string",default:"balance_testing"}),Testing.attributes.add("delay",{type:"number",default:30}),Testing.attributes.add("groups",{type:"entity",array:!0}),Testing.attributes.add("active",{type:"boolean",default:!0}),Testing.prototype.initialize=function(){if(!this.active)return!1;if(Math.random()<.75)return!1;this.userId=Utils.getItemAsString("UserId",Utils.generateUserId()),this.isReturning=!Utils.setOnce("Returning");var t=!1,e=Utils.getItem("TestGroup");if(e?t=this.groups.find((function(t){return t.name.split("-")[1]==e})):(t=Utils.getRandom(this.groups),Utils.setItem("TestGroup",t.name.split("-")[1])),!t)return console.log("No grup exists!"),!1;this.testGroup=t.name.split("-")[1];for(var i=0;i<this.groups.length;i++)this.groups[i].enabled=!1;t.enabled=!0,setInterval((function(t){t.addTime()}),1e3*this.delay,this),this.app.on("PokiSDK:RewardedBreak",this.onReward,this),this.app.on("PokiSDK:CommercialBreak",this.onCommercial,this)},Testing.prototype.addTime=function(){Utils.service("?request=add_time",{is_returning:this.isReturning,user_id:this.userId,test_group:this.testGroup,version:this.version},(function(t){console.log("Adding time succesful!")}))},Testing.prototype.onReward=function(){Utils.service("?request=add_reward_break",{is_returning:this.isReturning,user_id:this.userId,test_group:this.testGroup,version:this.version},(function(t){console.log("Adding reward break succesful!")}))},Testing.prototype.onCommercial=function(){Utils.service("?request=add_commercial_break",{is_returning:this.isReturning,user_id:this.userId,test_group:this.testGroup,version:this.version},(function(t){console.log("Adding reward break succesful!")}))};var RandomWearable=pc.createScript("randomWearable");RandomWearable.attributes.add("models",{type:"entity",array:!0}),RandomWearable.prototype.initialize=function(){var a=Utils.getRandom(this.models);a&&(a.enabled=!0)};var TempPrice=pc.createScript("tempPrice");TempPrice.attributes.add("prices",{type:"json",schema:[{name:"entity",type:"entity"},{name:"price",type:"number",default:0},{name:"multiplier",type:"number",default:0}],array:!0}),TempPrice.prototype.initialize=function(){for(var e in this.prices){var i=this.prices[e];i&&(i.entity.script.price.price=i.price,i.entity.script.price.multiplier=i.multiplier)}};var BabyBottle=pc.createScript("babyBottle");BabyBottle.attributes.add("characterEntity",{type:"entity"}),BabyBottle.attributes.add("bottleEntity",{type:"entity"}),BabyBottle.prototype.initialize=function(){this.bottleEntity.enabled=!1,this.characterEntity.anim.on("Bottle",this.setBottleState,this)},BabyBottle.prototype.setBottleState=function(t){"Show"==t.string?(this.bottleEntity.enabled=!0,this.dropEntity=this.entity.script.hungry.currentPlate.parent.findByName("Drop"),this.dropEntity.enabled=!1):(this.dropEntity&&(this.dropEntity.enabled=!0),this.bottleEntity.enabled=!1)};var BoostX2Gold=pc.createScript("boostX2Gold");BoostX2Gold.attributes.add("duration",{type:"number",default:1,description:"minutes"}),BoostX2Gold.attributes.add("fillEntity",{type:"entity"}),BoostX2Gold.attributes.add("timeEntity",{type:"entity"}),BoostX2Gold.prototype.initialize=function(){this.durationMS=60*this.duration*1e3,this.onStateChange(!0),this.on("state",this.onStateChange,this)},BoostX2Gold.prototype.onStateChange=function(t){t?(this.startDate=Date.now(),this.endDate=Date.now()+this.durationMS,this.app.fire("Money:SetPayMultiplier",2)):this.app.fire("Money:SetPayMultiplier",1)},BoostX2Gold.prototype.generateTimeScring=function(t){var e=Math.floor(t/1e3/60),i=Math.floor(t/1e3%60);return e<10&&(e="0"+e),i<10&&(i="0"+i),e+":"+i},BoostX2Gold.prototype.update=function(t){Date.now()>this.endDate&&(this.entity.enabled=!1);var e=this.endDate-Date.now();this.timeEntity.element.text=this.generateTimeScring(e),this.fillEntity.fire("MaterialShader:Set","progress",(this.durationMS-e)/this.durationMS)};